(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{1143:function(e,t,r){"use strict";r(15);var n=r(20);r(4),r(23),r(24),r(17),r(62),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,r(45),r(42),r(4),r(23),r(57),r(24),r(17),r(62);var a,o,i=n(r(36)),l=n(r(37)),s=n(r(55)),u=n(r(56)),c=n(r(51)),d=r(433),f=r(239),p=r(899);function h(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,c.default)(e);if(t){var a=(0,c.default)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return(0,u.default)(this,r)}}var m=(a=(0,f.inject)("rootStore"),(0,d.withRouter)(o=a(o=function(e){(0,s.default)(r,e);var t=h(r);function r(){return(0,i.default)(this,r),t.apply(this,arguments)}return(0,l.default)(r,[{key:"enabledActions",get:function(){var e=this.props.match.params,t=e.cluster,r=e.devops;return globals.app.getActions({module:this.props.module,cluster:t,devops:r})}}]),r}(p.Component))||o)||o);t.default=m},1144:function(e,t,r){"use strict";r.r(t),r.d(t,"ReactComponent",(function(){return s}));var n=r(315),a=r.n(n),o=r(0),i=r.n(o),l=i.a.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M19 8.143a2.577 2.577 0 00-2.6-2.572 2.586 2.586 0 00-2.509 1.898 2.55 2.55 0 001.209 2.885v.386c-.026.669-.299 1.26-.819 1.774-.52.515-1.118.785-1.794.81-1.079.026-1.924.206-2.6.579v-6.12a2.55 2.55 0 001.209-2.886A2.586 2.586 0 008.587 3 2.566 2.566 0 006 5.571c.006.914.5 1.755 1.3 2.212v8.434c-.767.45-1.3 1.273-1.3 2.212A2.577 2.577 0 008.6 21c1.443 0 2.6-1.144 2.6-2.571 0-.682-.26-1.286-.689-1.749.117-.077.624-.527.767-.604.325-.142.728-.219 1.222-.219 1.365-.064 2.535-.578 3.575-1.607s1.56-2.546 1.625-3.883h-.026C18.467 9.904 19 9.081 19 8.143zM8.6 4.029c.858 0 1.56.707 1.56 1.542 0 .836-.715 1.543-1.56 1.543-.845 0-1.56-.707-1.56-1.543 0-.835.715-1.542 1.56-1.542zm0 15.955c-.858 0-1.56-.707-1.56-1.543 0-.835.715-1.542 1.56-1.542.845 0 1.56.707 1.56 1.542 0 .836-.715 1.543-1.56 1.543zM16.4 9.7c-.858 0-1.56-.708-1.56-1.543 0-.836.715-1.543 1.56-1.543.845 0 1.56.707 1.56 1.543 0 .835-.715 1.543-1.56 1.543z"}),s=function(e){return i.a.createElement("svg",a()({viewBox:"0 0 24 24",width:"1em",height:"1em"},e),l)};t.default="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij4KICAgIDxwYXRoIGZpbGw9ImN1cnJlbnRDb2xvciIgZmlsbC1ydWxlPSJldmVub2RkIiBkPSJNMTkgOC4xNDNhMi41NzcgMi41NzcgMCAwIDAtMi42LTIuNTcyIDIuNTg2IDIuNTg2IDAgMCAwLTIuNTA5IDEuODk4IDIuNTUgMi41NSAwIDAgMCAxLjIwOSAyLjg4NXYuMzg2Yy0uMDI2LjY2OS0uMjk5IDEuMjYtLjgxOSAxLjc3NC0uNTIuNTE1LTEuMTE4Ljc4NS0xLjc5NC44MS0xLjA3OS4wMjYtMS45MjQuMjA2LTIuNi41Nzl2LTYuMTJhMi41NSAyLjU1IDAgMCAwIDEuMjA5LTIuODg2QTIuNTg2IDIuNTg2IDAgMCAwIDguNTg3IDMgMi41NjYgMi41NjYgMCAwIDAgNiA1LjU3MWMuMDA2LjkxNC41IDEuNzU1IDEuMyAyLjIxMnY4LjQzNGMtLjc2Ny40NS0xLjMgMS4yNzMtMS4zIDIuMjEyQTIuNTc3IDIuNTc3IDAgMCAwIDguNiAyMWMxLjQ0MyAwIDIuNi0xLjE0NCAyLjYtMi41NzEgMC0uNjgyLS4yNi0xLjI4Ni0uNjg5LTEuNzQ5LjExNy0uMDc3LjYyNC0uNTI3Ljc2Ny0uNjA0LjMyNS0uMTQyLjcyOC0uMjE5IDEuMjIyLS4yMTkgMS4zNjUtLjA2NCAyLjUzNS0uNTc4IDMuNTc1LTEuNjA3czEuNTYtMi41NDYgMS42MjUtMy44ODNoLS4wMjZDMTguNDY3IDkuOTA0IDE5IDkuMDgxIDE5IDguMTQzek04LjYgNC4wMjljLjg1OCAwIDEuNTYuNzA3IDEuNTYgMS41NDIgMCAuODM2LS43MTUgMS41NDMtMS41NiAxLjU0My0uODQ1IDAtMS41Ni0uNzA3LTEuNTYtMS41NDMgMC0uODM1LjcxNS0xLjU0MiAxLjU2LTEuNTQyem0wIDE1Ljk1NWMtLjg1OCAwLTEuNTYtLjcwNy0xLjU2LTEuNTQzIDAtLjgzNS43MTUtMS41NDIgMS41Ni0xLjU0Mi44NDUgMCAxLjU2LjcwNyAxLjU2IDEuNTQyIDAgLjgzNi0uNzE1IDEuNTQzLTEuNTYgMS41NDN6TTE2LjQgOS43Yy0uODU4IDAtMS41Ni0uNzA4LTEuNTYtMS41NDMgMC0uODM2LjcxNS0xLjU0MyAxLjU2LTEuNTQzLjg0NSAwIDEuNTYuNzA3IDEuNTYgMS41NDMgMCAuODM1LS43MTUgMS41NDMtMS41NiAxLjU0M3oiLz4KPC9zdmc+Cg=="},1251:function(e,r,n){"use strict";n(15);var a=n(20);n(4),n(23),n(17),Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0,n(45),n(42),n(4),n(23),n(57),n(17);var o=a(n(36)),i=a(n(37)),l=a(n(55)),s=a(n(56)),u=a(n(51)),c=a(n(0)),d=a(n(3)),f=a(n(5043));function p(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,u.default)(e);if(t){var a=(0,u.default)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return(0,s.default)(this,r)}}var h=function(e){(0,l.default)(n,e);var r=p(n);function n(){return(0,o.default)(this,n),r.apply(this,arguments)}return(0,i.default)(n,[{key:"render",value:function(){var e=this.props,r=e.score,n=e.className;return void 0===r?c.default.createElement("span",null,c.default.createElement("span",{className:(0,d.default)(f.default.icon,f.default.nostatus,n)}),t("NO_STATUS")):r<=30?c.default.createElement("span",null,c.default.createElement("span",{className:(0,d.default)(f.default.icon,f.default.error,n)}),t("WARNING")):r>30&&r<=80?c.default.createElement("span",null,c.default.createElement("span",{className:(0,d.default)(f.default.icon,f.default.subhealth,n)}),t("SUB_HEALTHY")):c.default.createElement("span",null,c.default.createElement("span",{className:(0,d.default)(f.default.icon,f.default.health,n)}),t("HEALTHY"))}}]),n}(c.default.Component);r.default=h},1459:function(e,r,n){"use strict";n(15);var a=n(157),o=n(20);n(4),n(23),n(17),Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0,n(45),n(42),n(4),n(23),n(57),n(17);var i=o(n(30)),l=o(n(36)),s=o(n(37)),u=o(n(55)),c=o(n(56)),d=o(n(51)),f=a(n(0)),p=o(n(1)),h=o(n(3)),m=o(n(5048));function v(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,d.default)(e);if(t){var a=(0,d.default)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return(0,c.default)(this,r)}}var g=function(e){(0,u.default)(n,e);var r=v(n);function n(){return(0,l.default)(this,n),r.apply(this,arguments)}return(0,s.default)(n,[{key:"render",value:function(){var e=this.props,r=e.className,n=e.type,a=e.label,o=e.hasLabel,l=e.noBolder;return n?f.default.createElement("span",{className:(0,h.default)(m.default.status,(0,i.default)({},m.default.noBolder,l))},f.default.createElement("span",{className:(0,h.default)(m.default.status_icon,m.default[n.toLowerCase()],r)}),o&&t(a.toUpperCase())):"-"}}]),n}(f.PureComponent);r.default=g,g.propTypes={label:p.default.string,className:p.default.string,type:p.default.string,hasLabel:p.default.bool},g.defaultProps={type:"",label:"",hasLabel:!0}},1460:function(e,t,r){e.exports={blocker:"_13DzfBLFOcl0PkbaYOX_IL",rotate:"Qt2BndoO7EUdKwtN-hOtc",critical:"_34RT_yUY674mzuDu7R7SnE",info:"_293s8VCmuIgat-ocKVjiz8",major:"II1m5ywwwPjr4B9x4osmH",minor:"_1vir6Nk49PjpnZlBgElG-m",codeStatus:"_3vyWO-g1aIhi8WEUkqeDoi",status:"_2nb5BAvBLIBf1XeSRTohxv",type:"RSzYbc7X9wi3VPpAnBKvl",header:"_21iug7B2oBnbaMYUk1cbE-",title:"_3HJdy7bqoFMJ9OL9oD6fme",details:"_1EFtU6SxsqVpw9uEq6R7yq",content:"A-eoLIpA2_gligbYaPB7S",fileTitle:"nIhyXf2HKwkqzKczKwmLl",errorCard:"_3p5QrKOD_gQ7OYFVdM2p43",message:"_30aQZH0JvWk6-pz3ASP2ED","card-blocker":"_10H_dISVCyQUnX7DzaCw5t","card-critical":"_8-u2ig-VJ7fMfEopMHsl0","card-minor":"_3bLDFrnmI5omxaXpuslvI","card-info":"Dz7-_HLWnP9yOJx6SSb6H",titleShowMore:"_35etf_t4zY_L3qi074fSZV",displayAll:"_21pNhW5rKygDrZfFUrzhbB"}},1984:function(e,t,r){"use strict";r(15);var n=r(20);r(16),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,r(16);var a=r(186),o=n(r(321)),i=n(r(0)),l=r(52),s=r(72),u=r(143),c=n(r(5047)),d=function(e){var t=(0,o.default)(e.clustersDetail,"name"),r=e.destination,n=void 0===r?{}:r;(0,u.useEventValue)(u.eventKeys.HOST_CLUSTER_CHANGE,"");var d=t[(0,l.inCluster2Default)(n.name)]||{},f=n.namespace||"";return i.default.createElement("div",{className:c.default.wrapper},i.default.createElement("div",{className:c.default.tags},i.default.createElement(a.Tag,{key:d.name,type:s.CLUSTER_GROUP_TAG_TYPE[d.group]},i.default.createElement(a.Icon,{name:s.CLUSTER_PROVIDER_ICON[d.provider]||"kubernetes",size:16,type:"light"}),d.name?(0,l.showNameAndAlias)((0,l.inCluster2Default)(d.name),"cluster"):"default"),i.default.createElement("span",null,i.default.createElement(a.Icon,{name:"project",size:16,type:"dark"}),(0,l.showNameAndAlias)(f,"project"))))};t.default=d},1985:function(e,t,r){e.exports={table:"_2kRLkEVOqCUKzBIAdE_83T",card_content:"_3kRPEz6by7LmYIGQYPiu1y",icon:"_1SjrfgQTyLeQm9FP_xJP27",info:"_3HKXpm5f2PQvmQUhwyH_WF",name:"_2fx0MeyPaBwvI7QGcSuPS_",desc:"_3ReQfIWiUSifiPUFAe05f0"}},1986:function(e,r,n){"use strict";var a=n(20);n(12),n(5),n(11),n(6),n(18),n(87),n(48),n(16),n(27),n(9),n(13),n(10),n(4),n(23),n(24),n(17),n(136),n(75),n(7),Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0,n(12),n(45),n(5),n(11),n(6),n(160),n(18),n(28),n(87),n(48),n(191),n(42),n(16),n(159),n(27),n(34),n(15),n(9),n(13),n(10),n(4),n(319),n(22),n(23),n(57),n(17),n(75),n(7);var o=a(n(30)),i=a(n(43)),l=a(n(58));n(41);var s,u,c,d,f,p,h,m,v,g,y,b,E,S,D=a(n(44)),_=a(n(65)),k=a(n(36)),O=a(n(37)),w=a(n(88)),N=a(n(55)),P=a(n(56)),R=a(n(51)),C=a(n(49)),I=(a(n(66)),a(n(189))),L=a(n(60)),T=a(n(26)),A=a(n(63)),j=n(909),x=n(14),M=a(n(240)),U=n(52),F=a(n(323)),B=a(n(960));function Y(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function H(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Y(Object(r),!0).forEach((function(t){(0,o.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Y(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function J(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,R.default)(e);if(t){var a=(0,R.default)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return(0,P.default)(this,r)}}var z=(s=function(e){(0,N.default)(z,e);var r,n,a,o,s,P,R,C,F,Y=J(z);function z(){var e;return(0,k.default)(this,z),e=Y.call(this),(0,_.default)(e,"detail",u,(0,w.default)(e)),(0,_.default)(e,"devops",c,(0,w.default)(e)),(0,_.default)(e,"commitsList",d,(0,w.default)(e)),(0,_.default)(e,"artifactsList",f,(0,w.default)(e)),(0,_.default)(e,"isLoading",p,(0,w.default)(e)),(0,_.default)(e,"getNodesStatusLoading",h,(0,w.default)(e)),(0,_.default)(e,"nodesStatus",m,(0,w.default)(e)),(0,_.default)(e,"runDetail",v,(0,w.default)(e)),(0,_.default)(e,"runStartDetailLogs",g,(0,w.default)(e)),(0,_.default)(e,"logSize",y,(0,w.default)(e)),(0,_.default)(e,"overflow",b,(0,w.default)(e)),(0,_.default)(e,"hasMore",E,(0,w.default)(e)),e.hasMoreNotify=!1,(0,_.default)(e,"lastDetailLogs",S,(0,w.default)(e)),e.saveAsFile=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default.txt",r=new Blob([e],{type:"text/plain;charset=utf-8"});(0,j.saveAs)(r,t)},e.pipelineStore=new B.default,e}return(0,O.default)(z,[{key:"getUrl",value:function(e){var t=e.cluster,r=e.devops,n=e.name;return"".concat(this.getDevopsUrlV2({cluster:t,devops:r}),"pipelines/").concat(decodeURIComponent(n),"/")}},{key:"getRunUrl",value:function(e){var t=e.cluster,r=e.devops,n=e.name,a=e.branch,o=e.runId;return"".concat(this.getUrl({cluster:t,devops:r,name:n})).concat(a?"branches/".concat(encodeURIComponent(a),"/"):"","runs/").concat(o,"/")}},{key:"getCommits",value:(F=(0,D.default)(i.default.mark((function e(t){var r,n,a,o,s,u,c,d,f,p,h,m;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.name,n=t.branch,a=t.runName,o=t.devops,t.workspace,s=t.cluster,u=(0,l.default)(t,["name","branch","runName","devops","workspace","cluster"]),r=decodeURIComponent(r),c=u.page,d=u.limit,f=void 0===d?10:d,this.runDetail.id){e.next=6;break}return e.next=6,this.getRunDetail({devops:o,cluster:s,runName:a});case 6:return this.commitsList.isLoading=!0,e.next=9,request.get("".concat(this.getRunUrl({cluster:s,devops:o,name:r,branch:n,runId:this.runDetail.id})),{start:(c-1)*f||0,limit:f});case 9:p=e.sent,h=[],p.changeSet&&(0,L.default)(p.changeSet)?h=p.changeSet.map((function(e){return{commitId:(0,T.default)(e,"commitId"),startTime:(0,T.default)(e,"timestamp"),url:(0,T.default)(e,"url"),author:(0,T.default)(e,"author.fullName"),title:(0,T.default)(e,"msg")}})):p.pullRequest&&(m={commitId:(0,T.default)(p,"commitId"),startTime:(0,T.default)(p,"startTime"),url:(0,T.default)(p,"pullRequest.url"),author:(0,T.default)(p,"pullRequest.author"),title:(0,T.default)(p,"pullRequest.title")},h.push(m)),this.commitsList={data:h,limit:f,total:h.length,page:parseInt(c,10)||1,filters:(0,I.default)(u,"devops"),isLoading:!1,selectedRowKeys:[]};case 13:case"end":return e.stop()}}),e,this)}))),function(e){return F.apply(this,arguments)})},{key:"getArtifacts",value:(C=(0,D.default)(i.default.mark((function e(t){var r,n,a,o,s,u,c,d,f,p;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.devops,n=t.name,a=t.runName,o=t.branch,s=t.cluster,t.workspace,u=(0,l.default)(t,["devops","name","runName","branch","cluster","workspace"]),n=decodeURIComponent(n),c=u.page,d=u.limit,f=void 0===d?10:d,this.runDetail.id){e.next=6;break}return e.next=6,this.getRunDetail({devops:r,cluster:s,runName:a});case 6:return this.artifactsList.isLoading=!0,e.next=9,request.get("".concat(this.getRunUrl({cluster:s,devops:r,name:n,branch:o,runId:this.runDetail.id}),"artifacts/"),{start:(c-1)*f||0,limit:f});case 9:p=e.sent,this.artifactsList={data:p||[],pipeline:n,pipelineRun:a,total:p.length,limit:f,page:parseInt(c,10)||1,filters:(0,I.default)(u,"devops"),isLoading:!1,selectedRowKeys:[]};case 11:case"end":return e.stop()}}),e,this)}))),function(e){return C.apply(this,arguments)})},{key:"getNodesStatus",value:(R=(0,D.default)(i.default.mark((function e(t){var r,n,a,o,l,s,u=this;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.devops,n=t.name,a=t.branch,o=t.cluster,n=decodeURIComponent(n),this.getNodesStatusLoading=!0,e.next=5,request.get("".concat(this.getBaseUrl({cluster:o,namespace:r}),"pipelineruns/").concat(this.runDetail.name,"/nodedetails"));case 5:if(l=e.sent,(0,L.default)(l)){e.next=9;break}return this.getNodesStatusLoading=!1,e.abrupt("return");case 9:s=!(0,A.default)(l),this.nodesStatus=s?l.reduce((function(e,t,r){if(t.causeOfBlockage=u.runDetail.causeOfBlockage,"STAGE"===t.type){if(l[r+1]&&"PARALLEL"===l[r+1].type)return e.push([]),e;e.push(t)}else Array.isArray(e[e.length-1])?e[e.length-1].push(t):e.push([t]);return e}),[]):[],(!l||l.length<1)&&this.getRunStatusLogs({devops:r,name:n,branch:a,runId:this.runDetail.id,cluster:o}),this.getNodesStatusLoading=!1;case 13:case"end":return e.stop()}}),e,this)}))),function(e){return R.apply(this,arguments)})},{key:"getRunDetail",value:(P=(0,D.default)(i.default.mark((function e(t){var r,n,a,o,l=this;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.devops,n=t.cluster,a=t.runName,e.next=3,request.get("".concat(this.getBaseUrl({cluster:n,namespace:r}),"pipelineruns/").concat(a),null,null,function(){var e=(0,D.default)(i.default.mark((function e(r){var n;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(404!==r.status){e.next=6;break}return e.next=3,l.pipelineStore.fetchDetail(t);case 3:return n=e.sent,l.runDetail=n.latestRun||{},e.abrupt("return",(0,x.toJS)(l.runDetail));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 3:o=e.sent,this.runDetail=H(H({},(0,U.safeParseJSON)((0,T.default)(o,"metadata.annotations.['devops.kubesphere.io/jenkins-pipelinerun-status']"))),{},{name:(0,T.default)(o,"metadata.name"),_originData:o}),this.isLoading=!1;case 6:case"end":return e.stop()}}),e,this)}))),function(e){return P.apply(this,arguments)})},{key:"replay",value:(s=(0,D.default)(i.default.mark((function e(t,r){var n,a,o,l;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.devops,a=t.name,o=t.branch,l=t.cluster,e.next=3,request.post("".concat(this.getRunUrl({cluster:l,devops:n,name:a,branch:o,runId:r||this.runDetail.id}),"replay"));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return s.apply(this,arguments)})},{key:"getRunStatusLogs",value:(o=(0,D.default)(i.default.mark((function e(t){var r,n,a,o,l,s,u,c,d,f,p=this,h=arguments;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.devops,n=t.name,a=t.branch,o=t.runId,l=t.cluster,h.length>1&&void 0!==h[1]&&h[1]&&(this.logSize=0,this.runStartDetailLogs="",this.hasMore=!1),!this.overflow){e.next=11;break}return e.next=6,request.get("".concat(this.getRunUrl({cluster:l,devops:r,name:n,branch:a,runId:o}),"log/?thresholdInKB=150"));case 6:s=e.sent,this.hasMore=!0,this.lastDetailLogs="\n\n*****************************************************************\n* The log is too large, please download it to view the details. *\n*                                                               *\n* The following is the latest 150KB log.                        *\n*****************************************************************\n\n".concat(s),e.next=20;break;case 11:return u=this.logSize,c=u?"?start=".concat(u):"",e.next=15,request.get("".concat(this.getRunUrl({cluster:l,devops:r,name:n,branch:a,runId:o}),"log/").concat(c),{},{headers:{"x-with-headers":!0}});case 15:d=e.sent,(f=d.headers.get("x-text-size"))?(this.logSize=Number(f),this.hasMore=Boolean(d.headers.get("x-more-data"))):(this.logSize+=Number(d.headers.get("x-text-size")),this.hasMore=Boolean(d.headers.get("x-more-data"))),this.overflow=Boolean(d.headers.get("X-File-Size-Limit-Out"))||this.logSize>=10485760,d.text().then((function(e){if(0!==u){var t=p.runStartDetailLogs.slice(-100).split("\n");t.length>=2?(t.pop(),t.length&&t.pop().startsWith("Finished:")||(p.runStartDetailLogs+=e)):p.runStartDetailLogs+=e}else p.runStartDetailLogs=e}));case 20:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"handleJumpFullLogs",value:function(e){var t=e.devops,r=e.name,n=e.branch,a=e.cluster;r=decodeURIComponent(r);var o=(0,U.getClusterUrl)("".concat(window.location.protocol,"//").concat(window.location.host,"/").concat(this.getRunUrl({cluster:a,devops:t,name:r,branch:n,runId:this.runDetail.id}),"log/?start=0"));window.open(o)}},{key:"handleDownloadLogs",value:(a=(0,D.default)(i.default.mark((function e(t){var r,n,a,o,l,s;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.devops,n=t.name,a=t.branch,o=t.cluster,n=decodeURIComponent(n),l=(0,U.getClusterUrl)("".concat(window.location.protocol,"//").concat(window.location.host,"/").concat(this.getRunUrl({cluster:o,devops:r,name:n,branch:a,runId:this.runDetail.id}),"log/?start=0&download=true")),(s=document.createElement("a")).href=l,s.download="".concat(n,"-").concat(this.runDetail.id,"-").concat(this.runDetail.name,".log"),s.headers={"x-add-res-header":JSON.stringify({"Content-Disposition":"attachment; filename=".concat(n,"-").concat(this.runDetail.name,".log")})},s.click();case 8:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"handleProceed",value:(n=(0,D.default)(i.default.mark((function e(r){var n,a,o,l,s,u,c,d;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.parameters,a=r.devops,o=r.name,l=r.nodeId,s=r.branch,u=r.cluster,c=r.stepId,d=r.inputId,e.next=3,request.post("".concat(this.getRunUrl({cluster:u,devops:a,name:o,branch:s,runId:this.runDetail.id}),"nodes/").concat(l,"/steps/").concat(c,"/"),{id:d,parameters:n},null,(function(e){if(400===e.status)return M.default.error({content:t("Sorry, you don't have the permission to do this.")}),!0}));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"handleBreak",value:(r=(0,D.default)(i.default.mark((function e(t){var r,n,a,o,l,s,u;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.devops,n=t.name,a=t.nodeId,o=t.branch,l=t.stepId,s=t.inputId,u=t.cluster,e.next=3,request.post("".concat(this.getRunUrl({cluster:u,devops:r,name:n,branch:o,runId:this.runDetail.id}),"nodes/").concat(a,"/steps/").concat(l,"/"),{id:s,abort:!0});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"runDetailLogs",get:function(){return this.runStartDetailLogs+this.lastDetailLogs}}]),z}(F.default),u=(0,C.default)(s.prototype,"detail",[x.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{}}}),c=(0,C.default)(s.prototype,"devops",[x.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),d=(0,C.default)(s.prototype,"commitsList",[x.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{data:[],page:1,limit:10,total:0,order:"",reverse:!1,filters:{},isLoading:!0}}}),f=(0,C.default)(s.prototype,"artifactsList",[x.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{data:[],page:1,limit:10,total:0,order:"",reverse:!1,filters:{},isLoading:!0}}}),p=(0,C.default)(s.prototype,"isLoading",[x.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),h=(0,C.default)(s.prototype,"getNodesStatusLoading",[x.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),m=(0,C.default)(s.prototype,"nodesStatus",[x.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),v=(0,C.default)(s.prototype,"runDetail",[x.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{}}}),g=(0,C.default)(s.prototype,"runStartDetailLogs",[x.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),y=(0,C.default)(s.prototype,"logSize",[x.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),b=(0,C.default)(s.prototype,"overflow",[x.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),E=(0,C.default)(s.prototype,"hasMore",[x.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),S=(0,C.default)(s.prototype,"lastDetailLogs",[x.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),(0,C.default)(s.prototype,"runDetailLogs",[x.computed],Object.getOwnPropertyDescriptor(s.prototype,"runDetailLogs"),s.prototype),(0,C.default)(s.prototype,"getCommits",[x.action],Object.getOwnPropertyDescriptor(s.prototype,"getCommits"),s.prototype),(0,C.default)(s.prototype,"getArtifacts",[x.action],Object.getOwnPropertyDescriptor(s.prototype,"getArtifacts"),s.prototype),(0,C.default)(s.prototype,"getNodesStatus",[x.action],Object.getOwnPropertyDescriptor(s.prototype,"getNodesStatus"),s.prototype),(0,C.default)(s.prototype,"getRunDetail",[x.action],Object.getOwnPropertyDescriptor(s.prototype,"getRunDetail"),s.prototype),(0,C.default)(s.prototype,"getRunStatusLogs",[x.action],Object.getOwnPropertyDescriptor(s.prototype,"getRunStatusLogs"),s.prototype),s);r.default=z},1987:function(e,t,r){e.exports={container:"_35WQzILk2k5A-TNfwYc_Yu",dialogTitle:"_1HnTmMa63mLPJxN-kG6XQ8",left:"_2XPYd3NGh15jZRYWm5MNuU",right:"_3bKVu0q_0smLvLQ_xG_Cv5",cutTitle:"ujjupzCK4LMn0keQ15_R8",activeTitle:"_2296EshHppYY33xDrhOYkt",leftTab:"_1kG5fSh5j7HcCSYKps6oTh",leftTab__active:"_1IuH08t3ULSDQt0OqOGwBK",header:"_2Tookjj2Zw9AgDikbYKJgg",stageContainer:"_3GP4euDRBvjXvD0nK9K-r_",logContainer:"onNirjkuD2zuU4-stBH7e",LogItem:"_1HiUEMOLNi-k2C1DaLfIDk",LogItem__title:"_3Mx5xDEpJpN64NOn7P22sS",logitem_status:"wuI80Au-XWNGZUq-w40Ws",LogItem_content:"lOqJTK8ZNeB12AT7uaQXu",logs_container:"_2Vmm2M8PYlz2yPzrtbc7b"}},1988:function(e,t,r){e.exports={content:"_2GZWNwDmCMaUPILAUqPNQf",totalResult:"NBt7KR1xy9O8EawT3vX2",icon:"bz27u9MKO5MCTXeL-tJVR",otherCards:"_1rtnO6pnjP7HJRT0QGouIq",resultCard:"_15y85A7WyXG0tLQtqF7fax",title:"_2m2EwcYwfu9p6-CO4u0fah",value:"_2fh_XN43MPIMM0V9x1RSAV",unit:"_3bIiaxdLQLPwa4eam-lmZ_",success:"z32XC06-_4svuDjqBkmAz",error:"_1knC_oFwHb1CGb5_vEcgo9",A:"_1SiVVmpdCPUHST_165zQf9",B:"_2PpecDw-rYu6sMpW5eRcV",C:"_1cGPrOnT-V5vNe6maN_jp6",D:"_152jN-TAnzt_qQbaldEyqd",logo:"_25dzrJDupH8xequ0ccrNoC"}},1989:function(e,r,n){"use strict";n(15);var a=n(157),o=n(20);n(4),n(23),n(17),Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0,n(45),n(42),n(4),n(23),n(57),n(17);var i=o(n(36)),l=o(n(37)),s=o(n(55)),u=o(n(56)),c=o(n(51)),d=a(n(0)),f=o(n(1)),p=o(n(3)),h=o(n(1460));function m(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,c.default)(e);if(t){var a=(0,c.default)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return(0,u.default)(this,r)}}var v=function(e){(0,s.default)(n,e);var r=m(n);function n(){return(0,i.default)(this,n),r.apply(this,arguments)}return(0,l.default)(n,[{key:"render",value:function(){var e=this.props,r=e.errorClass,n=e.className;return d.default.createElement("span",{className:h.default.codeStatus},d.default.createElement("span",{className:(0,p.default)("codequality-icon",h.default[r],n)}),t(r.toUpperCase()))}}]),n}(d.PureComponent);r.default=v,v.propTypes={errorClass:f.default.string,className:f.default.string},v.defaultProps={errorClass:"",className:""}},1990:function(e,r,n){"use strict";n(15);var a=n(157),o=n(20);n(5),n(84),n(18),n(16),n(4),n(23),n(24),n(17),n(85),n(62),Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0,n(45),n(5),n(84),n(18),n(42),n(16),n(4),n(23),n(57),n(24),n(17),n(85),n(62);var i=o(n(36)),l=o(n(37)),s=o(n(55)),u=o(n(56)),c=o(n(51)),d=a(n(0)),f=n(14),p=n(239),h=n(433),m=n(186),v=o(n(1251)),g=n(1144),y=o(n(5105));function b(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,c.default)(e);if(t){var a=(0,c.default)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return(0,u.default)(this,r)}}var E=function(e){(0,s.default)(n,e);var r=b(n);function n(){return(0,i.default)(this,n),r.apply(this,arguments)}return(0,l.default)(n,[{key:"renderBaseInfo",value:function(){var e=this.props.detailStore.detail;return d.default.createElement(m.Columns,{className:y.default.baseInfo},d.default.createElement(m.Column,{className:y.default.baseInfo__item},d.default.createElement("div",{className:y.default.dashboardValue},d.default.createElement(v.default,{score:e.weatherScore})),d.default.createElement("div",{className:y.default.dashboardLable},t("HEALTH_STATUS_SCAP"))),this.isMultibranch?d.default.createElement(m.Column,{className:y.default.baseInfo__item},d.default.createElement("div",{className:y.default.dashboardValue},d.default.createElement(g.ReactComponent,{style:{width:"20px",height:"20px"}})," ",e.totalNumberOfBranches||"-"),d.default.createElement("div",{className:y.default.dashboardLable},e.totalNumberOfBranches&&1===e.totalNumberOfBranches?t("BRANCH_SI"):t("BRANCH_PL"))):null,d.default.createElement(m.Column,{className:y.default.baseInfo__item}))}},{key:"renderNavLink",value:function(e){var r=e.name,n=e.title,a=this.props,o=a.detailStore,i=a.sonarqubeStore,l=this.enabledActions.includes("edit");if(!r)return null;if(o&&i){if((!l||this.isMultibranch)&&"pipeline"===r)return null;if(!i.detail.totalStatus&&"code-quality"===r)return null;if(!this.isMultibranch&&"branch"===r)return null;if(!o.detail.totalNumberOfPullRequests&&"pull-request"===r)return null}return d.default.createElement(h.NavLink,{key:r,className:y.default.navItem,activeClassName:y.default.active,to:"".concat(this.props.match.url,"/").concat(r)},t(n))}},{key:"render",value:function(){var e=this,t=this.props.route;return d.default.createElement(d.default.Fragment,null,this.renderBaseInfo(),d.default.createElement("div",{className:y.default.nav},t.routes.map((function(t){return e.renderNavLink(t)}))))}},{key:"enabledActions",get:function(){var e=this.props.match.params,t=e.cluster,r=e.devops;return globals.app.getActions({module:"pipelines",cluster:t,devops:r})}},{key:"isMultibranch",get:function(){var e=this.props.detailStore;return(0,f.toJS)(e.detail.isMultiBranch)}}]),n}(d.Component);E.defaultProps={module:""};var S=(0,p.inject)("rootStore")((0,p.observer)(E));r.default=S},1991:function(e,t,r){"use strict";r(15);var n=r(20);r(5),r(18),r(16),r(4),r(22),r(196),r(23),r(17),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,r(45),r(5),r(18),r(42),r(16),r(4),r(22),r(196),r(23),r(57),r(17);var a=n(r(43));r(41);var o,i,l,s,u=n(r(44)),c=n(r(65)),d=n(r(36)),f=n(r(88)),p=n(r(55)),h=n(r(56)),m=n(r(51)),v=n(r(49)),g=(n(r(66)),n(r(60))),y=r(14),b=n(r(105));function E(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,m.default)(e);if(t){var a=(0,m.default)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return(0,h.default)(this,r)}}var S=(o=function(e){(0,p.default)(r,e);var t=E(r);function r(){var e;(0,d.default)(this,r);for(var n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return e=t.call.apply(t,[this].concat(a)),(0,c.default)(e,"detail",i,(0,f.default)(e)),(0,c.default)(e,"isLoading",l,(0,f.default)(e)),(0,c.default)(e,"fetchDetail",s,(0,f.default)(e)),e}return r}(n(r(323)).default),i=(0,v.default)(o.prototype,"detail",[y.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{}}}),l=(0,v.default)(o.prototype,"isLoading",[y.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),s=(0,v.default)(o.prototype,"fetchDetail",[y.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){var t=(0,u.default)(a.default.mark((function t(r){var n,o,i,l,s,u,c;return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=r.devops,o=r.branch,i=r.name,l=r.cluster,s="",s=o?"".concat(e.getDevopsUrlV2({cluster:l,devops:n}),"pipelines/").concat(i,"/branches/").concat(encodeURIComponent(o),"/sonarstatus "):"".concat(e.getDevopsUrlV2({cluster:l,devops:n}),"pipelines/").concat(i,"/sonarstatus"),e.isLoading=!0,t.next=6,request.get(s,null,null,(function(){return"no  sonarqube"})).finally((function(){e.isLoading=!1}));case 6:u=t.sent,c=(0,g.default)(u)?u:[],e.detail=c.length?c.map(b.default.codequality)[0]:{};case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}}),o);t.default=S},1992:function(e,t,r){e.exports={branchIcon:"_24Aiyvv5IBkO77t2wEOSLk",loading:"_2b9DaSPDyZsY6mK-iSVHXW"}},5030:function(e,t,r){"use strict";r(15);var n=r(20);r(5),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,r(5);var a=n(r(61)),o=r(317),i=n(r(5031)),l=n(r(5032)),s=n(r(5042)),u=n(r(5044)),c=n(r(5050)),d=n(r(5052)),f=n(r(5055)),p=n(r(5056)),h=n(r(5057)),m=n(r(5059)),v="/:workspace/clusters/:cluster/devops/:devops",g=[{path:v,component:i.default,routes:[].concat((0,a.default)(m.default),[{path:v,component:l.default,routes:[{path:"".concat(v,"/pipelines"),component:s.default,exact:!0},{path:"".concat(v,"/cd"),component:u.default,exact:!0},{path:"".concat(v,"/code-repo"),component:c.default,exact:!0},{path:"".concat(v,"/base-info"),component:d.default,exact:!0},{path:"".concat(v,"/roles"),component:f.default,exact:!0},{path:"".concat(v,"/members"),component:p.default,exact:!0},{path:"".concat(v,"/credentials"),component:h.default,exact:!0}]},(0,o.getIndexRoute)({path:"*",to:"/404",exact:!0})])}];t.default=g},5031:function(e,t,r){"use strict";r(15);var n=r(20),a=r(157);r(11),r(29),r(97),r(16),r(10),r(4),r(22),r(23),r(24),r(17),r(111),r(38),r(62),r(32),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,r(45),r(11),r(29),r(97),r(42),r(16),r(10),r(4),r(22),r(23),r(57),r(24),r(17),r(111),r(38),r(62),r(32);var o=n(r(43));r(41);var i,l=n(r(44)),s=n(r(36)),u=n(r(37)),c=n(r(55)),d=n(r(56)),f=n(r(51)),p=r(186),h=n(r(241)),m=n(r(74)),v=r(14),g=r(239),y=a(r(0)),b=n(r(438)),E=n(r(323)),S=r(147),D=r(143),_=r(317);function k(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,f.default)(e);if(t){var a=(0,f.default)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return(0,d.default)(this,r)}}var O=(0,g.inject)("rootStore")(i=(0,g.observer)(i=function(e){(0,c.default)(n,e);var t,r=k(n);function n(e){var t;return(0,s.default)(this,n),(t=r.call(this,e)).state={fetchFin:!0},t.getHostCluster=(0,l.default)(o.default.mark((function e(){var r,n,a,i;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.clusterStore.fetchList({labelSelector:"cluster-role.kubesphere.io/host=",limit:-1});case 2:a=e.sent,i=(0,v.toJS)(a).filter((function(e){return Object.keys(e.labels).some((function(e){return e.endsWith("cluster-role.kubesphere.io/host")}))})),t.store.hostName=null!==(r=null===(n=i[0])||void 0===n?void 0:n.name)&&void 0!==r?r:"host",t.store.hostDetail=i[0];case 6:case"end":return e.stop()}}),e)}))),t.store=new E.default,t.clusterStore=new b.default,t.rootStore=e.rootStore,t}return(0,u.default)(n,[{key:"componentDidMount",value:function(){this.init()}},{key:"componentDidUpdate",value:function(e){e.match.params.cluster===this.cluster&&e.match.params.devops===this.devops||this.init()}},{key:"init",value:(t=(0,l.default)(o.default.mark((function e(){var t;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.store.initializing=!0,t={cluster:this.cluster,devops:this.devops,workspace:this.workspace},e.next=4,Promise.all([this.store.fetchDetail(t),this.clusterStore.fetchDetail({name:t.cluster}),this.props.rootStore.getRules({workspace:this.workspace,cluster:t.cluster}),this.getHostCluster()]);case 4:return S.eventBus.emit(D.eventKeys.DEVOPS_CHANGE,(0,v.toJS)(this.store.detail)),e.next=7,this.props.rootStore.getRules(t);case 7:(0,m.default)(globals,"clusterConfig.".concat(t.cluster),this.clusterStore.detail.configz),globals.app.cacheHistory(this.props.match.url,{type:"DevOps",name:this.store.data.name,aliasName:this.store.data.aliasName,cluster:(0,h.default)(this.clusterStore.detail,["name","aliasName","group","provider"])}),this.store.initializing=!1;case 10:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"render",value:function(){return this.store.initializing?y.default.createElement(p.Loading,{className:"ks-page-loading"}):y.default.createElement(g.Provider,{devopsStore:this.store},(0,_.renderRoutes)(this.props.route.routes))}},{key:"cluster",get:function(){return this.props.match.params.cluster}},{key:"devops",get:function(){return this.props.match.params.devops}},{key:"workspace",get:function(){return this.props.match.params.workspace}},{key:"routing",get:function(){return this.props.rootStore.routing}}]),n}(y.Component))||i)||i;t.default=O},5032:function(e,r,n){"use strict";n(15);var a=n(20),o=n(157);n(5),n(11),n(18),n(16),n(4),n(23),n(24),n(17),n(62),Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0,n(45),n(5),n(11),n(18),n(28),n(42),n(16),n(4),n(23),n(57),n(24),n(17),n(62);var i,l=a(n(61)),s=a(n(36)),u=a(n(37)),c=a(n(55)),d=a(n(56)),f=a(n(51)),p=n(186),h=n(1076),m=a(n(26)),v=n(239),g=a(n(5033)),y=o(n(0)),b=n(317),E=a(n(5041));function S(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,f.default)(e);if(t){var a=(0,f.default)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return(0,d.default)(this,r)}}var D=(0,v.inject)("rootStore","devopsStore")(i=(0,v.observer)(i=function(e){(0,c.default)(n,e);var r=S(n);function n(){var e;(0,s.default)(this,n);for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return(e=r.call.apply(r,[this].concat(a))).handleChange=function(t){return e.routing.push(t)},e}return(0,u.default)(n,[{key:"render",value:function(){var e,r,n=this.props,a=n.match,o=n.route,i=n.location,s=this.props.devopsStore,u=s.initializing,c=s.detail,d=globals.app.getDevOpsNavs({devops:this.devops,cluster:this.cluster,workspace:this.workspace}),f=[{cate:"",items:null!==(e=null==d||null===(r=d[0])||void 0===r?void 0:r.children)&&void 0!==e?e:[]}],v=this.isHostCluster?f:f.map((function(e){var t=e.items.filter((function(e){return"cd"!==e.name}));return e.items=t,e})),S=(0,m.default)(v,"[0].items[0].name","management"),D="management"===S?"base-info":S;return u?y.default.createElement(p.Loading,{className:E.default.loading}):y.default.createElement("div",{className:"ks-page"},y.default.createElement("div",{className:"ks-page-side",style:{zIndex:99}},y.default.createElement(g.default,{type:"devops",title:t("DEVOPS_PROJECT_LOW"),detail:c,onChange:this.handleChange,workspace:this.workspace,cluster:this.cluster}),y.default.createElement(h.Nav,{className:"ks-page-nav",navs:v,location:i,match:a})),y.default.createElement("div",{className:"ks-page-main"},(0,b.renderRoutes)([].concat((0,l.default)(o.routes),[(0,b.getIndexRoute)({path:o.path,to:"".concat(o.path,"/").concat(D),exact:!0})]),{isHostCluster:this.isHostCluster})))}},{key:"workspace",get:function(){return this.props.match.params.workspace}},{key:"cluster",get:function(){return this.props.match.params.cluster}},{key:"devops",get:function(){return this.props.match.params.devops}},{key:"routing",get:function(){return this.props.rootStore.routing}},{key:"isHostCluster",get:function(){var e,t;return!(null===(e=window.parent)||void 0===e||null===(t=e.globals)||void 0===t?void 0:t.app.isMultiCluster)||this.cluster===this.props.devopsStore.hostName}}]),n}(y.Component))||i)||i;r.default=D},5033:function(e,t,r){"use strict";r(15);var n=r(20);r(12),r(109),r(4),r(23),r(17),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,r(12),r(109),r(45),r(42),r(4),r(23),r(57),r(17);var a=n(r(36)),o=n(r(37)),i=n(r(55)),l=n(r(56)),s=n(r(51)),u=r(186),c=n(r(5034)),d=n(r(1)),f=n(r(0)),p=r(52),h=n(r(5040));function m(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,s.default)(e);if(t){var a=(0,s.default)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return(0,l.default)(this,r)}}var v=function(e){(0,i.default)(r,e);var t=m(r);function r(e){var n;return(0,a.default)(this,r),(n=t.call(this,e)).showSelect=function(){n.setState({showSelect:!0})},n.hideSelect=function(){n.setState({showSelect:!1})},n.handleSelect=function(e){var t=n.props.onChange;n.hideSelect(),t(e)},n.state={showSelect:!1},n}return(0,o.default)(r,[{key:"render",value:function(){var e=this.props,t=e.title,r=e.type,n=e.detail,a=e.isEdge,o=n.description,i=n.cluster,l=n.workspace,s=this.state.showSelect;return f.default.createElement("div",null,f.default.createElement("div",{className:h.default.titleWrapper,onClick:this.showSelect},f.default.createElement("div",{className:h.default.icon},f.default.createElement(u.Icon,{name:"devops"===r?"strategy-group":"project",size:40,type:"light"})),f.default.createElement("div",{className:h.default.text},f.default.createElement("div",{className:"h6",title:(0,p.showNameAndAlias)(n)},(0,p.getDomTitle)((0,p.showNameAndAlias)(n))),f.default.createElement("p",null,(0,p.getDomTitle)(o||t)))),f.default.createElement(c.default,{defaultType:r,cluster:i,workspace:l||this.props.workspace,isEdge:a,visible:s,onChange:this.handleSelect,onCancel:this.hideSelect}))}}]),r}(f.default.Component);t.default=v,v.propTypes={detail:d.default.object,isEdge:d.default.bool,onChange:d.default.func},v.defaultProps={type:"projects",detail:{},onChange:function(){}}},5034:function(e,r,n){"use strict";var a=n(20);n(12),n(5),n(11),n(31),n(6),n(84),n(18),n(48),n(16),n(9),n(13),n(10),n(4),n(23),n(24),n(17),n(85),n(188),n(7),Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0,n(12),n(45),n(5),n(11),n(31),n(6),n(84),n(18),n(28),n(48),n(42),n(16),n(34),n(15),n(9),n(13),n(10),n(4),n(23),n(57),n(24),n(17),n(85),n(188),n(7);var o,i=a(n(30)),l=a(n(36)),s=a(n(37)),u=a(n(55)),c=a(n(56)),d=a(n(51)),f=n(186),p=a(n(3)),h=a(n(787)),m=a(n(863)),v=a(n(915)),g=a(n(26)),y=n(14),b=n(239),E=a(n(0)),S=a(n(323)),D=a(n(439)),_=a(n(493)),k=a(n(445)),O=n(52),w=a(n(5035)),N=a(n(5037)),P=a(n(5039));function R(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function C(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,d.default)(e);if(t){var a=(0,d.default)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return(0,c.default)(this,r)}}var I=(0,b.inject)("rootStore")(o=(0,b.observer)(o=function(e){(0,u.default)(n,e);var r=C(n);function n(e){var a;return(0,l.default)(this,n),(a=r.call(this,e)).fetchData=function(e){var t=a.props.workspace,r=a.state,n=r.cluster,o=r.search,l=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?R(Object(r),!0).forEach((function(t){(0,i.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):R(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({workspace:t},e);"federatedprojects"===a.state.type?l.labelSelector="kubesphere.io/workspace=".concat(t):l.cluster=n,o&&(l.name=o),a.stores[a.state.type].fetchList(l)},a.handleRefresh=function(){return a.fetchData()},a.handleTypeChange=function(e){a.state.type!==e&&a.setState({type:e,search:""},a.fetchData)},a.handleClusterChange=function(e){a.setState({cluster:e,search:""},a.fetchData)},a.handleEnterWorkspace=function(){var e=a.props,t=e.workspace;return(0,e.onChange)("/workspaces/".concat(t))},a.handleOnEnter=function(e){var t=a.props,r=t.workspace,n=t.onChange,o=a.state.cluster;"projects"===a.state.type?n("/".concat(r,"/clusters/").concat(o,"/projects/").concat(e.name)):"federatedprojects"===a.state.type?n("/".concat(r,"/federatedprojects/").concat(e.name)):e.namespace&&o&&n("/".concat(r,"/clusters/").concat(o,"/devops/").concat(e.namespace))},a.clusterRenderer=function(e){return t("CLUSTER_VALUE",{value:e.label})},a.showCreate=function(){var e=a.props,t=e.workspace,r=e.rootStore,n=e.isEdge,o=a.state.cluster;"projects"===a.state.type?r.triggerAction("project.create",{store:a.projectStore,workspace:t,isEdgeWize:n,type:n?"edge":void 0,defaultCluster:o,success:function(){return a.fetchData()}}):"federatedprojects"===a.state.type?r.triggerAction("federated.project.create",{store:a.projectStore,workspace:t,clusters:a.store.clusters.data.slice(),success:function(){return a.fetchData()}}):r.triggerAction("devops.create",{store:a.devopsStore,cluster:o,workspace:t,success:function(){return a.fetchData()}})},a.store=new k.default,a.projectStore=new D.default,a.fedProjectStore=new _.default({module:"namespaces"}),a.devopsStore=new S.default,a.stores={devops:a.devopsStore,federatedprojects:a.fedProjectStore,projects:a.projectStore},a.state={type:e.defaultType||"projects",cluster:e.cluster||"",search:"",filters:{}},a}return(0,s.default)(n,[{key:"componentDidMount",value:function(){var e=this;this.store.fetchDetail({workspace:this.props.workspace}),this.store.fetchClusters({workspace:this.props.workspace}).then((function(){e.state.cluster||e.setState({cluster:(0,g.default)(e.store.clusters,"data[0].name","")})}))}},{key:"render",value:function(){var e=this,r=this.props,n=r.visible,a=r.workspace,o=r.onCancel,l=this.state,s=l.type,u=l.cluster,c=this.store.detail,d=this.stores[s].list,b=(0,y.toJS)(d),S=b.data,D=b.total,_=b.page,k=b.isLoading,R=globals.app.isMultiCluster&&"federatedprojects"!==s;return E.default.createElement(h.default,{bodyClassName:P.default.body,visible:n,onCancel:o,width:960,icon:"enterprise",title:E.default.createElement("a",{onClick:this.handleEnterWorkspace},(0,O.showNameAndAlias)(a,"workspace")),description:(0,g.default)(c,"description")||t("WORKSPACE"),hideFooter:!0},E.default.createElement("div",{className:P.default.bar},E.default.createElement(f.Columns,{className:"is-variable is-1"},E.default.createElement(f.Column,{className:"is-narrow"},E.default.createElement(f.RadioGroup,{mode:"button",value:s,options:this.types,onChange:this.handleTypeChange})),E.default.createElement(f.Column,null,E.default.createElement("div",{className:P.default.searchWrapper},R&&E.default.createElement(N.default,{className:P.default.cluster,options:this.clusters,value:u,onChange:this.handleClusterChange}),E.default.createElement(v.default,{className:(0,p.default)(P.default.search,(0,i.default)({},P.default.withSelect,R)),placeholder:t("SEARCH_BY_NAME"),columns:this.columns,contentClassName:P.default.content,onChange:function(t){e.setState({filters:t}),e.fetchData(t)},filters:this.state.filters}))),E.default.createElement(f.Column,{className:"is-narrow"},E.default.createElement("div",null,E.default.createElement(f.Button,{icon:"refresh",type:"flat",onClick:this.handleRefresh}),this.canCreate&&E.default.createElement(f.Button,{type:"control",onClick:this.showCreate},t("CREATE_PROJECT")))))),E.default.createElement("div",{className:P.default.list},E.default.createElement(m.default,{wrapperClassName:P.default.listWrapper,data:S,total:D,page:_,loading:k,onFetch:this.fetchData},S.map((function(t){return E.default.createElement(w.default,{key:t.uid||t.devops,data:t,type:s,onEnter:e.handleOnEnter})})))))}},{key:"clusters",get:function(){return this.store.clusters.data.map((function(e){return{label:(0,O.showNameAndAlias)(e),value:e.name,cluster:e,disabled:!e.isReady,ksVersion:(0,g.default)(e,"configz.ksVersion")}}))}},{key:"enabledActions",get:function(){var e=this.props.workspace;return{projects:globals.app.getActions({workspace:e,module:"projects"}),federatedprojects:globals.app.getActions({workspace:e,module:"federatedprojects"}),devops:globals.app.getActions({workspace:e,module:"devops"})}}},{key:"types",get:function(){this.props.isEdge;var e=[{label:t("PROJECT_PL"),value:"projects"}];return globals.app.hasKSModule("devops")&&e.push({label:t("DEVOPS_PROJECT_PL"),value:"devops"}),e}},{key:"canCreate",get:function(){return this.enabledActions[this.state.type].includes("create")}},{key:"columns",get:function(){var e,r=this.state.cluster,n=null===(e=this.clusters.find((function(e){return e.value===r})))||void 0===e?void 0:e.ksVersion,a=(0,O.compareVersion)(n,"3.4.0")>=0;return[{dataIndex:"name",title:t("NAME"),search:!0},{dataIndex:"alias",title:t("ALIAS"),search:a}]}}]),n}(E.default.Component))||o)||o;r.default=I},5035:function(e,r,n){"use strict";n(15);var a=n(20);n(12),n(109),n(5),n(16),n(4),n(23),n(17),Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0,n(12),n(109),n(45),n(5),n(42),n(16),n(4),n(23),n(57),n(17);var o=a(n(30)),i=a(n(36)),l=a(n(37)),s=a(n(55)),u=a(n(56)),c=a(n(51)),d=a(n(3)),f=a(n(812)),p=a(n(0)),h=n(52),m=a(n(5036));function v(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,c.default)(e);if(t){var a=(0,c.default)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return(0,u.default)(this,r)}}var g=function(e){(0,s.default)(n,e);var r=v(n);function n(){var e;(0,i.default)(this,n);for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return(e=r.call.apply(r,[this].concat(a))).handleClick=function(){var t=e.props,r=t.onEnter,n=t.data;"Terminating"!==n.status&&r&&r(n)},e}return(0,l.default)(n,[{key:"render",value:function(){var e,r,n,a,i,l=this.props,s=l.type,u=l.data;"devops"===s?(e=(0,h.getDisplayNameNew)(u),r=u.description||"-",a=u.creator,i=u.create_time||u.createTime,n="strategy-group"):(e=(0,h.getDisplayNameNew)(u),r=u.description||"-",a=u.creator,i=u.createTime,n="project");var c="Terminating"===u.status||"Pending"===u.status;e=p.default.createElement("div",{className:(0,d.default)(m.default.name,"ellipsis"),title:e},c?e:p.default.createElement("a",null,e)),r=c?t(u.status):r;var v=[{title:a||"-",description:t("CREATOR")},{title:(0,h.getLocalTime)(i).format("YYYY-MM-DD HH:mm:ss"),description:t("CREATION_TIME")}];return p.default.createElement(f.default.Item,{className:(0,d.default)(m.default.wrapper,(0,o.default)({},m.default.disabled,c)),icon:n,title:e,description:r,details:v,onClick:this.handleClick,withDomDesc:!0})}}]),n}(p.default.Component);r.default=g},5036:function(e,t,r){e.exports={wrapper:"_1o-dLqKI-OH4t32JiuQvJY",name:"_1fvTeU1MWd8KC6683FmppW",disabled:"_39NvLo_HIDH6IBoxJleggI"}},5037:function(e,r,n){"use strict";n(15);var a=n(157),o=n(20);n(5),n(31),n(18),n(4),n(23),n(17),Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0,n(45),n(5),n(31),n(18),n(42),n(4),n(23),n(57),n(17);var i=o(n(36)),l=o(n(37)),s=o(n(55)),u=o(n(56)),c=o(n(51)),d=n(186),f=o(n(3)),p=a(n(0)),h=o(n(5038));function m(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,c.default)(e);if(t){var a=(0,c.default)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return(0,u.default)(this,r)}}var v=function(e){(0,s.default)(n,e);var r=m(n);function n(){var e;(0,i.default)(this,n);for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return(e=r.call.apply(r,[this].concat(a))).handleOptionsClick=function(t,r){e.props.onChange(r)},e}return(0,l.default)(n,[{key:"renderOptions",value:function(){var e=this.props.options;return p.default.createElement(d.Menu,{className:h.default.options,onClick:this.handleOptionsClick},e.map((function(e){return p.default.createElement(d.Menu.MenuItem,{key:e.value},p.default.createElement("p",{className:h.default.text,title:e.label},e.label))})))}},{key:"renderControl",value:function(){var e,r=this.props,n=r.className,a=r.value,o=r.options;return p.default.createElement("div",{className:(0,f.default)(h.default.value,n)},p.default.createElement("span",{className:h.default.label},t("CLUSTER_VALUE",{value:null===(e=o.find((function(e){return e.value===a})))||void 0===e?void 0:e.label})),p.default.createElement(d.Icon,{className:h.default.rightIcon,name:"chevron-down",type:"light"}))}},{key:"render",value:function(){return p.default.createElement(d.Dropdown,{theme:"dark",content:this.renderOptions(),positionFixed:!0},this.renderControl())}}]),n}(p.Component);r.default=v},5038:function(e,t,r){e.exports={value:"iBgrlTIhhAdr3v61tBxdM",label:"_1z-9CsuPcDy1VL0YsaYR-s",options:"_2vXhJuxyjWA4U134IsKQTP",text:"_1Qmy7kYO3SD5A2kJnDO8qH",rightIcon:"_2_PtISrc4aj41nwe98JFV3"}},5039:function(e,t,r){e.exports={body:"_2AWoITZgzreiyZ84HirO03",bar:"_2_dobDyawM5i7WFX4Pup8j",list:"_1ya--9RrTtuKNNEfHLgcU_",listWrapper:"o59euknBKGaDOtAOhABOi",card:"_2VdFH0ObA_bD1RiXzhvXgx",icon:"_3k9RIViku44Wpl-tcRCZbE",searchWrapper:"_1465G-ETjO63lwyecrWvsT",cluster:"_1j-z5K_z6AgrvVu5HInadf",search:"_3W-5EzkFumEt2ngSqWa8WF",withSelect:"_3jQhkjoq19tUDivCgH4nzH",content:"_37mXZsJu8x9TqnagDZeqIc"}},5040:function(e,t,r){e.exports={titleWrapper:"_1NfEC1exUIceM5clopym0J",icon:"_3rLxoKal79OdPz1zBQBf9S",text:"wM2M-arc1xW7_ACwyslzX",tag:"xoa4DtjhuMe0YrY54vNG8"}},5041:function(e,t,r){e.exports={avatar:"_3TKi0Q5Bxum0Ec5SHNSp3Y",bannerIcon:"_3Ije7cozVOJv_F7JGXxSYG",loading:"_3c1wvmQdtajc5fBMugbx8f"}},5042:function(e,r,n){"use strict";var a=n(20);n(12),n(5),n(11),n(31),n(6),n(84),n(16),n(9),n(13),n(10),n(4),n(23),n(24),n(17),n(111),n(85),n(62),n(7),n(110),Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0,n(12),n(45),n(5),n(11),n(31),n(6),n(84),n(28),n(42),n(16),n(34),n(15),n(9),n(13),n(10),n(4),n(22),n(23),n(57),n(24),n(17),n(111),n(85),n(62),n(7),n(110);var o=a(n(315)),i=a(n(43));n(41);var l,s=a(n(44)),u=a(n(30)),c=a(n(36)),d=a(n(37)),f=a(n(55)),p=a(n(56)),h=a(n(51)),m=n(186),v=a(n(240)),g=a(n(788)),y=a(n(792)),b=n(793),E=a(n(874)),S=a(n(796)),D=a(n(1251)),_=a(n(135)),k=a(n(26)),O=a(n(63)),w=a(n(189)),N=n(14),P=a(n(0)),R=a(n(960));function C(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function I(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?C(Object(r),!0).forEach((function(t){(0,u.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):C(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function L(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,h.default)(e);if(t){var a=(0,h.default)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return(0,p.default)(this,r)}}var T=(0,b.withDevOpsList)({store:new R.default,module:"pipelines",name:"PIPELINE",rowKey:"name"})(l=function(e){(0,f.default)(a,e);var r,n=L(a);function a(e){var r;return(0,c.default)(this,a),(r=n.call(this,e)).refreshHandler=function(){r.isRuning?r.getData({silent:!0}):(clearInterval(r.refreshTimer),r.refreshTimer=null)},r.getData=function(e){r.props.store.fetchList(I(I({devops:r.devops,devopsName:r.devopsName},r.props.match.params),e))},r.handleFetch=function(e,t){r.routing.query(e,t)},r.handleCreate=function(){var e=r.props,n=e.trigger;n("pipeline.create",{module:e.module,trigger:n,title:t("CREATE_PIPELINE"),formTemplate:r.formTemplate,devops:r.devops,cluster:r.cluster,noCodeEdit:!0,success:function(){r.getData()}})},r.handleCopy=function(){var e=(0,s.default)(i.default.mark((function e(n){var a,o;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=r.props.trigger,e.next=3,r.getCRDDetail(n);case 3:o=e.sent,a("pipeline.copy",{title:t("COPY_PIPELINE"),formTemplate:o,devops:r.devops,cluster:r.cluster,success:function(){r.getData()}});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.getCRDDetail=function(){var e=(0,s.default)(i.default.mark((function e(t){var n;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.props.store.fetchDetail({cluster:r.cluster,name:t,devops:r.devops});case 2:return(n=(0,_.default)(r.props.store.getPipeLineConfig())).devops=r.devops,n.cluster=r.cluster,n.devopsName=r.devopsName,e.abrupt("return",n);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.handleAdvanceEdit=function(){var e=(0,s.default)(i.default.mark((function e(n){var a;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.getCRDDetail(n);case 2:a=e.sent,r.props.trigger("pipeline.advance.edit",{title:t("EDIT_PIPELINE"),formTemplate:a,cluster:r.cluster,devops:r.devops,success:function(){r.handleFetch()}});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.getColumns=function(){var e=r.props.getFilteredValue;return[{title:t("NAME"),dataIndex:"name",width:"20%",search:!0,render:function(e,t){var n="failed"!==t.status&&"successful"!==t.status,a="/".concat(r.workspace,"/clusters/").concat(r.cluster,"/devops/").concat(r.devops,"/pipelines/").concat(encodeURIComponent(t.name)).concat(t.isMultiBranch?"/activity":"");return P.default.createElement(g.default,{to:n?null:a,title:e})}},{title:t("HEALTH"),dataIndex:"weatherScore",width:"25%",isHideable:!0,render:function(e){return P.default.createElement(D.default,{score:e})}},{title:t("KIND_TCAP"),dataIndex:"type",width:"20%",filters:r.getTypes(),filteredValue:e("type"),isHideable:!0,search:!0,render:function(e,r){return r.isMultiBranch?t("MULTI_BRANCH_PIPELINE"):t("PIPELINE_PL")}},{title:t("BRANCH_COUNT"),dataIndex:"totalNumberOfBranches",width:"20%",isHideable:!0,render:function(e,t){return void 0===e||!t.isMultiBranch&&0===e?"-":e}},{title:t("PULL_REQUEST_COUNT"),dataIndex:"totalNumberOfPullRequests",width:"15%",isHideable:!0,render:function(e){return void 0===e?"-":e}}]},r.handleMultiBatchRun=function(){var e=(0,N.toJS)(r.props.store.list),n=e.selectedRowKeys,a=e.data,o=n.filter((function(e){return a.find((function(t){return t.name===e})).totalNumberOfBranches}));if(!(0,O.default)(o))return v.default.error(t("BATCH_RUN_UNSUPPORTED_DESC")),!1;r.props.trigger("pipeline.batch.run",{type:t("PIPELINE"),rowKey:"name",devops:r.devops,cluster:r.cluster,success:function(){setTimeout((function(){r.handleFetch()}),1e3)}})},r.formTemplate={devopsName:r.devopsName,cluster:r.cluster,devops:r.devops,enable_timer_trigger:!1,enable_discarder:!0},r.refreshTimer=setInterval((function(){return r.refreshHandler()}),4e3),r}return(0,d.default)(a,[{key:"componentWillReceiveProps",value:function(e){var t=this.props.match.params,r=e.match.params;t.devops!==r.devops&&this.getData(r)}},{key:"componentDidUpdate",value:function(){var e=this;null===this.refreshTimer&&this.isRuning&&(this.refreshTimer=setInterval((function(){return e.refreshHandler()}),4e3))}},{key:"componentWillUnmount",value:function(){clearInterval(this.refreshTimer),this.unsubscribe&&this.unsubscribe()}},{key:"handleRun",value:(r=(0,s.default)(i.default.mark((function e(t){var r,n,a,o,l=this;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.branchNames&&t.branchNames.length,n=t.parameters&&t.parameters.length,a=this.props.trigger,o=this.props.match.params,!r&&!n){e.next=8;break}a("pipeline.params",{devops:this.devops,cluster:this.cluster,branches:t.branchNames,disabledBrancheNames:t.disabledBrancheNames,parameters:t.parameters,params:I(I({},o),{},{name:(0,k.default)(t,"name","")}),success:function(e){l.props.rootStore.routing.push("".concat(l.prefix,"/").concat(encodeURIComponent(t.name),"/").concat(e?"branch/".concat(e,"/"):"","activity"))}}),e.next=11;break;case 8:return e.next=10,this.props.store.runBranch({cluster:o.cluster,devops:o.devops,name:t.name});case 10:this.props.rootStore.routing.push("".concat(this.prefix,"/").concat(encodeURIComponent(t.name),"/activity"));case 11:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"getTypes",value:function(){return[{text:t("PIPELINE_PL"),value:"pipeline"},{text:t("MULTI_BRANCH_PIPELINE"),value:"multi-branch-pipeline"}]}},{key:"renderContent",value:function(){var e=this,r=(0,N.toJS)(this.props.store.list),n=r.data,a=void 0===n?[]:n,i=r.filters,l=r.isLoading,s=r.total,u=r.page,c=r.limit,d=r.selectedRowKeys,f=!1===l&&0===s,p=(0,w.default)(i,["limit","page"]),h=this.enabledActions.includes("create")?this.handleCreate:null;if(f&&Object.keys(p).length<=0)return P.default.createElement(E.default,{name:"PIPELINE",action:h?P.default.createElement(m.Button,{onClick:h,type:"control"},t("CREATE")):null});var v={total:s,page:u,limit:c},g={hideCustom:!1,onSelectRowKeys:this.props.store.setSelectRowKeys,selectedRowKeys:d,selectActions:[{key:"run",type:"primary",text:t("RUN"),action:"delete",onClick:this.handleMultiBatchRun},{key:"delete",type:"danger",text:t("DELETE"),action:"delete",onClick:function(){return e.props.trigger("pipeline.batch.delete",{type:"PIPELINE",rowKey:"name",devops:e.devops,cluster:e.cluster,success:function(){setTimeout((function(){e.handleFetch()}),1e3)}})}}]},y=this.props.tableProps;return P.default.createElement(S.default,(0,o.default)({},y,{rowKey:"name",data:a,selectedRowKeys:(0,N.toJS)(d),columns:this.getColumns(),filters:p,pagination:v,isLoading:l,onFetch:this.handleFetch,onCreate:h,tableActions:g,itemActions:this.itemActions,enabledActions:this.enabledActions}))}},{key:"render",value:function(){var e=this.props.bannerProps;return P.default.createElement(b.ListPage,(0,o.default)({getData:this.getData},this.props),P.default.createElement(y.default,e),this.renderContent())}},{key:"isRuning",get:function(){var e=(0,N.toJS)(this.props.store.list).data.filter((function(e){return"failed"!==e.status&&"successful"!==e.status}));return!(0,O.default)(e)}},{key:"enabledActions",get:function(){return globals.app.getActions({module:"pipelines",cluster:this.props.match.params.cluster,devops:this.devops})}},{key:"devops",get:function(){return this.props.match.params.devops}},{key:"devopsName",get:function(){return this.props.devopsStore.devopsName}},{key:"cluster",get:function(){return this.props.match.params.cluster}},{key:"workspace",get:function(){return this.props.match.params.workspace}},{key:"prefix",get:function(){return this.props.match.url.endsWith("/"),this.props.match.url}},{key:"routing",get:function(){return this.props.rootStore.routing}},{key:"itemActions",get:function(){var e=this,r=this.props,n=r.trigger,a=r.name;return[{key:"run",icon:"triangle-right",text:t("RUN"),action:"edit",onClick:function(t){e.handleRun(t)}},{key:"edit",icon:"pen",text:t("EDIT"),action:"edit",onClick:function(t){e.handleAdvanceEdit(t.name)}},{key:"copy",icon:"copy",text:t("COPY"),action:"edit",onClick:function(t){e.handleCopy(t.name)}},{key:"delete",icon:"trash",text:t("DELETE"),action:"delete",onClick:function(t){n("resource.delete",{type:a,resource:t.name,detail:{name:t.name,devops:e.devops,cluster:e.cluster},success:function(){e.handleFetch()}})}}]}}]),a}(P.default.Component))||l;r.default=T},5043:function(e,t,r){e.exports={icon:"UDqBeGFlpz310vVgYNlM6",health:"_3uWI1sadR_NQXaSek9qSHz",subhealth:"_1v4YbBQ-ihXlEUsK2GscD5",error:"LJ7DoUDDxsUl0O96H4-rt",nostatus:"_2bafMFLN3XqDxFJ4xf8HTv"}},5044:function(e,r,n){"use strict";var a=n(20),o=n(157);n(12),n(109),n(5),n(187),n(11),n(6),n(84),n(18),n(16),n(9),n(13),n(10),n(4),n(316),n(23),n(24),n(17),n(111),n(85),n(62),n(7),n(110),Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0,n(12),n(109),n(45),n(5),n(187),n(11),n(6),n(84),n(18),n(28),n(42),n(16),n(34),n(15),n(9),n(13),n(10),n(4),n(316),n(22),n(23),n(57),n(24),n(17),n(111),n(85),n(62),n(7),n(110);var i=a(n(315)),l=a(n(43)),s=a(n(30));n(41);var u,c,d=a(n(44)),f=a(n(36)),p=a(n(37)),h=a(n(55)),m=a(n(56)),v=a(n(51)),g=a(n(49)),y=a(n(788)),b=a(n(792)),E=o(n(793)),S=a(n(796)),D=a(n(26)),_=a(n(189)),k=a(n(241)),O=n(14),w=a(n(0)),N=a(n(1194)),P=a(n(438)),R=n(52),C=n(72),I=a(n(5045)),L=a(n(1984)),T=a(n(1459)),A=a(n(5049));function j(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function x(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?j(Object(r),!0).forEach((function(t){(0,s.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):j(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function M(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,v.default)(e);if(t){var a=(0,v.default)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return(0,m.default)(this,r)}}var U=(0,E.default)({store:new N.default,module:"cds",name:"CONTINUOUS_DEPLOYMENT",rowKey:"name",authKey:"applications"})((c=function(e){(0,h.default)(n,e);var r=M(n);function n(){var e;(0,f.default)(this,n);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(e=r.call.apply(r,[this].concat(o))).clusterStore=new P.default,e.getData=function(){var t=(0,d.default)(l.default.mark((function t(r){return l.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.props.store.fetchList(x(x({devops:e.devops},e.props.match.params),r));case 2:return t.next=4,e.props.store.fetchStatusSummary({devops:e.devops,cluster:e.cluster});case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.handleFetch=function(t,r){e.routing.query(t,r)},e.handleCreate=function(){(0,e.props.trigger)("cd.create",{title:t("CREATE_CONTINUOUS_DEPLOYMENT"),devops:e.devops,cluster:e.cluster,module:"cds",noCodeEdit:!0,success:e.getData})},e.handleSync=function(r){var n=e.props;(0,n.trigger)("cd.sync",{module:n.module,title:t("SYNC_RESOURCE"),formTemplate:(0,k.default)(r,"repoSource"),devops:e.devops,cluster:e.cluster,application:r.name,noCodeEdit:!0,success:e.getData})},e.getWeatherStatus=function(){return C.CD_WEATHER_STATUS.map((function(e){return{text:t(e.text),value:e.value}}))},e.getSyncStatus=function(){return C.CD_SYNC_STATUS.map((function(e){return{text:t(e.text),value:e.value}}))},e.getColumns=function(){var r=e.props,n=r.getSortOrder,a=r.getFilteredValue;return[{title:t("NAME"),dataIndex:"name",width:"20%",sorter:!0,sortOrder:n("name"),search:!0,render:function(t,r){return w.default.createElement(y.default,{to:"".concat(e.prefix,"/").concat(t),desc:r.description,title:(0,R.getDisplayName)(r)})}},{title:t("HEALTH_STATUS"),dataIndex:"healthStatus",width:"20%",filters:e.getWeatherStatus(),filteredValue:a("healthStatus"),search:!0,render:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Unknown";return w.default.createElement(T.default,{type:e,label:t(e)})}},{title:t("SYNC_STATUS"),dataIndex:"syncStatus",filters:e.getSyncStatus(),filteredValue:a("syncStatus"),search:!0,width:"20%",render:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Unknown";return w.default.createElement(T.default,{type:e,label:e})}},{title:t("DEPLOY_LOCATION"),dataIndex:"destination",isHideable:!0,width:"20%",render:function(t){return w.default.createElement(L.default,{destination:t,clustersDetail:e.clusters})}},{title:t("UPDATE_TIME_TCAP"),dataIndex:"updateTime",sorter:!0,sortOrder:n("updateTime"),isHideable:!0,width:"20%",render:function(e,t){var r=(0,D.default)(t,"status.reconciledAt");return r?(0,R.getLocalTime)(r).format("YYYY-MM-DD HH:mm:ss"):"-"}}]},e.handleFilter=function(t){var r=e.props.store.list.filters;Object.keys(r).forEach((function(e){Object.values(t).includes(r[e])&&(t[e]="")})),e.handleFetch(t)},e.renderStatusCard=function(){var t=e.props.store.list.filters,r=e.props.store.summary,n=r.total,a=void 0===n?0:n,o=r.healthStatus,i=void 0===o?{}:o,l=[{title:"HEALTHY",color:"#55BC8A",used:i.Healthy||0,total:a,icon:"/assets/cd/health.svg",label:"HEALTH_STATUS"},{title:"DEGRADED",color:"#CA2621",used:i.Degraded||0,total:a,icon:"/assets/cd/degraded.svg",label:"HEALTH_STATUS"},{title:"PROGRESSING",color:"#F5A623",used:i.Progressing||0,total:a,icon:"/assets/cd/progressing.svg",label:"HEALTH_STATUS"}];return w.default.createElement("div",{className:A.default.warper__item},l.map((function(r){return w.default.createElement(I.default,{item:r,key:r.title,type:"healthStatus",click:e.handleFilter,label:r.label,filters:t})})))},e.renderSyncStatusCard=function(){var t=e.props.store.list.filters,r=e.props.store.summary,n=r.total,a=void 0===n?0:n,o=r.syncStatus,i=void 0===o?{}:o,l=[{title:"SYNCED",color:"#55BC8A",used:i.Synced||0,total:a,icon:"/assets/cd/synced.svg",label:"SYNC_STATUS"},{title:"OUTOFSYNC",filterValue:"OutOfSync",color:"#F5A623",used:i.OutOfSync||0,total:a,icon:"/assets/cd/outofsync.svg",label:"SYNC_STATUS"},{title:"UNKNOWN",color:"#36435C",used:i.Unknown||0,total:a,icon:"/assets/cd/unknown.svg",label:"SYNC_STATUS"}];return w.default.createElement("div",{className:A.default.warper__item},l.map((function(r){return w.default.createElement(I.default,{item:r,type:"syncStatus",key:r.title,click:e.handleFilter,label:r.label,filters:t})})))},e}return(0,p.default)(n,[{key:"componentDidMount",value:function(){this.clusterStore.fetchList({limit:-1}),this.getData()}},{key:"renderContent",value:function(){var e=this,r=this.props.tableProps,n=(0,O.toJS)(this.props.store.list),a=n.filters,o=n.selectedRowKeys,l=n.isLoading,s=n.total,u=(0,_.default)(a,["limit","page"]),c={onSelectRowKeys:this.props.store.setSelectRowKeys,selectedRowKeys:o,selectActions:[{key:"delete",type:"danger",text:t("DELETE"),action:"delete",onClick:function(){return e.props.trigger("cd.batch.delete",{rowKey:"name",devops:e.devops,cluster:e.cluster,success:function(){setTimeout((function(){e.handleFetch()}),1e3)}})}}]},d=this.enabledActions.includes("create")?this.handleCreate:null,f=!1===l&&0===s&&Object.keys(u).length<=0;return w.default.createElement(S.default,(0,i.default)({rowKey:"name"},r,{columns:this.getColumns(),onCreate:d,onFetch:this.handleFetch,tableActions:c,itemActions:this.itemActions,isLoading:l,showEmpty:f,enabledActions:this.enabledActions}))}},{key:"render",value:function(){var e=this.props.bannerProps;return w.default.createElement(E.ListPage,(0,i.default)({},this.props,{getData:this.getData}),w.default.createElement(b.default,e),w.default.createElement("div",null,!this.hideSummary&&w.default.createElement("div",{className:A.default.status__container},w.default.createElement("div",{className:A.default.warper__container},this.renderStatusCard()),w.default.createElement("div",{className:A.default.warper__container},this.renderSyncStatusCard())),this.renderContent()))}},{key:"clusters",get:function(){return this.clusterStore.list.data}},{key:"enabledActions",get:function(){return globals.app.getActions({module:"applications",cluster:this.cluster,devops:this.devops})}},{key:"devops",get:function(){return this.props.match.params.devops}},{key:"cluster",get:function(){return this.props.match.params.cluster}},{key:"workspace",get:function(){return this.props.match.params.workspace}},{key:"prefix",get:function(){return this.props.match.url.endsWith("/"),this.props.match.url}},{key:"routing",get:function(){return this.props.rootStore.routing}},{key:"hideSummary",get:function(){var e=(0,O.toJS)(this.props.store.summary),t=e.healthStatus,r=void 0===t?{}:t,n=e.syncStatus,a=void 0===n?{}:n;return[].concat(Object.values(r)).concat(Object.values(a)).every((function(e){return!e}))}},{key:"itemActions",get:function(){var e=this,r=this.props,n=r.trigger,a=r.routing;return[{key:"edit",icon:"pen",text:t("EDIT_INFORMATION"),action:"edit",onClick:function(t){n("resource.baseinfo.edit",{detail:x(x({},t),{},{cluster:e.cluster}),success:a.query})}},{key:"yaml",icon:"pen",text:t("EDIT_YAML"),action:"edit",onClick:function(t){n("resource.yaml.edit",{detail:x(x({},t),{},{cluster:e.cluster}),success:a.query})}},{key:"sync",icon:"changing-over",text:t("SYNC"),action:"edit",onClick:function(t){e.handleSync(t)}},{key:"delete",icon:"trash",text:t("DELETE"),action:"delete",onClick:function(t){n("cd.delete",{type:"CONTINUOUS_DEPLOYMENT",detail:t,cluster:e.cluster,success:a.query})}}]}}]),n}(w.default.Component),(0,g.default)(c.prototype,"clusters",[O.computed],Object.getOwnPropertyDescriptor(c.prototype,"clusters"),c.prototype),u=c))||u;r.default=U},5045:function(e,r,n){"use strict";n(15);var a=n(157),o=n(20);n(6),n(10),n(7),Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e){var r=e.click,n=e.item,a=e.type,o=e.filters,m=(0,s.useState)(!1),v=(0,l.default)(m,2),g=v[0],y=v[1],b=n.title,E=n.color,S=n.filterValue,D=n.used,_=n.total,k=n.icon,O=n.label;return(0,s.useEffect)((function(){(0,f.default)(o)?y(!1):(y(!1),Object.keys(o).forEach((function(e){a===e&&o[e]===(S||(0,p.capitalize)(b))&&y(!0)})))}),[o]),s.default.createElement("div",{className:(0,d.default)(h.default.content,(0,i.default)({},h.default["content--checked"],g)),onClick:function(){y(!g),r((0,i.default)({},a,S||(0,p.capitalize)(b)))}},s.default.createElement("div",{className:h.default.chart},s.default.createElement(u.PieChart,{width:64,height:64,innerRadius:"75%",outerRadius:"115%",data:[{name:"Used",itemStyle:{fill:E},value:D},{name:"Left",itemStyle:{fill:"#EFF4F9"},value:_-D}]}),s.default.createElement("img",{className:h.default.innerIcon,src:k,alt:""})),s.default.createElement("div",{className:h.default.info},s.default.createElement("p",{className:h.default.label},t("".concat(O))),s.default.createElement(c.Radio,{className:(0,d.default)(h.default.radio,(0,i.default)({},h.default["radio--show"],g)),checked:g}),s.default.createElement("p",{className:h.default.type},t(b)),s.default.createElement("p",{className:h.default.number},s.default.createElement("span",{className:h.default.master},D),"/",s.default.createElement("span",null,_))))},n(6),n(10),n(4),n(7);var i=o(n(30)),l=o(n(96)),s=a(n(0)),u=n(798),c=n(186),d=o(n(3)),f=o(n(63)),p=n(52),h=o(n(5046))},5046:function(e,t,r){e.exports={content:"_3rbvLxgxar-1IXEnt7uXsv",info:"_1aKSZORI6fIwi-0XcGTt4g",radio:"_31WiuV5i5qqd7huDXoSta2","content--checked":"_2ck3PC62TuQ0VBCr4wT0Lq",chart:"t9qyn804bLHyqbuqqIVpF",innerIcon:"_1RoP3whI8yVaFftrDDDcGK","radio--show":"_3wu35PWdBZIS8LYSksbZVA",label:"_1MMJ5AoDMc--UUq3xm-ng4",type:"UCNB0wUPam3YH8CCM7lEd",number:"-qfmbebzKsuh_9f9pXzkS",master:"_2OvbKVu7MWU8S_Xmelk71f"}},5047:function(e,t,r){e.exports={tags:"rXo5-VrF2SoJPw4YTJ49n"}},5048:function(e,t,r){e.exports={status:"_1i44s-mkio269MZkQooCA-",noBolder:"_1PYdlTizmu4a-7vtA3SGVB",status_icon:"_1Fc4a9R1_fpPTYh8ZZCnsL",synced:"EHypTO3aVqoSZHjqxFeRM",pruneskipped:"_1y3YUdYQhmCrRQEQC3Vbro",outofsync:"_3PatraCDMneKvGdCyDMvqF",syncfailed:"ArN9LRm53CRNjkzXWoe4Y",unknown:"_1KFsPRlIVt0iTX2q-SlIex",healthy:"_38Bn86ot3T09d_CEbksKAi",degraded:"ulbHb6MIg2KuMGDWUcPdF",progressing:"_2LgiBXp2kDTVB1L8CeNBkz",suspended:"TAPJ97Ue7MfgbqW9_GmVG",missing:"_2-RicBgupjxvlNMuDmPIKT"}},5049:function(e,t,r){e.exports={status__container:"DSexb7d0T5aof2FHL0GTJ",warper__container:"_3T1AJfVjhTgE_eU2vFnMj1",warper__item:"_1kKcKpGvcV2eck1NGzsmYf"}},5050:function(e,r,n){"use strict";var a=n(20),o=n(157);n(12),n(109),n(5),n(11),n(6),n(84),n(9),n(13),n(10),n(4),n(23),n(24),n(17),n(111),n(85),n(62),n(7),Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0,n(12),n(109),n(45),n(5),n(11),n(6),n(84),n(28),n(42),n(34),n(15),n(9),n(13),n(10),n(4),n(22),n(23),n(57),n(24),n(17),n(111),n(85),n(62),n(7);var i=a(n(315)),l=a(n(43)),s=a(n(30));n(41);var u,c=a(n(44)),d=a(n(36)),f=a(n(37)),p=a(n(55)),h=a(n(56)),m=a(n(51)),v=a(n(0)),g=n(14),y=o(n(793)),b=a(n(788)),E=a(n(792)),S=a(n(1109)),D=a(n(796)),_=n(52),k=a(n(189)),O=a(n(5051));function w(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function N(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?w(Object(r),!0).forEach((function(t){(0,s.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):w(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function P(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,m.default)(e);if(t){var a=(0,m.default)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return(0,h.default)(this,r)}}var R=(0,y.default)({store:new S.default,module:"codeRepos",name:"CODE_REPO",rowKey:"name",authKey:"gitrepositories"})(u=function(e){(0,p.default)(n,e);var r=P(n);function n(){var e;(0,d.default)(this,n);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(e=r.call.apply(r,[this].concat(o))).getData=function(){var t=(0,c.default)(l.default.mark((function t(r){return l.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.props.store.fetchList(N(N({devops:e.devops},e.props.match.params),r));case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.handleFetch=function(t,r){e.routing.query(t,r)},e.handleCreate=function(){(0,e.props.trigger)("codeRepo.create",{title:t("IMPORT_CODE_REPO"),devops:e.devops,cluster:e.cluster,module:"codeRepos",noCodeEdit:!0,success:e.getData})},e.getColumns=function(){var r=e.props.getSortOrder;return[{title:t("NAME"),dataIndex:"name",width:"20%",sorter:!0,sortOrder:r("name"),search:!0,render:function(e,t){return v.default.createElement(b.default,{className:O.default.avatar,to:"",icon:"bitbucket_server"===t.provider?"bitbucket":t.provider,iconSize:40,desc:t.description,title:(0,_.getDisplayName)(t)})}},{title:t("SOURCE"),dataIndex:"provider",isHideable:!0,width:"20%",render:function(e){return(0,_.capitalize)("bitbucket_server"===e?"bitbucket":e)}},{title:t("CODE_REPOSITORY_ADDRESS"),dataIndex:"repoURL",isHideable:!0,width:"40%"},{title:t("CREATION_TIME_TCAP"),dataIndex:"createTime",sorter:!0,sortOrder:r("createTime"),isHideable:!0,width:"20%",render:function(e){return(0,_.getLocalTime)(e).format("YYYY-MM-DD HH:mm:ss")}}]},e}return(0,f.default)(n,[{key:"renderContent",value:function(){var e=this.props.tableProps,r=(0,g.toJS)(this.props.store.list),n=r.filters,a=r.isLoading,o=r.total,l=(0,k.default)(n,["limit","page"]),s=this.enabledActions.includes("create")?this.handleCreate:null,u=!1===a&&0===o&&Object.keys(l).length<=0;return v.default.createElement(D.default,(0,i.default)({rowKey:"name"},e,{columns:this.getColumns(),onCreate:s,onFetch:this.handleFetch,tableActions:{},itemActions:this.itemActions,isLoading:a,showEmpty:u,enabledActions:this.enabledActions,createText:t("ADD")}))}},{key:"render",value:function(){var e=this.props.bannerProps;return v.default.createElement(y.ListPage,(0,i.default)({getData:this.getData},this.props),v.default.createElement(E.default,e),this.renderContent())}},{key:"enabledActions",get:function(){return globals.app.getActions({module:"gitrepositories",cluster:this.props.match.params.cluster,devops:this.devops})}},{key:"devops",get:function(){return this.props.match.params.devops}},{key:"cluster",get:function(){return this.props.match.params.cluster}},{key:"workspace",get:function(){return this.props.match.params.workspace}},{key:"prefix",get:function(){return this.props.match.url.endsWith("/"),this.props.match.url}},{key:"routing",get:function(){return this.props.rootStore.routing}},{key:"itemActions",get:function(){var e=this,r=this.props,n=r.trigger,a=r.routing;return[{key:"edit",icon:"pen",text:t("EDIT"),action:"edit",onClick:function(r){n("codeRepo.edit",{title:t("EDIT_CODE_REPO"),devops:e.devops,cluster:e.cluster,module:"codeRepos",detail:r,noCodeEdit:!0,success:e.getData})}},{key:"editYaml",icon:"pen",text:t("EDIT_YAML"),action:"edit",onClick:function(t){n("resource.yaml.edit",{detail:N(N({},t),{},{devops:e.devops,cluster:e.cluster}),success:a.query})}},{key:"delete",icon:"trash",text:t("DELETE"),action:"delete",onClick:function(t){n("codeRepo.delete",{type:"CODE_REPO",detail:t,devops:e.devops,cluster:e.cluster,success:a.query})}}]}}]),n}(v.default.Component))||u;r.default=R},5051:function(e,t,r){e.exports={avatar:"_2TafwQR5abike0Mb02nAVw"}},5052:function(e,r,n){"use strict";var a=n(20);n(12),n(5),n(187),n(11),n(6),n(84),n(18),n(16),n(9),n(13),n(10),n(4),n(23),n(24),n(17),n(85),n(62),n(7),Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0,n(12),n(45),n(5),n(187),n(11),n(6),n(84),n(18),n(28),n(42),n(16),n(34),n(15),n(9),n(13),n(10),n(4),n(22),n(23),n(57),n(24),n(17),n(85),n(62),n(7);var o=a(n(43));n(41);var i,l=a(n(44)),s=a(n(30)),u=a(n(58)),c=a(n(36)),d=a(n(37)),f=a(n(55)),p=a(n(56)),h=a(n(51)),m=n(186),v=a(n(240)),g=a(n(3)),y=a(n(788)),b=a(n(789)),E=a(n(850)),S=a(n(792)),D=a(n(824)),_=a(n(874)),k=a(n(5053)),O=a(n(135)),w=a(n(26)),N=a(n(63)),P=a(n(76)),R=a(n(74)),C=n(14),I=n(239),L=a(n(0)),T=n(433),A=a(n(441)),j=a(n(322)),x=n(52),M=n(791),U=n(143),F=a(n(5054));function B(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Y(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?B(Object(r),!0).forEach((function(t){(0,s.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):B(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function H(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,h.default)(e);if(t){var a=(0,h.default)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return(0,p.default)(this,r)}}var J=(0,I.inject)("rootStore","devopsStore")(i=(0,I.observer)(i=(0,M.trigger)(i=function(e){(0,f.default)(n,e);var r=H(n);function n(){var e;(0,c.default)(this,n);for(var a=arguments.length,i=new Array(a),s=0;s<a;s++)i[s]=arguments[s];return(e=r.call.apply(r,[this].concat(i))).state={showEdit:!1,showDelete:!1,opened:!1},e.roleStore=new A.default,e.memberStore=new j.default,e.handleHostClusterChange=function(){e.forceUpdate()},e.hideEdit=function(){e.setState({showEdit:!1})},e.handleEdit=function(r){var n=r.devops,a=(0,u.default)(r,["devops"]);e.store.update({devops:n,cluster:e.cluster,workspace:e.workspace},a,!0).then((function(){e.hideEdit(),v.default.success({content:t("UPDATE_SUCCESSFUL")}),e.store.fetchDetail(Y({workspace:e.workspace},e.props.match.params))}))},e.hideDelete=function(){e.setState({showDelete:!1})},e.handleDelete=function(){e.store.delete({devops:e.devops,cluster:e.cluster,workspace:e.workspace}).then((function(){e.routing.push("/")}))},e.handleMoreMenuClick=function(t,r){switch(r){case"edit":e.setState({showEdit:!0});break;case"delete":e.setState({showDelete:!0})}},e.handleEditAllowlist=function(){var t;e.trigger("devops.edit.allowlist",{devops:e.devops,store:e.store,cluster:e.cluster,workspace:e.workspace,detail:e.detail,success:(t=(0,l.default)(o.default.mark((function t(){return o.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.store.fetchDetail(Y({workspace:e.workspace},e.props.match.params));case 2:e.setState({opened:!((0,N.default)(e.detail.sourceRepos)&&(0,N.default)(e.detail.destinations))});case 3:case"end":return t.stop()}}),t)}))),function(){return t.apply(this,arguments)})})},e.toggle=(0,l.default)(o.default.mark((function t(){var r,n;return o.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(r=e.state.opened)){t.next=9;break}return n=(0,w.default)((0,O.default)((0,C.toJS)(e.detail)),"_originData.spec",{}),(0,R.default)(n,"argo.destinations",[]),(0,R.default)(n,"argo.sourceRepos",[]),t.next=7,e.store.editAllowlist(e.store.data,{spec:n});case 7:return t.next=9,e.store.fetchDetail(Y({workspace:e.workspace},e.props.match.params));case 9:e.setState({opened:!r});case 10:case"end":return t.stop()}}),t)}))),e}return(0,d.default)(n,[{key:"componentDidMount",value:function(){this.canViewMembers&&this.canViewRoles&&(this.memberStore.fetchList({namespace:this.devops,cluster:this.cluster}),this.roleStore.fetchList({devops:this.devops,cluster:this.cluster})),this.setState({opened:!((0,N.default)(this.detail.sourceRepos)&&(0,N.default)(this.detail.destinations))}),this.subscribe=(0,U.initEvents)([U.eventKeys.HOST_CLUSTER_CHANGE,this.handleHostClusterChange])}},{key:"componentWillUnmount",value:function(){this.subscribe&&this.subscribe()}},{key:"renderMoreMenu",value:function(){return L.default.createElement(m.Menu,{onClick:this.handleMoreMenuClick},this.enabledItemActions.map((function(e){return L.default.createElement(m.Menu.MenuItem,{key:e.key},L.default.createElement(m.Icon,{name:e.icon})," ",e.text)})))}},{key:"renderBaseInfo",value:function(){var e=this,r=this.roleStore.list.total,n=this.memberStore.list.total;return L.default.createElement(b.default,{className:F.default.wrapper,title:t("BASIC_INFORMATION")},L.default.createElement("div",{className:F.default.header},L.default.createElement(m.Icon,{name:"strategy-group",size:40}),L.default.createElement("div",{className:F.default.item},L.default.createElement("div",null,(0,x.getDomTitle)((0,x.getDisplayNameNew)(this.detail))),L.default.createElement("p",null,t("DEVOPS_PROJECT_SCAP"))),L.default.createElement("div",{className:F.default.item},L.default.createElement("div",null,L.default.createElement(T.Link,{to:"/workspaces/".concat(this.workspace)},(0,x.getDomTitle)((0,x.showNameAndAlias)(this.workspace,"workspace",{},!0,(function(){return e.forceUpdate()}))))),L.default.createElement("p",null,t("WORKSPACE"))),L.default.createElement("div",{className:F.default.item},L.default.createElement("div",null,this.detail.creator||"-"),L.default.createElement("p",null,t("CREATOR"))),L.default.createElement("div",{className:F.default.item},L.default.createElement("div",null,(0,x.getLocalTime)(this.detail.createTime).format("YYYY-MM-DD HH:mm:ss")),L.default.createElement("p",null,t("CREATION_TIME"))),!(0,N.default)(this.enabledItemActions)&&L.default.createElement("div",{className:(0,g.default)(F.default.item,"text-right")},L.default.createElement(m.Dropdown,{theme:"dark",content:this.renderMoreMenu(),trigger:"click",placement:"bottomRight"},L.default.createElement(m.Button,null,t("MANAGE"))))),this.canViewRoles&&this.canViewMembers&&L.default.createElement("div",{className:F.default.content},L.default.createElement("div",{className:F.default.contentItem},L.default.createElement(m.Icon,{name:"role",size:40}),L.default.createElement("div",{className:F.default.item},L.default.createElement("div",null,r),L.default.createElement("p",null,1===r?t("DEVOPS_PROJECT_ROLE_SCAP"):t("DEVOPS_PROJECT_ROLE_PL_SCAP")))),L.default.createElement("div",{className:F.default.contentItem},L.default.createElement(m.Icon,{name:"group",size:40}),L.default.createElement("div",{className:F.default.item},L.default.createElement("div",null,n),L.default.createElement("p",null,1===n?t("DEVOPS_PROJECT_MEMBER_SCAP"):t("DEVOPS_PROJECT_MEMBER_PL_SCAP"))))))}},{key:"renderEmptyCD",value:function(){return L.default.createElement("div",{className:F.default.empty},L.default.createElement(_.default,{name:"ALLOWLIST",module:"allowlists",title:t("EMPTY_ALLOWLIST_TITLE"),action:!(0,N.default)(this.enabledItemActions)&&L.default.createElement(m.Button,{onClick:this.handleEditAllowlist,type:"control"},t("ENABLE_ALLOWLIST"))}))}},{key:"renderItem",value:function(e){var r=this.detail[e];return(0,N.default)(r)?L.default.createElement("div",{className:F.default.item_tag},"sourceRepos"===e?t("CODE_REPOSITORY_NOT_SELECTED"):t("RESOURCE_DEPLOYMENT_LOCATION_NOT_SELECTED")):1===r.length&&r.every((function(e){return(0,P.default)(e)?Object.keys(e).every((function(t){return"*"===e[t]})):"*"===e}))?L.default.createElement("div",{className:F.default.item_tag},"sourceRepos"===e?t("ALL_CODE_REPOSITORIES"):t("ALL_RESOURCE_DEPLOYMENT_LOCATIONS")):"sourceRepos"===e?L.default.createElement("div",{className:F.default.items},this.detail.sourceRepos.map((function(e){return L.default.createElement("div",{key:e,className:F.default.item},"*"===e?t("ALL"):e)}))):L.default.createElement("div",{className:F.default.items},this.detail.destinations.map((function(e){return L.default.createElement("div",{key:"".concat(e.name,"-").concat(e.namespace,"+'-'+").concat(globals.hostClusterName,"}"),className:"".concat(F.default.item," ").concat(F.default.item_flex)},L.default.createElement("div",null,L.default.createElement(m.Icon,{name:"cluster",size:20}),L.default.createElement("b",null,"*"===e.name?t("ALL"):(0,x.showNameAndAlias)((0,x.inCluster2Default)(e.name),"cluster")),"*"!==(null==e?void 0:e.name)&&L.default.createElement("span",null,"(",null==e?void 0:e.server,")")),L.default.createElement("div",null,L.default.createElement(m.Icon,{name:"enterprise",size:20}),L.default.createElement("b",null,"*"===(null==e?void 0:e.namespace)?t("ALL"):(0,x.showNameAndAlias)(null==e?void 0:e.namespace,"project",{cluster:(0,x.inCluster2Default)(e.name)}))))})))}},{key:"renderCD",value:function(){var e=this.state.opened;return L.default.createElement(b.default,{className:F.default.wrapper,title:t("CD_ALLOWLIST")},(0,N.default)(this.detail.sourceRepos)&&(0,N.default)(this.detail.destinations)?this.renderEmptyCD():L.default.createElement(L.default.Fragment,null,L.default.createElement("div",{className:F.default.cd_header},L.default.createElement(y.default,{icon:"allowlist",iconSize:40,title:e?t("ENABLED"):t("DISABLED"),desc:t("CD_ALLOWLIST_SCAP")}),!(0,N.default)(this.enabledItemActions)&&L.default.createElement("div",{className:(0,g.default)(F.default.item,"text-right")},L.default.createElement(E.default,{className:F.default.switch,text:e?t("ENABLED"):t("DISABLED"),onChange:this.toggle,checked:e}),L.default.createElement(m.Button,{onClick:this.handleEditAllowlist},t("EDIT_ALLOWLIST")))),L.default.createElement("div",{className:F.default.content_CD},L.default.createElement("div",{className:F.default.content_item},L.default.createElement("div",{className:F.default.content_item_title},t("CODE_REPO_PL")),this.renderItem("sourceRepos")),L.default.createElement("div",{className:F.default.content_item},L.default.createElement("div",{className:F.default.content_item_title},t("DEPLOYMENT_LOCATION_PL")),this.renderItem("destinations")))))}},{key:"render",value:function(){var e=(0,C.toJS)(this.store).data;return L.default.createElement("div",null,L.default.createElement(S.default,{title:t("BASIC_INFORMATION"),icon:"cdn",description:t("DEVOPS_DESCRIPTION"),module:this.module}),this.renderBaseInfo(),this.isNeedHide?null:this.renderCD(),L.default.createElement(k.default,{detail:e,workspace:this.workspace,visible:this.state.showEdit,onOk:this.handleEdit,onCancel:this.hideEdit,isSubmitting:this.store.isSubmitting,namespace:this.devops,cluster:this.cluster}),L.default.createElement(D.default,{detail:e,title:t("DELETE_DEVOPS_PROJECT"),desc:t.html("DELETE_DEVOPS_PROJECT_TIP",{resource:e.name}),resource:e.name,visible:this.state.showDelete,onOk:this.handleDelete,onCancel:this.hideDelete,isSubmitting:this.store.isSubmitting}))}},{key:"isMultiCluster",get:function(){var e;return null===(e=window.parent)||void 0===e?void 0:e.globals.ksConfig.multicluster}},{key:"clusterVersion",get:function(){return this.isMultiCluster?(0,w.default)(window,"parent.globals.clusterConfig.".concat(this.cluster,".ksVersion")):(0,w.default)(window,"parent.globals.ksConfig.ksVersion")}},{key:"isNeedHide",get:function(){return(0,x.compareVersion)(this.clusterVersion,"3.3.0")<0||!this.isHostCluster}},{key:"routing",get:function(){return this.props.rootStore.routing}},{key:"store",get:function(){return this.props.devopsStore}},{key:"devops",get:function(){return this.props.match.params.devops}},{key:"devopsName",get:function(){return this.store.devopsName}},{key:"workspace",get:function(){return this.props.match.params.workspace}},{key:"cluster",get:function(){return this.props.match.params.cluster}},{key:"isHostCluster",get:function(){return!globals.app.isMultiCluster||this.cluster===this.props.devopsStore.hostName}},{key:"enabledActions",get:function(){return globals.app.getActions({module:"devops-settings",cluster:this.cluster,devops:this.devops})}},{key:"canViewRoles",get:function(){return globals.app.hasPermission({module:"roles",action:"view",cluster:this.cluster,devops:this.devops})}},{key:"canViewMembers",get:function(){return globals.app.hasPermission({module:"members",action:"view",cluster:this.cluster,devops:this.devops})}},{key:"itemActions",get:function(){return[{key:"edit",icon:"pen",action:"edit",text:t("EDIT")},{key:"delete",icon:"trash",action:"delete",text:t("DELETE")}]}},{key:"enabledItemActions",get:function(){var e=this;return this.itemActions.filter((function(t){return!t.action||e.enabledActions.includes(t.action)}))}},{key:"detail",get:function(){return this.store.data}}]),n}(L.default.Component))||i)||i)||i;r.default=J},5053:function(e,r,n){"use strict";n(15);var a=n(20);n(4),n(23),n(17),Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0,n(45),n(42),n(4),n(23),n(57),n(17);var o,i,l,s=a(n(36)),u=a(n(37)),c=a(n(55)),d=a(n(56)),f=a(n(51)),p=n(186),h=a(n(787)),m=n(239),v=a(n(1)),g=a(n(0)),y=n(72);function b(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,f.default)(e);if(t){var a=(0,f.default)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return(0,d.default)(this,r)}}var E=(0,m.observer)((l=i=function(e){(0,c.default)(n,e);var r=b(n);function n(e){var t;return(0,s.default)(this,n),(t=r.call(this,e)).handleOk=function(e){(0,t.props.onOk)(e)},t.form=g.default.createRef(),t}return(0,u.default)(n,[{key:"render",value:function(){var e=this.props,r=e.detail,n=e.visible,a=e.onCancel,o=e.isSubmitting;return g.default.createElement(h.default.Form,{width:691,title:t("EDIT_INFORMATION"),icon:"pen",data:r,onOk:this.handleOk,onCancel:a,isSubmitting:o,visible:n},g.default.createElement(p.Form.Item,{label:t("NAME"),desc:t("NAME_DESC"),rules:[{required:!0,message:t("NAME_EMPTY_DESC")},{pattern:y.PATTERN_NAME,message:t("PATTERN_NAME_INVALID_TIP")}]},g.default.createElement(p.Input,{name:"name",disabled:!0})),g.default.createElement(p.Form.Item,{label:t("CREATOR"),desc:t("DEVOPS_ADMIN_DESC")},g.default.createElement(p.Input,{name:"creator",disabled:!0})),g.default.createElement(p.Form.Item,{label:t("ALIAS"),desc:t("ALIAS_NAME_DESC"),rules:[{pattern:y.PATTERN_ALIAS_NAME,message:t("INVALID_ALIAS_NAME_DESC")}]},g.default.createElement(p.Input,{name:"aliasName",maxLength:63})),g.default.createElement(p.Form.Item,{label:t("DESCRIPTION"),desc:t("DESCRIPTION_DESC")},g.default.createElement(p.TextArea,{maxLength:256,name:"description"})))}}]),n}(g.default.Component),i.propTypes={detail:v.default.object,visible:v.default.bool,onOk:v.default.func,onCancel:v.default.func,isSubmitting:v.default.bool},i.defaultProps={visible:!1,isSubmitting:!1,detail:{},onOk:function(){},onCancel:function(){}},o=l))||o;r.default=E},5054:function(e,t,r){e.exports={wrapper:"AvCNLmmummi1Y-_fnmHT2",single:"IvKIl2CA6fNLZpCp933UF",header:"_14DZlEuo1ZgK7eEn1jYkZ4",item:"_14a_u6eMcfCaM7McJoNQoN",cd_header:"_1-HmRYSXwmLf9pyHqaOK4W",content:"_1wMCCc2addUq6t0pcJXL7t",contentItem:"_3jG2mXohN1BEiII1FG6II0",content_CD:"_1VxF39p6qu0AlIQY0c70tx",content_item:"_2MHVaF4a2B8MYul7bGrfPh",content_item_title:"_1z31nQgJnfhe3yn2Yb4eEU",content_item_desc:"_3aGTPi0vNt-0rDXAjvFjeE",item_tag:"_3kwg6-inB6vL4ahscTjgTe",items:"_3fjVCs4pUKQCZHYz5MtZR2",item_flex:"_1lwASLSidQdgvVHhiSXmbt",empty:"_1jddbgu4u8A5t2kjJ_5Jyf"}},5055:function(e,r,n){"use strict";var a=n(20),o=n(157);n(12),n(5),n(11),n(6),n(84),n(16),n(137),n(9),n(13),n(10),n(4),n(23),n(24),n(17),n(85),n(62),n(7),Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0,n(12),n(45),n(5),n(11),n(6),n(84),n(28),n(42),n(16),n(137),n(34),n(15),n(9),n(13),n(10),n(4),n(23),n(57),n(24),n(17),n(85),n(62),n(7);var i,l=a(n(315)),s=a(n(30)),u=a(n(36)),c=a(n(37)),d=a(n(55)),f=a(n(56)),p=a(n(51)),h=a(n(788)),m=a(n(792)),v=o(n(793)),g=a(n(796)),y=n(14),b=a(n(0)),E=a(n(441)),S=n(52),D=n(72);function _(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function k(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?_(Object(r),!0).forEach((function(t){(0,s.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function O(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,p.default)(e);if(t){var a=(0,p.default)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return(0,f.default)(this,r)}}var w=(0,v.default)({store:new E.default,module:"roles",name:"DEVOPS_PROJECT_ROLE",injectStores:["rootStore","devopsStore"]})(i=function(e){(0,d.default)(n,e);var r=O(n);function n(){var e;(0,u.default)(this,n);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(e=r.call.apply(r,[this].concat(o))).showAction=function(e){return!globals.config.presetDevOpsRoles.includes(e.name)},e.getData=function(t){var r=Object.assign({},t);e.props.store.fetchList(k({devops:e.devops,cluster:e.cluster},r))},e.getColumns=function(){var r=e.props,n=r.getSortOrder,a=r.module;return[{title:t("NAME"),dataIndex:"name",sorter:!0,sortOrder:n("name"),render:function(t){return b.default.createElement(h.default,{icon:D.ICON_TYPES[a],title:t,to:"".concat(e.props.match.url,"/").concat(t)})}},{title:t("DESCRIPTION"),key:"description",dataIndex:"description",isHideable:!0,width:"40%"},{title:t("CREATION_TIME_TCAP"),dataIndex:"createTime",sorter:!0,sortOrder:n("createTime"),isHideable:!0,width:150,render:function(e){return(0,S.getLocalTime)(e).format("YYYY-MM-DD HH:mm:ss")}}]},e.showCreate=function(){var t=e.props,r=t.isHostCluster,n=t.store;e.props.trigger("role.create",{module:r?"devopsroles":"devopsrolesNotHostCluster",devops:e.devops,namespace:e.devops,cluster:e.cluster,roleModules:(0,y.toJS)(n.roleCategory),roleTemplates:(0,y.toJS)(e.props.store.roleTemplates.data).filter((function(e){return e})),success:e.getData})},e}return(0,c.default)(n,[{key:"componentDidMount",value:function(){this.props.store.fetchRoleTemplates("devops","iam.kubesphere.io/scope=namespace,devops.kubesphere.io/managed=true"),this.props.store.fetchTemplatesCategory("namespace","devops")}},{key:"render",value:function(){var e=this.props,r=e.bannerProps,n=e.tableProps;return b.default.createElement(v.ListPage,(0,l.default)({},this.props,{getData:this.getData,noWatch:!0}),b.default.createElement(m.default,(0,l.default)({},r,{tabs:this.tabs,description:t("DEVOPS_PROJECT_ROLES_DESC")})),b.default.createElement(g.default,(0,l.default)({},n,{enabledActions:this.enabledActions,emptyProps:this.emptyProps,tableActions:this.tableActions,itemActions:this.itemActions,columns:this.getColumns(),searchType:"name"})))}},{key:"devops",get:function(){return this.props.devopsStore.devops}},{key:"cluster",get:function(){return this.props.match.params.cluster}},{key:"enabledActions",get:function(){return globals.app.getActions({module:"roles",devops:this.devops,cluster:this.cluster})}},{key:"itemActions",get:function(){var e=this,r=this.props,n=r.routing,a=r.trigger,o=r.store,i=r.name,l=r.isHostCluster;return[{key:"edit",icon:"pen",text:t("EDIT_INFORMATION"),action:"edit",show:this.showAction,onClick:function(e){return a("resource.baseinfo.edit",{detail:e,success:n.query})}},{key:"editRole",icon:"pen",text:t("EDIT_PERMISSIONS"),action:"edit",show:this.showAction,onClick:function(e){return a("role.edit",{module:l?"devopsroles":"devopsrolesNotHostCluster",detail:e,roleTemplates:(0,y.toJS)(o.roleTemplates.data),roleModules:(0,y.toJS)(o.roleCategory),success:n.query})}},{key:"delete",icon:"trash",text:t("DELETE"),action:"delete",show:this.showAction,onClick:function(t){return a("role.delete",{detail:t,type:i,namespace:e.devops,cluster:e.cluster,success:n.query})}}]}},{key:"tableActions",get:function(){return k(k({},this.props.tableProps.tableActions),{},{onCreate:this.showCreate,selectActions:[]})}},{key:"emptyProps",get:function(){return{desc:t("DEVOPS_PROJECT_ROLE_EMPTY_DESC")}}}]),n}(b.default.Component))||i;r.default=w},5056:function(e,r,n){"use strict";var a=n(20),o=n(157);n(12),n(5),n(11),n(6),n(18),n(16),n(137),n(9),n(13),n(10),n(4),n(23),n(24),n(17),n(62),n(7),Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0,n(12),n(45),n(5),n(11),n(6),n(18),n(28),n(42),n(16),n(137),n(34),n(15),n(9),n(13),n(10),n(4),n(23),n(57),n(24),n(17),n(62),n(7);var i,l=a(n(315)),s=a(n(30)),u=a(n(36)),c=a(n(37)),d=a(n(55)),f=a(n(56)),p=a(n(51)),h=a(n(0)),m=n(14),v=a(n(788)),g=a(n(795)),y=a(n(199)),b=a(n(241)),E=a(n(792)),S=o(n(793)),D=a(n(796)),_=n(52),k=a(n(322)),O=a(n(441));function w(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function N(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?w(Object(r),!0).forEach((function(t){(0,s.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):w(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function P(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,p.default)(e);if(t){var a=(0,p.default)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return(0,f.default)(this,r)}}var R=(0,S.default)({store:new k.default,module:"users",name:"DEVOPS_PROJECT_MEMBER",rowKey:"username",injectStores:["rootStore","devopsStore"]})(i=function(e){(0,d.default)(n,e);var r=P(n);function n(){var e;(0,u.default)(this,n);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(e=r.call.apply(r,[this].concat(o))).roleStore=new O.default,e.fetchData=function(){e.props.store.getAllUserStatus(),e.canViewRoles&&e.roleStore.fetchList({devops:e.devops,cluster:e.cluster,limit:-1})},e.getData=function(t){var r=Object.assign({},t);e.props.store.fetchList(N({namespace:e.devops,cluster:e.cluster},r))},e.getColumns=function(){return[{title:t("NAME"),dataIndex:"username",sorter:!0,render:function(e,t){return h.default.createElement(v.default,{avatar:t.avatar_url||"/assets/default-user.svg",title:e,desc:t.email||"-",noLink:!0})}},{title:t("STATUS"),dataIndex:"status",isHideable:!0,width:"19%",render:function(e){return h.default.createElement(g.default,{type:e,name:e?t("USER_".concat(e.toUpperCase())):""})}},{title:t("ROLE"),dataIndex:"role",isHideable:!0,width:"19%"},{title:t("LAST_LOGIN"),dataIndex:"lastLoginTime",isHideable:!0,width:150,render:function(e){return h.default.createElement("p",null,e?(0,_.getLocalTime)(e).format("YYYY-MM-DD HH:mm:ss"):t("NOT_LOGIN_YET"))}}]},e}return(0,c.default)(n,[{key:"componentDidMount",value:function(){this.fetchData()}},{key:"showAction",value:function(e){return globals.user.username!==e.name}},{key:"render",value:function(){var e=this,r=this.props,n=r.bannerProps,a=r.tableProps;return h.default.createElement(S.ListPage,(0,l.default)({},this.props,{getData:this.getData,noWatch:!0}),h.default.createElement(E.default,(0,l.default)({},n,{tabs:this.tabs,description:t("DEVOPS_PROJECT_MEM_DESC")})),h.default.createElement(D.default,(0,l.default)({},a,{data:this.userList,searchType:"name",enabledActions:this.enabledActions,tableActions:this.tableActions,itemActions:this.itemActions,columns:this.getColumns(),onRefresh:function(){e.fetchData(),e.getData()}})))}},{key:"canViewRoles",get:function(){return globals.app.hasPermission(N(N({},this.props.match.params),{},{devops:this.devops,module:"roles",action:"view"}))}},{key:"userList",get:function(){var e,t=this;return(null!==(e=(0,m.toJS)(this.props.store.list.data))&&void 0!==e?e:[]).map((function(e){return(0,y.default)({},e,(0,b.default)(t.props.store.allUserStatus[e.name]||{},["status","email","lastLoginTime"]))}))}},{key:"cluster",get:function(){return this.props.match.params.cluster}},{key:"devops",get:function(){return this.props.devopsStore.devops}},{key:"workspace",get:function(){return this.props.match.params.workspace}},{key:"tips",get:function(){return[{title:t("HOW_TO_INVITE_MEMBER_Q"),description:t("HOW_TO_INVITE_MEMBER_A")}]}},{key:"enabledActions",get:function(){return globals.app.getActions({module:"members",devops:this.devops,cluster:this.cluster})}},{key:"itemActions",get:function(){var e=this,r=this.props.trigger;return[{key:"modify",icon:"pen",text:t("CHANGE_ROLE"),action:"edit",show:this.showAction,onClick:function(t){return r("member.edit",N(N({detail:t},e.props.match.params),{},{devops:e.devops,roles:(0,m.toJS)(e.roleStore.list.data),role:t.role,success:e.getData}))}},{key:"delete",icon:"trash",text:t("REMOVE"),action:"delete",show:this.showAction,onClick:function(t){return r("member.remove",N({detail:t,devops:e.devops,success:e.getData},e.props.match.params))}}]}},{key:"tableActions",get:function(){var e=this,r=this.props,n=r.trigger;return N(N({},r.tableProps.tableActions),{},{actions:[{key:"invite",type:"control",text:t("INVITE"),action:"create",onClick:function(){return n("member.invite",{devops:e.devops,workspace:e.workspace,cluster:e.cluster,roles:(0,m.toJS)(e.roleStore.list.data),roleModule:e.roleStore.module,title:t("INVITE_MEMBER"),desc:t("INVITE_MEMBER_DESC_DEVOPS"),searchPlaceholder:t("SEARCH_BY_NAME"),success:e.getData})}}],selectActions:[{key:"delete",type:"danger",text:t("REMOVE"),action:"delete",onClick:function(){return n("member.remove.batch",N({success:e.getData,devops:e.devops},e.props.match.params))}}],getCheckboxProps:function(t){return{disabled:!e.showAction(t),name:t.name}},emptyProps:{desc:t("INVITE_MEMBER_DESC_DEVOPS")}})}}]),n}(h.default.Component))||i;r.default=R},5057:function(e,r,n){"use strict";var a=n(20);n(12),n(5),n(11),n(6),n(84),n(48),n(16),n(9),n(13),n(10),n(4),n(23),n(24),n(17),n(111),n(85),n(62),n(188),n(7),Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0,n(12),n(45),n(5),n(11),n(6),n(84),n(28),n(48),n(42),n(16),n(34),n(15),n(9),n(13),n(10),n(4),n(23),n(57),n(24),n(17),n(111),n(85),n(62),n(188),n(7);var o,i=a(n(30)),l=a(n(36)),s=a(n(37)),u=a(n(55)),c=a(n(56)),d=a(n(51)),f=a(n(0)),p=n(239),h=n(14),m=n(244),v=a(n(189)),g=a(n(1111)),y=n(791),b=n(52),E=a(n(788)),S=a(n(792)),D=a(n(873)),_=a(n(5058));function k(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function O(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?k(Object(r),!0).forEach((function(t){(0,i.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):k(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function w(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,d.default)(e);if(t){var a=(0,d.default)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return(0,c.default)(this,r)}}var N=(0,p.inject)("rootStore","devopsStore")(o=(0,p.observer)(o=(0,y.trigger)(o=function(e){(0,u.default)(n,e);var r=w(n);function n(e){var a;return(0,l.default)(this,n),(a=r.call(this,e)).handleFetch=function(e,t){a.routing.query(e,t)},a.handleCreate=function(){var e=a.props.match.params,t=e.devops,r=e.cluster;a.trigger("devops.credential.create",{devops:t,cluster:r,success:function(){a.getData()}})},a.getColumns=function(){return[{title:t("NAME"),dataIndex:"name",width:"35%",render:function(e){var t="".concat(a.prefix,"/").concat(encodeURIComponent(e));return f.default.createElement(E.default,{to:a.isRuning?null:t,title:e})}},{title:t("TYPE"),dataIndex:"type",width:"25%",render:function(e){return t("CREDENTIAL_TYPE_".concat(e.toUpperCase()))}},{title:t("DESCRIPTION"),dataIndex:"description",render:function(e){return e},width:"25%"},{title:t("CREATION_TIME_TCAP"),dataIndex:"createTime",width:"20%",render:function(e){return(0,b.getLocalTime)(e).format("YYYY-MM-DD HH:mm:ss")}}]},a.store=new g.default,a.formTemplate={},a}return(0,s.default)(n,[{key:"componentDidMount",value:function(){var e=this;this.unsubscribe=this.routing.history.subscribe((function(t){var r=(0,m.parse)(t.search.slice(1)),n=e.props.match.params,a=n.devops,o=n.cluster;e.store.fetchList(O({devops:a,cluster:o},r))}))}},{key:"componentWillUnmount",value:function(){this.unsubscribe&&this.unsubscribe()}},{key:"getData",value:function(){var e=this.props.match.params,t=e.devops,r=e.cluster,n=(0,m.parse)(location.search.slice(1));this.store.fetchList(O({devops:t,cluster:r},n))}},{key:"renderContent",value:function(){var e=(0,h.toJS)(this.store.list),t=e.data,r=e.filters,n=e.isLoading,a=e.total,o=e.page,i=e.limit,l=this.enabledActions.includes("create")?this.handleCreate:null,s=(0,v.default)(r,["page","limit","sortBy"]),u={total:a,page:o,limit:i};return f.default.createElement(D.default,{data:t,columns:this.getColumns(),filters:s,pagination:u,rowKey:"uid",isLoading:n,onFetch:this.handleFetch,onCreate:l,searchType:"name",module:this.module,name:this.name})}},{key:"render",value:function(){return f.default.createElement("div",{className:_.default.wrapper},f.default.createElement(S.default,{title:t("CREDENTIAL_PL"),icon:"key",description:t("DEVOPS_CREDENTIALS_DESC"),module:this.module}),this.renderContent())}},{key:"enabledActions",get:function(){return globals.app.getActions({module:"credentials",cluster:this.props.match.params.cluster,devops:this.props.devopsStore.devops})}},{key:"prefix",get:function(){return this.props.match.url.endsWith("/")?this.props.match.url.slice(0,-1):this.props.match.url}},{key:"routing",get:function(){return this.props.rootStore.routing}},{key:"module",get:function(){return"cridentials"}},{key:"name",get:function(){return"CREDENTIAL"}}]),n}(f.default.Component))||o)||o)||o;r.default=N},5058:function(e,t,r){e.exports={desc:"_2Nbe5kqKE56uXkL5hPraaF",narrowItem:"_9SO50PB09H5PAtUZqbsTX"}},5059:function(e,t,r){"use strict";r(15);var n=r(20);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(r(5060)),o=n(r(5062)),i=n(r(5067)),l=n(r(5108)),s="/:workspace/clusters/:cluster/devops",u=[{path:"".concat(s,"/:devops/pipelines/:name"),component:i.default},{path:"".concat(s,"/:devops/credentials/:credential_id"),component:o.default},{path:"".concat(s,"/:devops/cd/:cd"),component:l.default},{path:"".concat(s,"/:namespace/roles/:name"),component:a.default}];t.default=u},5060:function(e,r,n){"use strict";n(15);var a=n(20);n(12),n(109),n(5),n(84),n(16),n(4),n(23),n(24),n(17),n(85),n(62),Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0,n(12),n(109),n(45),n(5),n(84),n(28),n(42),n(16),n(4),n(23),n(57),n(24),n(17),n(85),n(62);var o,i=a(n(315)),l=a(n(36)),s=a(n(37)),u=a(n(55)),c=a(n(56)),d=a(n(51)),f=a(n(0)),p=n(14),h=n(239),m=a(n(63)),v=n(186),g=n(52),y=n(791),b=a(n(441)),E=a(n(899)),S=a(n(5061));function D(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,d.default)(e);if(t){var a=(0,d.default)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return(0,c.default)(this,r)}}var _=(0,h.inject)("rootStore")(o=(0,h.observer)(o=(0,y.trigger)(o=function(e){(0,u.default)(n,e);var r=D(n);function n(){var e;(0,l.default)(this,n);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(e=r.call.apply(r,[this].concat(o))).store=new b.default,e.fetchData=function(){e.store.fetchDetail(e.props.match.params)},e.getOperations=function(){var r=e.store.detail,n=e.props.isHostCluster;return[{key:"edit",icon:"pen",text:t("EDIT_INFORMATION"),action:"edit",onClick:function(){return e.trigger("resource.baseinfo.edit",{type:e.name,detail:(0,p.toJS)(e.store.detail),success:e.fetchData})}},{key:"editRole",icon:"pen",text:t("EDIT_PERMISSIONS"),action:"edit",show:e.showEdit,onClick:function(){return e.trigger("role.edit",{detail:(0,p.toJS)(e.store.detail),module:n?"devopsroles":"devopsrolesNotHostCluster",roleTemplates:(0,p.toJS)(e.store.roleTemplates.data),roleModules:(0,p.toJS)(e.store.roleCategory),success:e.fetchData})}},{key:"delete",icon:"trash",text:t("DELETE"),action:"delete",type:"danger",show:e.showEdit,onClick:function(){return e.trigger("role.delete",{detail:r,type:e.name,cluster:e.props.match.params.cluster,namespace:e.props.match.params.namespace,success:function(){return e.routing.push(e.listUrl)}})}}]},e.getAttrs=function(){var r=(0,p.toJS)(e.store.detail),n=e.props.match.params,a=n.cluster,o=n.namespace;if(!(0,m.default)(r))return[{name:t("CLUSTER"),value:(0,g.showNameAndAlias)(a,"cluster")},{name:t("DEVOPS_PROJECT"),value:(0,g.showNameAndAlias)(o,"project")},{name:t("CREATION_TIME_TCAP"),value:(0,g.getLocalTime)(r.createTime).format("YYYY-MM-DD HH:mm:ss")},{name:t("UPDATE_TIME_TCAP"),value:(0,g.getLocalTime)(r.updateTime).format("YYYY-MM-DD HH:mm:ss")},{name:t("CREATOR"),value:r.creator}]},e}return(0,s.default)(n,[{key:"componentDidMount",value:function(){this.fetchData(),this.store.fetchRoleTemplates("devops","iam.kubesphere.io/scope=namespace,devops.kubesphere.io/managed=true"),this.store.fetchTemplatesCategory("namespace","devops")}},{key:"render",value:function(){var e={detailStore:this.store};if(this.store.isLoading&&!this.store.detail.name)return f.default.createElement(v.Loading,{className:"ks-page-loading"});var r={module:this.module,name:(0,g.getDisplayName)(this.store.detail),desc:this.store.detail.description,isDevops:!0,operations:this.getOperations(),attrs:this.getAttrs(),breadcrumbs:[{label:t("DEVOPS_PROJECT_ROLE_PL"),url:this.listUrl}]};return f.default.createElement(E.default,(0,i.default)({stores:e},r,{routes:(0,S.default)(this.props.match.path)}))}},{key:"module",get:function(){return"roles"}},{key:"name",get:function(){return"DEVOPS_PROJECT_ROLE"}},{key:"routing",get:function(){return this.props.rootStore.routing}},{key:"listUrl",get:function(){var e=this.props.match.params,t=e.workspace,r=e.cluster,n=e.namespace;return"/".concat(t,"/clusters/").concat(r,"/devops/").concat(n,"/").concat(this.module)}},{key:"showEdit",get:function(){var e=this.props.match.params.name;return!globals.config.presetDevOpsRoles.includes(e)}}]),n}(f.default.Component))||o)||o)||o;r.default=_},5061:function(e,t,r){"use strict";r(15);var n=r(20);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(317),o=n(r(1022)),i=n(r(1074)),l=(0,r(52).withProps)(o.default,{roleType:"devops"});t.default=function(e){return[{path:"".concat(e,"/authorizations"),title:"PERMISSION_PL",component:l,exact:!0},{path:"".concat(e,"/users"),title:"AUTHORIZED_USER_PL",component:i.default,exact:!0},(0,a.getIndexRoute)({path:e,to:"".concat(e,"/authorizations"),exact:!0})]}},5062:function(e,r,n){"use strict";var a=n(20);n(12),n(109),n(5),n(11),n(6),n(9),n(13),n(10),n(4),n(23),n(24),n(17),n(62),n(7),n(110),Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0,n(12),n(109),n(45),n(5),n(11),n(6),n(28),n(42),n(34),n(15),n(9),n(13),n(10),n(4),n(23),n(57),n(24),n(17),n(62),n(7),n(110);var o,i=a(n(315)),l=a(n(30)),s=a(n(36)),u=a(n(37)),c=a(n(55)),d=a(n(56)),f=a(n(51)),p=a(n(0)),h=n(239),m=a(n(1111)),v=a(n(921)),g=a(n(1143)),y=n(791),b=a(n(26)),E=a(n(5064));function S(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function D(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?S(Object(r),!0).forEach((function(t){(0,l.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):S(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function _(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,f.default)(e);if(t){var a=(0,f.default)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return(0,d.default)(this,r)}}var k=(0,h.inject)("rootStore","devopsStore")(o=(0,h.observer)(o=(0,y.trigger)(o=function(e){(0,c.default)(n,e);var r=_(n);function n(){var e;(0,s.default)(this,n);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(e=r.call.apply(r,[this].concat(o))).state={showEdit:!1,showYamlEdit:!1,deleteModule:!1,isLoading:!0},e.refreshTimer=setInterval((function(){return e.refreshHandler()}),4e3),e.store=new m.default(e.module),e.refreshHandler=function(){e.isRuning?e.store.fetchDetail():(clearInterval(e.refreshTimer),e.refreshTimer=null)},e.fetchData=function(){var t=e.props.match.params;e.store.setParams(t),e.store.fetchDetail()},e.getOperations=function(){return[{key:"edit",type:"control",text:t("EDIT"),action:"edit",onClick:function(){e.trigger("devops.credential.edit",{title:t("Edit Credential"),formTemplate:e.store.detail,cluster:e.cluster,devops:e.devops,isEditMode:!0,success:function(){e.store.fetchDetail()}})}},{key:"delete",type:"danger",text:t("DELETE"),action:"delete",onClick:function(){e.trigger("resource.delete",{type:"CREDENTIAL",detail:e.store.detail,success:function(){var t=e.props.match.params,r=t.devops,n=t.workspace,a=t.cluster;e.routing.push("/".concat(n,"/clusters/").concat(a,"/devops/").concat(r,"/").concat(e.module))}})}}]},e.getPipelineStatus=function(e){return D({},{failed:{type:"failure",label:t("FAILED")},pending:{type:"running",label:t("RUNNING")},working:{type:"running",label:t("RUNNING")},successful:{type:"success",label:t("SUCCESSFUL")}}[e])},e.getAttrs=function(){var r=e.store.detail,n=(0,b.default)(r,'annotations["credential.devops.kubesphere.io/syncstatus"]');return[{name:t("TYPE"),value:t(r.type)},{name:t("DESCRIPTION"),value:r.description},{name:t("SYNC_STATUS"),value:p.default.createElement(v.default,e.getPipelineStatus(n))}]},e}return(0,u.default)(n,[{key:"componentDidMount",value:function(){this.fetchData()}},{key:"componentDidUpdate",value:function(){var e=this;null===this.refreshTimer&&this.isRuning&&(this.refreshTimer=setInterval((function(){return e.refreshHandler()}),4e3))}},{key:"componentWillUnmount",value:function(){clearInterval(this.refreshTimer)}},{key:"render",value:function(){var e=this.store.detail,r={detailStore:this.store},n={module:this.module,name:e.id,desc:e.description,operations:this.getOperations(),attrs:this.getAttrs(),breadcrumbs:[{label:t("CREDENTIAL_PL"),url:this.listUrl}]};return p.default.createElement(g.default,(0,i.default)({routes:E.default},n,{stores:r}))}},{key:"module",get:function(){return"credentials"}},{key:"listUrl",get:function(){var e=this.props.match.params,t=e.workspace,r=e.devops,n=e.cluster;return"/".concat(t,"/clusters/").concat(n,"/devops/").concat(r,"/credentials")}},{key:"devops",get:function(){return this.props.match.params.devops}},{key:"cluster",get:function(){return this.props.match.params.cluster}},{key:"routing",get:function(){return this.props.rootStore.routing}},{key:"isRuning",get:function(){var e=this.store.detail,t=(0,b.default)(e,'annotations["credential.devops.kubesphere.io/syncstatus"]');return"pending"===t||"working"===t}}]),n}(p.default.Component))||o)||o)||o;r.default=k},5063:function(e,t,r){e.exports={queued:"_3se7nCtPLY6n0pkWGH_lYi",running:"_3G5m5sJ-coNDKwgZtZlkO5",rotate:"_3n_f3D8x6uIUF6Yh1gj3D",warning:"-fgozp6KbnCWsbI1KcZed",unstable:"_1CwDF8qY2OOhdQbKbGlKRN",failure:"_3RqPGj6-roxFkDQJQFe-kA",error:"_36tdcxdV2LsY3perjvtUlL",aborted:"_1hJsxFgNQmx8-m-TRAk81-",nostatus:"_1_ElD-OOp8geasJyoMh252",success:"_1kNC2aetySWqUnFNDJNoSz",paused:"_3ny_p1tgooD5iQ4tI8cz9L"}},5064:function(e,t,r){"use strict";r(15);var n=r(20);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(317),o=n(r(5065)),i=n(r(5066)),l="/:workspace/clusters/:cluster/devops/:devops/credentials/:credential_id",s=[{path:"".concat(l,"/detail"),title:"DETAILS",component:o.default,exact:!0},{path:"".concat(l,"/activity"),title:"EVENT_PL",component:i.default,exact:!0},(0,a.getIndexRoute)({path:l,to:"".concat(l,"/detail"),exact:!0})];t.default=s},5065:function(e,r,n){"use strict";n(15);var a=n(20);n(5),n(16),n(4),n(23),n(17),Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0,n(45),n(5),n(42),n(16),n(4),n(23),n(57),n(17);var o,i,l,s=a(n(36)),u=a(n(37)),c=a(n(55)),d=a(n(56)),f=a(n(51)),p=a(n(0)),h=a(n(1)),m=n(239),v=n(186),g=a(n(801)),y=a(n(1985));function b(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,f.default)(e);if(t){var a=(0,f.default)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return(0,d.default)(this,r)}}var E=(0,m.inject)("detailStore")(o=(0,m.observer)((l=i=function(e){(0,c.default)(n,e);var r=b(n);function n(){var e;(0,s.default)(this,n);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(e=r.call.apply(r,[this].concat(o))).getColumns=function(){return[{title:t("NAME"),dataIndex:"name",width:"50%"},{title:t("RECORD"),dataIndex:"record",width:"50%"}]},e}return(0,u.default)(n,[{key:"render",value:function(){var e=this.props.detailStore.detail;return p.default.createElement(g.default,{title:t("CREDENTIAL")},p.default.createElement("div",{className:y.default.card_content},p.default.createElement("div",{className:y.default.icon},p.default.createElement(v.Icon,{name:"key",size:40})),p.default.createElement("div",{className:y.default.info},p.default.createElement("div",{className:y.default.name},e.id||"-"),p.default.createElement("div",{className:y.default.desc},t("TYPE_VALUE",{value:t(e.type&&"CREDENTIAL_TYPE_".concat(e.type.toUpperCase()))})))))}}]),n}(p.default.Component),i.propTypes={data:h.default.array,loading:h.default.bool},o=l))||o)||o;r.default=E},5066:function(e,r,n){"use strict";n(15);var a=n(20);n(5),n(18),n(16),n(4),n(23),n(24),n(17),n(62),n(136),Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0,n(45),n(5),n(18),n(42),n(16),n(4),n(23),n(57),n(24),n(17),n(62);var o,i,l,s=a(n(36)),u=a(n(37)),c=a(n(55)),d=a(n(56)),f=a(n(51)),p=a(n(0)),h=n(433),m=n(239),v=a(n(26)),g=n(14),y=a(n(1)),b=n(186),E=a(n(801)),S=a(n(1985));function D(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,f.default)(e);if(t){var a=(0,f.default)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return(0,d.default)(this,r)}}var _=(0,m.inject)("detailStore")(o=(0,m.observer)((l=i=function(e){(0,c.default)(n,e);var r=D(n);function n(){var e;(0,s.default)(this,n);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(e=r.call.apply(r,[this].concat(o))).getColumns=function(){return[{title:t("NAME"),dataIndex:"name",width:"50%"},{title:t("RECORD"),width:"50%",render:function(t){if(t.ranges){var r=t.name.split("/"),n="/".concat(e.workspace,"/clusters/").concat(e.cluster,"/devops/").concat(r[0],"/pipelines/").concat(r[1]).concat(r[2]?"/branch/".concat(r[2]):"","/activity");return p.default.createElement("span",null,t.ranges.ranges.map((function(e){return p.default.createElement(h.Link,{to:n,key:"".concat(e.start).concat(e.end)},"#",e.start,"-#",e.end,"   ")})))}return"-"}}]},e}return(0,u.default)(n,[{key:"render",value:function(){var e=this.props.detailStore,r=e.usage,n=e.isLoading;return p.default.createElement(E.default,{title:t("EVENT_PL")},p.default.createElement(b.Table,{className:S.default.table,dataSource:(0,g.toJS)((0,v.default)(r,"fingerprint.usage",[]))||[],rowKey:"name",columns:this.getColumns(),loading:n}))}},{key:"cluster",get:function(){return this.props.match.params.cluster}},{key:"workspace",get:function(){return this.props.match.params.workspace}}]),n}(p.default.Component),i.propTypes={data:y.default.array,loading:y.default.bool},o=l))||o)||o;r.default=_},5067:function(e,t,r){"use strict";r(15);var n=r(20),a=r(157);r(29),r(4),r(22),r(23),r(24),r(17),r(38),r(62),r(32),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,r(45),r(29),r(42),r(4),r(22),r(23),r(57),r(24),r(17),r(38),r(62),r(32);var o=n(r(43));r(41);var i,l=n(r(44)),s=n(r(36)),u=n(r(37)),c=n(r(55)),d=n(r(56)),f=n(r(51)),p=r(186),h=n(r(26)),m=r(239),v=a(r(0)),g=r(5068),y=r(317),b=n(r(5070));function E(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,f.default)(e);if(t){var a=(0,f.default)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return(0,d.default)(this,r)}}var S=(0,m.inject)("rootStore","devopsStore")(i=(0,m.observer)(i=function(e){(0,c.default)(n,e);var t,r=E(n);function n(e){var t;return(0,s.default)(this,n),(t=r.call(this,e)).store=new((0,g.getPipelinesStore)(t.ksVersion)),t.init(e.match.params),t}return(0,u.default)(n,[{key:"init",value:(t=(0,l.default)(o.default.mark((function e(t){return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.store.initializing=!0,e.next=3,Promise.all([this.props.devopsStore.fetchDetail(t),this.store.fetchDetail(t),this.props.rootStore.getRules({workspace:t.workspace})]);case 3:return e.next=5,this.props.rootStore.getRules({cluster:t.cluster,workspace:t.workspace,devops:t.devops});case 5:this.store.initializing=!1;case 6:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"render",value:function(){return this.store.initializing?v.default.createElement(p.Loading,{className:"ks-page-loading"}):v.default.createElement(m.Provider,{pipelineStore:this.store},(0,y.renderRoutes)(b.default))}},{key:"ksVersion",get:function(){var e,t,r=this.props.match.params.cluster;return(null===(e=window.parent)||void 0===e||null===(t=e.globals)||void 0===t?void 0:t.app.isMultiCluster)?(0,h.default)(window,"parent.globals.clusterConfig.".concat(r,".ksVersion")):(0,h.default)(window,"parent.globals.ksConfig.ksVersion")}}]),n}(v.Component))||i)||i;t.default=S},5068:function(e,t,r){"use strict";r(15);var n=r(20);r(31),Object.defineProperty(t,"__esModule",{value:!0}),t.getPipelinesStore=void 0;var a=n(r(96));r(31),r(4);var o=n(r(960)),i=n(r(5069)),l=r(52);t.getPipelinesStore=function(e){return[[function(e){return(0,l.compareVersion)(e,"3.4.0")<0},i.default],[function(){return!0},o.default]].find((function(t){return(0,(0,a.default)(t,1)[0])(e)}))[1]}},5069:function(e,t,r){"use strict";var n=r(20);r(12),r(5),r(11),r(6),r(86),r(18),r(16),r(9),r(13),r(10),r(4),r(23),r(24),r(17),r(64),r(7),r(110),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,r(12),r(45),r(5),r(11),r(6),r(86),r(160),r(18),r(28),r(42),r(16),r(34),r(15),r(9),r(13),r(10),r(4),r(319),r(22),r(23),r(57),r(24),r(17),r(64),r(7),r(110);var a=n(r(43)),o=n(r(30)),i=n(r(58));r(41);var l,s,u,c,d,f,p,h,m,v,g,y,b,E,S,D,_,k,O,w=n(r(44)),N=n(r(65)),P=n(r(36)),R=n(r(37)),C=n(r(88)),I=n(r(55)),L=n(r(56)),T=n(r(51)),A=n(r(49)),j=(n(r(66)),r(909)),x=n(r(135)),M=n(r(26)),U=n(r(60)),F=n(r(63)),B=n(r(189)),Y=n(r(74)),H=r(14),J=r(52),z=n(r(201)),q=n(r(323));function V(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function K(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?V(Object(r),!0).forEach((function(t){(0,o.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):V(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function G(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,T.default)(e);if(t){var a=(0,T.default)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return(0,L.default)(this,r)}}var W={headers:{"content-type":"application/x-www-form-urlencoded"}},Q=(l=function(e){(0,I.default)(ue,e);var t,r,n,o,l,L,T,A,q,V,Q,X,Z,$,ee,te,re,ne,ae,oe,ie,le,se=G(ue);function ue(){var e;(0,P.default)(this,ue);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return(e=se.call.apply(se,[this].concat(r))).module="pipelines",(0,N.default)(e,"pipelineConfig",s,(0,C.default)(e)),(0,N.default)(e,"originalList",u,(0,C.default)(e)),(0,N.default)(e,"list",c,(0,C.default)(e)),(0,N.default)(e,"branchList",d,(0,C.default)(e)),(0,N.default)(e,"activityList",f,(0,C.default)(e)),(0,N.default)(e,"pullRequestList",p,(0,C.default)(e)),(0,N.default)(e,"credentialsList",h,(0,C.default)(e)),(0,N.default)(e,"detail",m,(0,C.default)(e)),(0,N.default)(e,"isLoading",v,(0,C.default)(e)),(0,N.default)(e,"notFound",g,(0,C.default)(e)),(0,N.default)(e,"repositoryLog",y,(0,C.default)(e)),(0,N.default)(e,"pipelineJsonData",b,(0,C.default)(e)),(0,N.default)(e,"branchDetail",E,(0,C.default)(e)),(0,N.default)(e,"jenkinsfile",S,(0,C.default)(e)),(0,N.default)(e,"devops",D,(0,C.default)(e)),(0,N.default)(e,"devopsName",_,(0,C.default)(e)),(0,N.default)(e,"setPipelineConfig",k,(0,C.default)(e)),(0,N.default)(e,"setSelectRowKeys",O,(0,C.default)(e)),e.saveAsFile=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default.txt",r=new Blob([e],{type:"text/plain;charset=utf-8"});(0,j.saveAs)(r,t)},e}return(0,R.default)(ue,[{key:"getPipelineUrl",value:function(e){var t=e.cluster,r=e.devops,n=e.name;return"".concat(this.getDevopsUrlV2({cluster:t,devops:r||this.devops}),"pipelines/").concat(decodeURIComponent(n),"/")}},{key:"fetchList",value:(le=(0,w.default)(a.default.mark((function e(){var t,r,n,o,l,s,u,c,d,f,p,h,m,v,g=this,y=arguments;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=y.length>0&&void 0!==y[0]?y[0]:{},r=t.devops,t.workspace,n=t.devopsName,o=t.silent,l=t.cluster,s=(0,i.default)(t,["devops","workspace","devopsName","silent","cluster"]),o||(this.list.isLoading=!0),u=s.page,c=s.limit,d=s.name,f=s.filter,p=d?"".concat(encodeURIComponent(d)):void 0,h="".concat(this.getBaseUrl({cluster:l,devops:r}),"pipelines"),e.next=7,request.get(h,{page:u||1,limit:c||10,name:p,filter:f||void 0},{params:K({},s)});case 7:m=e.sent,v=m.items.map((function(e){return K({},g.mapper(e))})),this.setDevops(r),this.devopsName=n,this.list={data:v||[],total:m.totalItems||0,limit:parseInt(c,10)||10,page:parseInt(u,10)||1,filters:(0,B.default)(s,"devops"),selectedRowKeys:[],isLoading:!1};case 12:case"end":return e.stop()}}),e,this)}))),function(){return le.apply(this,arguments)})},{key:"fetchDetail",value:(ie=(0,w.default)(a.default.mark((function e(t){var r,n,o,i,l,s;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.cluster,n=t.name,o=t.isSilent,i=t.devops,o||(this.isLoading=!0),e.next=4,request.get("".concat(this.getBaseUrl({devops:i,cluster:r})).concat(this.module,"/").concat(n));case 4:return l=e.sent,s=this.mapper(l),this.setPipelineConfig(l),this.detail=s,this.isLoading=!1,e.abrupt("return",s);case 10:case"end":return e.stop()}}),e,this)}))),function(e){return ie.apply(this,arguments)})},{key:"checkPipelineName",value:(oe=(0,w.default)(a.default.mark((function e(t){var r,n,o;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.name,n=t.cluster,o=t.devops,e.next=3,request.get(this.getPipelineUrl({cluster:n,name:r,devops:o}),{},{headers:{"x-check-exist":!0}});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return oe.apply(this,arguments)})},{key:"getJenkinsFile",value:(ae=(0,w.default)(a.default.mark((function e(t){var r,n,o,i,l;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.cluster,n=t.name,o=t.devops,this.pipelineJsonData.isLoading=!0,i=decodeURIComponent(n),!(0,F.default)(this.detail)){e.next=6;break}return e.next=6,this.fetchDetail({cluster:r,name:i,devops:o});case 6:return this.jenkinsfile=(0,M.default)(this.pipelineConfig,"spec.pipeline.jenkinsfile",""),e.next=9,this.convertJenkinsFileToJson((0,H.toJS)(this.jenkinsfile),r);case 9:l=e.sent,this.pipelineJsonData={pipelineJson:l,isLoading:!1};case 11:case"end":return e.stop()}}),e,this)}))),function(e){return ae.apply(this,arguments)})},{key:"convertJenkinsFileToJson",value:(ne=(0,w.default)(a.default.mark((function e(t,r){var n;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=5;break}return e.next=3,request.post("".concat(this.getDevopsUrlV2({cluster:r}),"tojson"),{jenkinsfile:t},W);case 3:return n=e.sent,e.abrupt("return",n.data);case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return ne.apply(this,arguments)})},{key:"getPullRequest",value:(re=(0,w.default)(a.default.mark((function e(t){var r,n,o,l,s,u,c,d,f;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.name,n=t.devops,t.workspace,o=t.cluster,l=(0,i.default)(t,["name","devops","workspace","cluster"]),s=decodeURIComponent(r),u=l.page,c=l.limit,d=void 0===c?10:c,!(0,F.default)(this.detail)){e.next=6;break}return e.next=6,this.fetchDetail({name:s,devops:n});case 6:return e.next=8,request.get("".concat(this.getBaseUrl({cluster:o,namespace:n}),"pipelines/").concat(decodeURIComponent(r),"/branches"),{filter:"pull-requests",page:u||1,limit:d});case 8:f=e.sent,Array.isArray(f.items)&&f.items.forEach((function(e){e.id=e.latestRun.endTime})),this.pullRequestList={data:f.items||[],total:f.totalItems||0,limit:d,page:parseInt(u,10)||1,filters:(0,B.default)(l,"devops"),isLoading:!1,selectedRowKeys:[]};case 11:case"end":return e.stop()}}),e,this)}))),function(e){return re.apply(this,arguments)})},{key:"getBranches",value:(te=(0,w.default)(a.default.mark((function e(t){var r,n,o,l,s,u,c,d,f,p;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.cluster,n=t.devops,o=t.name,l=t.branch,s=(0,i.default)(t,["cluster","devops","name","branch"]),u=decodeURIComponent(o),c=s.page,d=s.limit,f=void 0===d?10:d,!(0,F.default)(this.detail)){e.next=6;break}return e.next=6,this.fetchDetail({cluster:r,name:u,devops:n});case 6:return e.next=8,request.get("".concat(this.getBaseUrl({cluster:r,namespace:n}),"pipelines/").concat(decodeURIComponent(o),"/branches"),{filter:"origin",page:c||1,limit:f,branch:encodeURIComponent(l)});case 8:p=e.sent,this.branchList={data:p.items||[],limit:f,total:p.totalItems||0,page:parseInt(c,10)||1,filters:(0,B.default)(s,"devops"),isLoading:!1,selectedRowKeys:[]};case 10:case"end":return e.stop()}}),e,this)}))),function(e){return te.apply(this,arguments)})},{key:"getActivities",value:(ee=(0,w.default)(a.default.mark((function e(t){var r,n,o,l,s,u,c,d,f,p,h,m;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.name,n=t.branch,o=t.devops,l=t.cluster,s=t.backward,u=void 0!==s&&s,c=(0,i.default)(t,["name","branch","devops","cluster","backward"]),r=decodeURIComponent(r),d=c.page,f=c.limit,p=void 0===f?10:f,!(0,F.default)(this.detail)){e.next=6;break}return e.next=6,this.fetchDetail({cluster:l,name:r,devops:o});case 6:return h={page:d||1,limit:p,branch:n,backward:u},d<0&&(delete h.page,delete h.limit),e.next=10,request.get("".concat(this.getBaseUrl({cluster:l,namespace:o}),"pipelines/").concat(r,"/pipelineruns"),K({},h));case 10:return m=e.sent,(0,U.default)(m)&&(m=m.filter((function(e){return e._links}))),!1===u&&!(0,F.default)(m)&&(0,U.default)(m.items)&&(m.items=m.items.map((function(e){return K(K({},(0,J.safeParseJSON)((0,M.default)(e,"metadata.annotations.['devops.kubesphere.io/jenkins-pipelinerun-status']"))),{},{uid:e.metadata.uid,_originData:e})}))),this.activityList={limit:p,data:m.items||[],total:m.totalItems||0,page:parseInt(d,10)||1,filters:(0,B.default)(c,"devops"),isLoading:!1,selectedRowKeys:[]},e.abrupt("return",m.items);case 15:case"end":return e.stop()}}),e,this)}))),function(e){return ee.apply(this,arguments)})},{key:"getBranchDetail",value:($=(0,w.default)(a.default.mark((function e(t){var r,n,o,i,l;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.devops,n=t.cluster,o=t.name,i=t.branch,e.prev=1,e.next=4,request.get("".concat(this.getBaseUrl({cluster:n,namespace:r}),"pipelines/").concat(decodeURIComponent(o),"/branches/").concat(encodeURIComponent(i)));case 4:return(l=e.sent).name&&(this.branchDetail=l),e.abrupt("return",l);case 9:return e.prev=9,e.t0=e.catch(1),e.abrupt("return",[]);case 12:case"end":return e.stop()}}),e,this,[[1,9]])}))),function(e){return $.apply(this,arguments)})},{key:"handleActivityReplay",value:(Z=(0,w.default)(a.default.mark((function e(t){var r,n,o,i;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.url,n=t.devops,o=t.name,i=t.cluster,e.next=3,request.post("".concat(this.getPipelineUrl({cluster:i,devops:n,name:o})).concat(r,"/replay/"));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return Z.apply(this,arguments)})},{key:"handleActivityStop",value:(X=(0,w.default)(a.default.mark((function e(t){var r,n,o,i;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.url,n=t.devops,o=t.name,i=t.cluster,e.next=3,request.post("".concat(this.getPipelineUrl({cluster:i,devops:n,name:o})).concat(r,"/stop/?blocking=true&timeOutInSecs=10"));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return X.apply(this,arguments)})},{key:"runBranch",value:(Q=(0,w.default)(a.default.mark((function e(t){var r,n,o,i,l,s,u,c=this;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.cluster,n=t.devops,o=t.name,i=t.branch,l=t.parameters,s="".concat(this.getBaseUrl({cluster:r,namespace:n}),"pipelines/").concat(o,"/pipelineruns").concat(i?"?branch=".concat(encodeURIComponent(i)):""),u=(0,F.default)(l)?{parameters:[]}:{parameters:l},e.next=5,request.post(s,u).then((function(){setTimeout((function(){c.fetchDetail({cluster:r,devops:n,name:o,isSilent:!0})}),1e3)}));case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return Q.apply(this,arguments)})},{key:"getPipeLineConfig",value:function(){var e=(0,x.default)((0,H.toJS)(this.pipelineConfig));return delete(e=K(K({},(0,H.toJS)(e.spec)),(0,H.toJS)(e))).spec,delete e.kind,delete e.apiVersion,e}},{key:"setDevops",value:function(e){this.devops=e}},{key:"createPipeline",value:(V=(0,w.default)(a.default.mark((function e(t){var r,n,o,i;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.data,n=t.devops,o=t.cluster,r.kind="Pipeline",r.apiVersion="devops.kubesphere.io/v1alpha3",i="".concat(this.getBaseUrl({devops:n,cluster:o}),"pipelines"),e.next=6,request.post(i,r);case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return V.apply(this,arguments)})},{key:"updatePipeline",value:(q=(0,w.default)(a.default.mark((function e(t){var r,n,o,i,l;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.cluster,n=t.data,o=t.devops,n.kind="Pipeline",n.apiVersion="devops.kubesphere.io/v1alpha3",i="".concat(this.getBaseUrl({devops:o,cluster:r}),"pipelines/").concat(n.metadata.name),e.next=6,request.put(i,n);case 6:return l=e.sent,this.setPipelineConfig(l),e.abrupt("return",l);case 9:case"end":return e.stop()}}),e,this)}))),function(e){return q.apply(this,arguments)})},{key:"updateJenkinsFile",value:function(e,t){var r=(0,x.default)((0,H.toJS)(this.pipelineConfig));return(0,Y.default)(r,"spec.pipeline.jenkinsfile",e),this.updatePipeline({data:r,devops:t.devops,cluster:t.cluster})}},{key:"delete",value:(A=(0,w.default)(a.default.mark((function e(t){var r,n,o,i;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.name,n=t.devops,o=t.cluster,i="".concat(this.getBaseUrl({devops:n,cluster:o}),"pipelines/").concat(r),e.next=4,request.delete(i);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return A.apply(this,arguments)})},{key:"scanRepository",value:(T=(0,w.default)(a.default.mark((function e(t){var r,n,o,i;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.devops,n=t.name,o=t.cluster,i={},e.next=4,request.defaults({method:"POST",url:"".concat(this.getPipelineUrl({cluster:o,devops:r||this.devops,name:n||this.detail.name}),"scan"),options:i,handler:function(e){return e.text().then((function(){if(e.redirected)return"Scan success"}))}});case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return T.apply(this,arguments)})},{key:"getRepoScanLogs",value:(L=(0,w.default)(a.default.mark((function e(t){var r,n,o,i;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.devops,n=t.name,o=t.cluster,e.next=3,request.get("".concat(this.getPipelineUrl({cluster:o,name:n,devops:r}),"consolelog"));case 3:i=e.sent,this.repositoryLog=i;case 5:case"end":return e.stop()}}),e,this)}))),function(e){return L.apply(this,arguments)})},{key:"checkCron",value:(l=(0,w.default)(a.default.mark((function e(t){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,request.get("".concat(this.getDevopsUrlV2(),"check/cron?value=").concat(t));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"checkScriptCompile",value:(o=(0,w.default)(a.default.mark((function e(t){var r,n,o,i;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.devops,n=t.pipeline,o=t.value,i=t.cluster,e.abrupt("return",this.submitting(request.post("".concat(this.getPipelineUrl({cluster:i,name:n,devops:r}),"checkScriptCompile"),{value:o},W)));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"getBranchLists",value:(n=(0,w.default)(a.default.mark((function e(t){var r,n,o,l,s,u,c;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.devops,n=t.name,t.workspace,o=t.cluster,l=(0,i.default)(t,["devops","name","workspace","cluster"]),s=l.page,u=l.limit,c=void 0===u?10:u,e.next=4,request.get("".concat(this.getPipelineUrl({cluster:o,name:n,devops:r}),"branches/"),{filter:"origin",start:(s-1)*c||0,limit:c});case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"getPipelineTemplateList",value:(r=(0,w.default)(a.default.mark((function e(t){var r,n,o,i;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="zh"===(0,z.default)("lang")?"ZH":"EN",e.next=3,request.get("".concat(this.getBaseUrl(t),"clustertemplates?limit=100"));case 3:return n=e.sent,o=n.items,i=(void 0===o?[]:o).map((function(e){var t={},n=(0,M.default)(e,"metadata.annotations",{}),a=n["devops.kubesphere.io/icon"];return t.type=e.metadata.name,t.desc=n["devops.kubesphere.io/description".concat(r)]||n["devops.kubesphere.io/descriptionEN"],t.title=n["devops.kubesphere.io/displayName".concat(r)]||n["devops.kubesphere.io/displayNameEN"]||n.displayNameEN,t.image=a&&a.indexOf("http")>-1?a:"/assets/pipeline/".concat(a),t.parameters=(0,M.default)(e,"spec.parameters",[]),t})),e.abrupt("return",i);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"getTempleJenkins",value:(t=(0,w.default)(a.default.mark((function e(t,r,n){var o,i;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,request.post("".concat(this.getBaseUrl(n),"clustertemplates/").concat(t,"/render"),r);case 2:return o=e.sent,i=(0,M.default)(o,'metadata.annotations["devops.kubesphere.io/render-result"]',""),e.abrupt("return",i);case 5:case"end":return e.stop()}}),e,this)}))),function(e,r,n){return t.apply(this,arguments)})}]),ue}(q.default),s=(0,A.default)(l.prototype,"pipelineConfig",[H.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{}}}),u=(0,A.default)(l.prototype,"originalList",[H.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),c=(0,A.default)(l.prototype,"list",[H.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{data:[],page:1,limit:10,total:0,order:"",reverse:!1,filters:{},isLoading:!0}}}),d=(0,A.default)(l.prototype,"branchList",[H.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{data:[],page:1,limit:10,total:0,order:"",reverse:!1,filters:{},isLoading:!0}}}),f=(0,A.default)(l.prototype,"activityList",[H.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{data:[],page:1,limit:10,total:0,order:"",reverse:!1,filters:{},isLoading:!0}}}),p=(0,A.default)(l.prototype,"pullRequestList",[H.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{data:[],page:1,limit:10,total:0,order:"",reverse:!1,filters:{},isLoading:!0,selectedRowKeys:[]}}}),h=(0,A.default)(l.prototype,"credentialsList",[H.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{data:[],total:0,isLoading:!0}}}),m=(0,A.default)(l.prototype,"detail",[H.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{}}}),v=(0,A.default)(l.prototype,"isLoading",[H.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),g=(0,A.default)(l.prototype,"notFound",[H.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),y=(0,A.default)(l.prototype,"repositoryLog",[H.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),b=(0,A.default)(l.prototype,"pipelineJsonData",[H.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{pipelineJson:{},isLoading:!0}}}),E=(0,A.default)(l.prototype,"branchDetail",[H.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{}}}),S=(0,A.default)(l.prototype,"jenkinsfile",[H.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),D=(0,A.default)(l.prototype,"devops",[H.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),_=(0,A.default)(l.prototype,"devopsName",[H.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),(0,A.default)(l.prototype,"fetchList",[H.action],Object.getOwnPropertyDescriptor(l.prototype,"fetchList"),l.prototype),(0,A.default)(l.prototype,"fetchDetail",[H.action],Object.getOwnPropertyDescriptor(l.prototype,"fetchDetail"),l.prototype),k=(0,A.default)(l.prototype,"setPipelineConfig",[H.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){e.pipelineConfig=t}}}),O=(0,A.default)(l.prototype,"setSelectRowKeys",[H.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){e.list.selectedRowKeys.replace(t)}}}),(0,A.default)(l.prototype,"checkPipelineName",[H.action],Object.getOwnPropertyDescriptor(l.prototype,"checkPipelineName"),l.prototype),(0,A.default)(l.prototype,"getJenkinsFile",[H.action],Object.getOwnPropertyDescriptor(l.prototype,"getJenkinsFile"),l.prototype),(0,A.default)(l.prototype,"convertJenkinsFileToJson",[H.action],Object.getOwnPropertyDescriptor(l.prototype,"convertJenkinsFileToJson"),l.prototype),(0,A.default)(l.prototype,"getPullRequest",[H.action],Object.getOwnPropertyDescriptor(l.prototype,"getPullRequest"),l.prototype),(0,A.default)(l.prototype,"getBranches",[H.action],Object.getOwnPropertyDescriptor(l.prototype,"getBranches"),l.prototype),(0,A.default)(l.prototype,"getActivities",[H.action],Object.getOwnPropertyDescriptor(l.prototype,"getActivities"),l.prototype),(0,A.default)(l.prototype,"getBranchDetail",[H.action],Object.getOwnPropertyDescriptor(l.prototype,"getBranchDetail"),l.prototype),(0,A.default)(l.prototype,"getPipeLineConfig",[H.action],Object.getOwnPropertyDescriptor(l.prototype,"getPipeLineConfig"),l.prototype),(0,A.default)(l.prototype,"setDevops",[H.action],Object.getOwnPropertyDescriptor(l.prototype,"setDevops"),l.prototype),(0,A.default)(l.prototype,"createPipeline",[H.action],Object.getOwnPropertyDescriptor(l.prototype,"createPipeline"),l.prototype),(0,A.default)(l.prototype,"updatePipeline",[H.action],Object.getOwnPropertyDescriptor(l.prototype,"updatePipeline"),l.prototype),(0,A.default)(l.prototype,"updateJenkinsFile",[H.action],Object.getOwnPropertyDescriptor(l.prototype,"updateJenkinsFile"),l.prototype),(0,A.default)(l.prototype,"delete",[H.action],Object.getOwnPropertyDescriptor(l.prototype,"delete"),l.prototype),(0,A.default)(l.prototype,"scanRepository",[H.action],Object.getOwnPropertyDescriptor(l.prototype,"scanRepository"),l.prototype),l);t.default=Q},5070:function(e,t,r){"use strict";r(15);var n=r(20);r(31),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(r(96));r(31),r(4);var o=r(52),i=r(317),l=r(5071),s=n(r(5104)),u=n(r(5106)),c=n(r(5107)),d="/:workspace/clusters/:cluster/devops/:devops/pipelines/:name",f="".concat(d,"/branch/:branch"),p="".concat(f,"/run/:runName"),h="".concat(d,"/run/:runName"),m=[{name:"pipeline",title:"PIPELINE_CONFIGURATION",getComponent:function(e){return[[function(e){return(0,o.compareVersion)(e,"3.4.0")<0},l.PipelineOld],[function(){return!0},l.Pipeline]].find((function(t){return(0,(0,a.default)(t,1)[0])(e)}))[1]}},{name:"code-quality",title:"CODE_CHECK",component:l.CodeQuality},{name:"activity",title:"RUN_RECORDS",component:l.Activity},{name:"branch",title:"BRANCH_PL",component:l.Branch},{name:"pull-request",title:"PULL_REQUEST_PL",component:l.PullRequest}],v=[{name:"activity",title:"RUN_RECORDS",component:l.Activity},{name:"code-quality",title:"CODE_CHECK",component:l.CodeQuality}],g=[{name:"task-status",title:"TASK_STATUS",component:l.TaskStatus},{name:"build-parameters",title:"BUILD_PARAMETERS",component:l.Parameters},{name:"commit",title:"COMMIT_PL",component:l.Commit},{name:"artifacts",title:"ARTIFACT_PL",component:l.Artifacts},{name:"events",title:"EVENT_PL",component:l.Events}],y=[{path:p,component:c.default,routes:(0,i.getChildRoutes)(g,p)},{path:h,component:c.default,routes:(0,i.getChildRoutes)(g,h)},{path:f,component:s.default,routes:(0,i.getChildRoutes)(v,f)},{path:d,component:u.default,routes:(0,i.getChildRoutes)(m,d)}];t.default=y},5071:function(e,t,r){"use strict";r(15);var n=r(20);Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"Branch",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(t,"Pipeline",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(t,"PipelineOld",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(t,"PullRequest",{enumerable:!0,get:function(){return l.default}}),Object.defineProperty(t,"Activity",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(t,"TaskStatus",{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(t,"Commit",{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(t,"Artifacts",{enumerable:!0,get:function(){return d.default}}),Object.defineProperty(t,"CodeQuality",{enumerable:!0,get:function(){return f.default}}),Object.defineProperty(t,"Events",{enumerable:!0,get:function(){return p.default}}),Object.defineProperty(t,"Parameters",{enumerable:!0,get:function(){return h.default}});var a=n(r(5072)),o=n(r(5073)),i=n(r(5075)),l=n(r(5077)),s=n(r(5079)),u=n(r(5080)),c=n(r(5093)),d=n(r(5094)),f=n(r(5095)),p=n(r(5100)),h=n(r(5101))},5072:function(e,r,n){"use strict";var a=n(20);n(12),n(5),n(11),n(6),n(84),n(48),n(16),n(9),n(13),n(10),n(4),n(23),n(24),n(17),n(85),n(62),n(188),n(7),n(110),Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0,n(12),n(45),n(5),n(11),n(6),n(84),n(28),n(48),n(42),n(16),n(34),n(15),n(9),n(13),n(10),n(4),n(22),n(23),n(57),n(24),n(17),n(85),n(62),n(188),n(7),n(110);var o=a(n(30)),i=a(n(43));n(41);var l,s=a(n(44)),u=a(n(36)),c=a(n(37)),d=a(n(55)),f=a(n(56)),p=a(n(51)),h=a(n(26)),m=a(n(189)),v=a(n(63)),g=a(n(0)),y=n(14),b=n(239),E=n(244),S=a(n(1423)),D=n(186),_=a(n(240)),k=a(n(921)),O=a(n(1251)),w=n(52),N=n(434),P=n(1144),R=a(n(796)),C=a(n(963)),I=a(n(3));function L(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function T(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?L(Object(r),!0).forEach((function(t){(0,o.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):L(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function A(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,p.default)(e);if(t){var a=(0,p.default)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return(0,f.default)(this,r)}}var j=(0,b.inject)("rootStore","detailStore")(l=(0,b.observer)(l=function(e){(0,d.default)(n,e);var r=A(n);function n(){var e;(0,u.default)(this,n);for(var a=arguments.length,o=new Array(a),l=0;l<a;l++)o[l]=arguments[l];return(e=r.call.apply(r,[this].concat(o))).name="branch",e.store=e.props.detailStore||{},e.refreshTimer=setInterval((function(){return e.getData()}),4e3),e.refreshHandler=function(){e.isRuning?e.getData():(clearInterval(e.refreshTimer),e.refreshTimer=null)},e.handleFetch=function(t,r){e.routing.query(t,r)},e.handleScanRepository=(0,s.default)(i.default.mark((function r(){var n,a;return i.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=e.props.match.params,a=e.props.detailStore.detail,r.next=4,e.props.detailStore.scanRepository({devops:n.devops,cluster:n.cluster,name:a.name});case 4:e.store.fetchDetail(n),_.default.success({content:t("SCAN_REPO_SUCCESSFUL")});case 6:case"end":return r.stop()}}),r)}))),e.getColumns=function(){return[{title:t("STATUS"),dataIndex:"status",width:"20%",render:function(e,r){return r.disabled?g.default.createElement(k.default,{label:t("DISABLED"),type:"error"}):g.default.createElement(k.default,(0,N.getPipelineStatus)((0,h.default)(r,"latestRun",{})))}},{title:t("NAME"),dataIndex:"name",width:"20%",render:function(t,r){return g.default.createElement(S.default,{className:(0,I.default)("item-name",{}),to:"".concat(e.prefix,"/").concat(t,"/activity")},g.default.createElement(P.ReactComponent,{style:{width:"20px",height:"20px"}}),r.disabled?g.default.createElement("del",null,decodeURIComponent(t)):decodeURIComponent(t))}},{title:t("HEALTH_STATUS"),dataIndex:"weatherScore",width:"20%",render:function(e){return g.default.createElement(O.default,{score:e})}},{title:t("UPDATE_TIME_TCAP"),dataIndex:"updateTime",width:"20%",render:function(e,t){var r;return(null==t||null===(r=t.latestRun)||void 0===r?void 0:r.startTime)?(0,w.getLocalTime)(t.latestRun.startTime).format("YYYY-MM-DD HH:mm:ss"):"-"}}]},e}return(0,c.default)(n,[{key:"componentDidMount",value:function(){var e=this,t=this.props.match.params;this.unsubscribe=this.routing.history.subscribe((function(r){if(r.pathname===e.props.match.url){var n=(0,E.parse)(r.search.slice(1));e.store.getBranches(T(T({},t),n))}}))}},{key:"componentDidUpdate",value:function(){var e=this;null===this.refreshTimer&&this.isRuning&&(this.refreshTimer=setInterval((function(){return e.refreshHandler()}),4e3))}},{key:"componentWillUnmount",value:function(){clearInterval(this.refreshTimer),this.unsubscribe&&this.unsubscribe()}},{key:"getData",value:function(){var e=this.props.match.params,t=(0,E.parse)(location.search.slice(1));this.store.getBranches(T(T({},e),t))}},{key:"render",value:function(){var e=(0,y.toJS)(this.store.branchList),r=e.data,n=e.filters,a=e.isLoading,o=e.total,i=e.page,l=e.limit,s=!1===a&&0===o,u=(0,m.default)(n,"page","workspace"),c=this.enabledActions.includes("edit"),d={total:o,page:i,limit:l};return s&&!n.page?g.default.createElement(C.default,{desc:t("NO_BRANCHES_FOUND")},c&&g.default.createElement(D.Button,{type:"control",onClick:this.handleScanRepository},t("SCAN_REPOSITORY"))):g.default.createElement(R.default,{rowKey:"displayName",data:r,columns:this.getColumns(),filters:u,pagination:d,isLoading:a,onFetch:this.handleFetch,hideSearch:!0})}},{key:"enabledActions",get:function(){var e=this.props.match.params,t=e.cluster,r=e.devops;return globals.app.getActions({module:"pipelines",cluster:t,devops:r})}},{key:"isRuning",get:function(){var e=(0,h.default)((0,y.toJS)(this.store),"branchList.data",[]).filter((function(e){var t=(0,h.default)(e,"latestRun.state");return t&&"FINISHED"!==t&&"PAUSED"!==t}));return!(0,v.default)(e)}},{key:"routing",get:function(){return this.props.rootStore.routing}},{key:"prefix",get:function(){return this.props.match.url}}]),n}(g.default.Component))||l)||l;r.default=j},5073:function(e,r,n){"use strict";var a=n(20);n(12),n(5),n(11),n(6),n(84),n(16),n(9),n(13),n(10),n(4),n(23),n(24),n(17),n(85),n(62),n(7),Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0,n(12),n(45),n(5),n(11),n(6),n(84),n(28),n(42),n(16),n(34),n(15),n(9),n(13),n(10),n(4),n(22),n(23),n(57),n(24),n(17),n(85),n(62),n(7);var o=a(n(43)),i=a(n(30));n(41);var l,s=a(n(44)),u=a(n(36)),c=a(n(37)),d=a(n(55)),f=a(n(56)),p=a(n(51)),h=n(186),m=a(n(240)),v=a(n(963)),g=a(n(1125)),y=a(n(800)),b=a(n(63)),E=n(14),S=n(239),D=a(n(0)),_=n(791),k=a(n(5074));function O(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function w(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?O(Object(r),!0).forEach((function(t){(0,i.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):O(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function N(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,p.default)(e);if(t){var a=(0,p.default)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return(0,f.default)(this,r)}}var P=(0,S.inject)("rootStore","detailStore")(l=(0,S.observer)(l=(0,_.trigger)(l=function(e){(0,d.default)(n,e);var r=N(n);function n(){var e;(0,u.default)(this,n);for(var a=arguments.length,i=new Array(a),l=0;l<a;l++)i[l]=arguments[l];return(e=r.call.apply(r,[this].concat(i))).store=e.props.detailStore||{},e.formTemplate={},e.handlePipelineModal=function(){var r=e.store,n=r.pipelineJsonData,a=r.pipelineConfig,o=(0,E.toJS)(a.spec.pipeline.jenkinsfile),i=e.props.match.params;e.trigger("pipeline.pipelineTemplate",{store:e.store,jsonData:(0,E.toJS)(n.pipelineJson),formTemplate:e.formTemplate,title:t("CREATE_PIPELINE"),imageIcon:"/assets/pipeline/pipeline-icon-dark.svg",description:t("CREATE_PIPELINE_DESC"),width:"960px",contentWidth:"960px",noCodeEdit:!0,params:i,onCancel:function(){return e.handleReset(o)},success:function(r){var n=r.jenkinsFile,a=r.jsonData,l=r.mode;"custom"===r.template?e.trigger("pipeline.pipelineCreate",{store:e.store,jsonData:{},params:i,trigger:function(){var t;(t=e).trigger.apply(t,arguments)},onCancel:function(){return e.handleReset(o)},success:function(){var t=i.devops,r=i.name;localStorage.removeItem("".concat(globals.user.username,"-").concat(t,"-").concat(r)),e.handleRefresh()}}):l?(m.default.success({content:t("CREATE_SUCCESSFUL")}),e.handleRefresh()):(e.store.updateJenkinsFile(n),(0,b.default)(a)?e.handleJenkinsFileModal(void 0,(function(){return e.handleReset(o)})):(e.store.setPipelineJsonData(a),e.handleEditorPipelineModal(void 0,(function(){return e.handleReset(o)}))))}})},e.handleReset=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=e.props.match.params,n=r.devops,a=r.name,o=r.cluster;clearTimeout(e.store.timer);var i=o&&"default"!==o?"/klusters/".concat(o):"";request.put("/kapis/devops.kubesphere.io/v1alpha3".concat(i,"/namespaces/").concat(n,"/pipelines/").concat(a,"/jenkinsfile?mode=raw"),{data:t},{headers:{"content-type":"application/json"}}).then(e.handleRefresh)},e.handleEditorPipelineModal=function(t,r){var n=e.store.pipelineJsonData,a=e.props.match.params;e.trigger("pipeline.pipelineCreate",{store:e.store,jsonData:(0,E.toJS)(n.pipelineJson),onCancel:r,params:a,trigger:function(){var t;(t=e).trigger.apply(t,arguments)},success:function(){var t=a.devops,r=a.name;localStorage.removeItem("".concat(globals.user.username,"-").concat(t,"-").concat(r)),e.handleRefresh()}})},e.handleJenkinsFileModal=function(t,r){var n=e.store.pipelineConfig,a=e.props.match.params;e.trigger("pipeline.jenkins",{store:e.store,defaultValue:(0,E.toJS)(n.spec.pipeline.jenkinsfile),onCancel:r,params:a,success:function(){var t=a.devops,r=a.name;localStorage.removeItem("".concat(globals.user.username,"-").concat(t,"-").concat(r)),e.handleRefresh()}})},e.getData=(0,s.default)(o.default.mark((function t(){var r,n;return o.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.props.match.params,n=decodeURIComponent(r.name),t.next=4,e.store.getJenkinsFile(w(w({},r),{},{name:n}));case 4:e.store.getActivities(r),e.jenkinsFileMode&&e.handleRefresh();case 6:case"end":return t.stop()}}),t)}))),e.handleRefresh=(0,s.default)(o.default.mark((function t(){var r,n;return o.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.props.match.params,n=decodeURIComponent(r.name),t.next=4,e.store.getJenkinsFile(w(w({},r),{},{name:n}),!0);case 4:e.jenkinsFileMode&&e.store.fetchDetailUntilEditModeNull(w(w({},r),{},{name:n})).then((function(t){e.store.detail=t,e.store.setPipelineConfig(t._originData)}));case 5:case"end":return t.stop()}}),t)}))),e.handleRunning=(0,y.default)((0,s.default)(o.default.mark((function t(){var r,n,a,i;return o.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.props.match.params,t.next=3,e.store.fetchDetail(r);case 3:n=e.store.detail,a=!(0,b.default)((0,E.toJS)(n.branchNames)),i=!(0,b.default)((0,E.toJS)(n.parameters)),a||i?e.trigger("pipeline.params",{devops:r.devops,cluster:r.cluster,params:r,branches:(0,E.toJS)(n.branchNames),disabledBrancheNames:(0,E.toJS)(n.disabledBranchNames),parameters:(0,E.toJS)(n.parameters),success:function(){e.props.rootStore.routing.push("./activity")}}):e.handleRunSubmit();case 7:case"end":return t.stop()}}),t)}))),500),e.handleRunSubmit=function(){var t=(0,s.default)(o.default.mark((function t(r,n){var a,i,l,s;return o.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=e.store.detail,i=e.props.match.params,l=i.devops,s=i.cluster,t.next=4,e.store.runBranch({name:a.name,branch:n,parameters:r,cluster:s,devops:l});case 4:e.props.rootStore.routing.push("./activity");case 5:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}(),e}return(0,c.default)(n,[{key:"componentDidMount",value:function(){!this.isMultibranch&&this.editable?this.getData():this.props.rootStore.routing.push("./activity")}},{key:"renderBtnGroup",value:function(){if(this.editable)return D.default.createElement("div",{className:k.default.pipelineCard__btnGroup},"json"===this.jenkinsFileMode?D.default.createElement(h.Tooltip,{content:t("JENKINS_UNAVAILABLE")},D.default.createElement(h.Button,{className:k.default["btn-disabled"]},t("EDIT_JENKINSFILE"))):D.default.createElement(h.Button,{onClick:this.handleJenkinsFileModal},t("EDIT_JENKINSFILE")),"raw"===this.jenkinsFileMode?D.default.createElement(h.Tooltip,{content:t("JENKINS_UNAVAILABLE")},D.default.createElement(h.Button,{className:k.default["btn-disabled"]},t("EDIT_PIPELINE"))):D.default.createElement(h.Button,{onClick:this.handleEditorPipelineModal},t("EDIT_PIPELINE")),D.default.createElement(h.Button,{type:"control",onClick:this.handleRunning},t("RUN")))}},{key:"renderPipeLineContent",value:function(){var e=this.store.pipelineJsonData,r=e.pipelineJson;return e.isLoading?D.default.createElement(h.Loading,{spinning:!0},D.default.createElement("div",{className:k.default.pipelineCard})):this.jenkinsFileMode&&"raw"===this.jenkinsFileMode?D.default.createElement(v.default,{desc:t("JENKINS_UNAVAILABLE")},this.editable&&D.default.createElement(D.default.Fragment,null,D.default.createElement(h.Button,{onClick:this.handleJenkinsFileModal,disabled:"json"===this.jenkinsFileMode},t("EDIT_JENKINSFILE")),D.default.createElement(h.Button,{type:"control",onClick:this.handleRunning},t("RUN")))):r&&"failure"===r.result||!this.isValidated?D.default.createElement(v.default,{desc:t("INVALID_JENKINSFILE_TIP")},this.editable&&D.default.createElement(D.default.Fragment,null,D.default.createElement(h.Button,{onClick:this.handleJenkinsFileModal,disabled:"json"===this.jenkinsFileMode},t("EDIT_JENKINSFILE")),D.default.createElement(h.Button,{type:"control",onClick:this.handleRunning},t("RUN")))):(0,b.default)((0,E.toJS)(r))||!this.jenkinsFile?D.default.createElement(v.default,{desc:t("NO_PIPELINE_CONFIG_FILE_TIP")},this.editable&&D.default.createElement(D.default.Fragment,null,D.default.createElement(h.Button,{onClick:this.handleJenkinsFileModal,disabled:"json"===this.jenkinsFileMode},t("EDIT_JENKINSFILE")),D.default.createElement(h.Button,{type:"control",onClick:this.handlePipelineModal,disabled:"raw"===this.jenkinsFileMode},t("EDIT_PIPELINE")))):D.default.createElement("div",{className:k.default.pipelineCard},D.default.createElement("div",{className:k.default.pipelineCard__toolbar},this.renderBtnGroup()),D.default.createElement("div",{className:k.default.pipelineCard__main},D.default.createElement(g.default,{jsonData:r})))}},{key:"render",value:function(){return D.default.createElement("div",null,this.renderPipeLineContent())}},{key:"enabledActions",get:function(){var e=this.props.match.params,t=e.cluster,r=e.devops;return globals.app.getActions({module:"pipelines",cluster:t,devops:r})}},{key:"editable",get:function(){return this.enabledActions.includes("edit")}},{key:"jenkinsFileMode",get:function(){return this.store.pipelineConfig.metadata.annotations["pipeline.devops.kubesphere.io/jenkinsfile.edit.mode"]}},{key:"isValidated",get:function(){return"failure"!==this.store.pipelineConfig.metadata.annotations["pipeline.devops.kubesphere.io/jenkinsfile.validate"]}},{key:"jenkinsFile",get:function(){var e=this.store.pipelineConfig;return(0,E.toJS)(e.spec.pipeline.jenkinsfile)}},{key:"isMultibranch",get:function(){var e=this.props.detailStore;return(0,E.toJS)(e.detail.isMultiBranch)}}]),n}(D.default.Component))||l)||l)||l;r.default=P},5074:function(e,t,r){e.exports={pipelineCard:"_1QFjNwGDuN8t9MAIvO2DoY",pipelineCard__toolbar:"_1fCHzREeVMKbCgIC2LzrXb",icon:"_3lL8K1nNCnwDbe_zgSfsdL","btn-disabled":"VB_cSYTGpvaW0GPCUnagO",pipelineCard__btnGroup:"_2Q4jPcuRq7sl6FH05oON1Q",pipelineCard__main:"zhBNotW1xoiqvp-fuAnWt"}},5075:function(e,r,n){"use strict";n(15);var a=n(20);n(5),n(84),n(16),n(4),n(23),n(24),n(17),n(85),n(62),Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0,n(45),n(5),n(84),n(28),n(42),n(16),n(4),n(22),n(23),n(57),n(24),n(17),n(85),n(62);var o=a(n(43));n(41);var i,l=a(n(44)),s=a(n(36)),u=a(n(37)),c=a(n(55)),d=a(n(56)),f=a(n(51)),p=n(186),h=a(n(963)),m=a(n(1125)),v=a(n(800)),g=a(n(63)),y=n(14),b=n(239),E=a(n(0)),S=n(791),D=a(n(5076));function _(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,f.default)(e);if(t){var a=(0,f.default)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return(0,d.default)(this,r)}}var k=(0,b.inject)("rootStore","detailStore")(i=(0,b.observer)(i=(0,S.trigger)(i=function(e){(0,c.default)(n,e);var r=_(n);function n(){var e;(0,s.default)(this,n);for(var a=arguments.length,i=new Array(a),u=0;u<a;u++)i[u]=arguments[u];return(e=r.call.apply(r,[this].concat(i))).store=e.props.detailStore||{},e.formTemplate={},e.handlePipelineModal=function(){var r=e.store.pipelineJsonData,n=e.props.match.params;e.trigger("pipeline.pipelineTemplateOld",{store:e.store,jsonData:(0,y.toJS)(r.pipelineJson),formTemplate:e.formTemplate,title:t("CREATE_PIPELINE"),imageIcon:"/assets/pipeline/pipeline-icon-dark.svg",description:t("CREATE_PIPELINE_DESC"),width:"960px",contentWidth:"960px",noCodeEdit:!0,params:n,success:function(t){e.trigger("pipeline.pipelineCreate",{store:e.store,jsonData:t,isOld:!0,params:n,success:function(){var t=n.devops,r=n.name;localStorage.removeItem("".concat(globals.user.username,"-").concat(t,"-").concat(r)),e.handleRefresh()}})}})},e.handleEditorPipelineModal=function(){var t=e.store.pipelineJsonData,r=e.props.match.params;e.trigger("pipeline.pipelineCreate",{store:e.store,jsonData:(0,y.toJS)(t.pipelineJson),params:r,success:function(){var t=r.devops,n=r.name;localStorage.removeItem("".concat(globals.user.username,"-").concat(t,"-").concat(n)),e.handleRefresh()}})},e.handleJenkinsFileModal=function(){var t=e.store.jenkinsfile,r=e.props.match.params;e.trigger("pipeline.jenkins",{store:e.store,defaultValue:(0,y.toJS)(t),params:r,success:function(){var t=r.devops,n=r.name;localStorage.removeItem("".concat(globals.user.username,"-").concat(t,"-").concat(n)),e.handleRefresh()}})},e.getData=(0,l.default)(o.default.mark((function t(){var r;return o.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.props.match.params,t.next=3,e.store.getJenkinsFile(r);case 3:e.store.getActivities(r);case 4:case"end":return t.stop()}}),t)}))),e.handleRefresh=function(){var t=e.props.match.params;e.store.getJenkinsFile(t)},e.handleRunning=(0,v.default)((0,l.default)(o.default.mark((function t(){var r,n,a,i;return o.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.props.match.params,t.next=3,e.store.fetchDetail(r);case 3:n=e.store.detail,a=!(0,g.default)((0,y.toJS)(n.branchNames)),i=!(0,g.default)((0,y.toJS)(n.parameters)),a||i?e.trigger("pipeline.params",{devops:r.devops,cluster:r.cluster,params:r,branches:(0,y.toJS)(n.branchNames),disabledBrancheNames:(0,y.toJS)(n.disabledBrancheNames),parameters:(0,y.toJS)(n.parameters),success:function(){e.props.rootStore.routing.push("./activity")}}):e.handleRunSubmit();case 7:case"end":return t.stop()}}),t)}))),500),e.handleRunSubmit=function(){var t=(0,l.default)(o.default.mark((function t(r,n){var a,i,l,s;return o.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=e.store.detail,i=e.props.match.params,l=i.devops,s=i.cluster,t.next=4,e.store.runBranch({name:a.name,branch:n,parameters:r,cluster:s,devops:l});case 4:e.props.rootStore.routing.push("./activity");case 5:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}(),e}return(0,u.default)(n,[{key:"componentDidMount",value:function(){!this.isMultibranch&&this.enabledActions.includes("edit")?this.getData():this.props.rootStore.routing.push("./activity")}},{key:"renderBtnGroup",value:function(){var e=this.enabledActions.includes("edit");return E.default.createElement("div",{className:D.default.pipelineCard__btnGroup},e&&E.default.createElement(p.Button,{onClick:this.handleJenkinsFileModal},t("EDIT_JENKINSFILE")),e&&E.default.createElement(p.Button,{onClick:this.handleEditorPipelineModal},t("EDIT_PIPELINE")),e&&E.default.createElement(p.Button,{type:"control",onClick:this.handleRunning},t("RUN")))}},{key:"renderPipeLineContent",value:function(){var e=this.store.pipelineJsonData,r=e.pipelineJson,n=e.isLoading,a=this.enabledActions.includes("edit");return n?E.default.createElement(p.Loading,{spinning:!0},E.default.createElement("div",{className:D.default.pipelineCard})):(0,g.default)((0,y.toJS)(r))?E.default.createElement(h.default,{desc:t("NO_PIPELINE_CONFIG_FILE_TIP")},a&&E.default.createElement(p.Button,{type:"control",onClick:this.handlePipelineModal},t("EDIT_PIPELINE")),a&&E.default.createElement(p.Button,{onClick:this.handleJenkinsFileModal},t("EDIT_JENKINSFILE"))):"failure"===r.result?E.default.createElement(h.default,{desc:t("INVALID_JENKINSFILE_TIP")},a&&E.default.createElement(p.Button,{onClick:this.handleJenkinsFileModal},t("EDIT_JENKINSFILE")),a&&E.default.createElement(p.Button,{type:"control",onClick:this.handleRunning},t("RUN"))):E.default.createElement("div",{className:D.default.pipelineCard},E.default.createElement("div",{className:D.default.pipelineCard__toolbar},this.renderBtnGroup()),E.default.createElement("div",{className:D.default.pipelineCard__main},E.default.createElement(m.default,{jsonData:r})))}},{key:"render",value:function(){return E.default.createElement("div",null,this.renderPipeLineContent())}},{key:"enabledActions",get:function(){var e=this.props.match.params,t=e.cluster,r=e.devops;return globals.app.getActions({module:"pipelines",cluster:t,devops:r})}},{key:"isMultibranch",get:function(){var e=this.props.detailStore;return(0,y.toJS)(e.detail.isMultiBranch)}}]),n}(E.default.Component))||i)||i)||i;r.default=k},5076:function(e,t,r){e.exports={pipelineCard:"L2HNvuKKXxssxlDxFzPh_",pipelineCard__toolbar:"_2FxcrOH1tYXtkGEwGBaBGm",icon:"_3zPurtJsOGqCj5Xz6vHee7","btn-disabled":"_1aOK8fLFmB4EKYWmzr7ynz",pipelineCard__btnGroup:"_3O1yZz9tSDlnb9brPQsOuC",pipelineCard__main:"_2ypoUh9itrTd6D_OT6ylgH"}},5077:function(e,r,n){"use strict";var a=n(20);n(12),n(5),n(11),n(6),n(48),n(16),n(9),n(13),n(10),n(4),n(23),n(24),n(17),n(62),n(188),n(7),n(110),Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0,n(12),n(45),n(5),n(11),n(6),n(28),n(48),n(42),n(16),n(34),n(15),n(9),n(13),n(10),n(4),n(23),n(57),n(24),n(17),n(62),n(188),n(7),n(110);var o,i=a(n(30)),l=a(n(36)),s=a(n(37)),u=a(n(55)),c=a(n(56)),d=a(n(51)),f=a(n(0)),p=a(n(26)),h=a(n(189)),m=a(n(63)),v=n(14),g=n(239),y=n(244),b=n(52),E=a(n(921)),S=n(434),D=a(n(1251)),_=a(n(3)),k=a(n(1423)),O=a(n(796)),w=a(n(963)),N=a(n(5078));function P(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function R(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?P(Object(r),!0).forEach((function(t){(0,i.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):P(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function C(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,d.default)(e);if(t){var a=(0,d.default)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return(0,c.default)(this,r)}}var I=(0,g.inject)("rootStore","detailStore")(o=(0,g.observer)(o=function(e){(0,u.default)(n,e);var r=C(n);function n(){var e;(0,l.default)(this,n);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return(e=r.call.apply(r,[this].concat(o))).name="PullRequest",e.store=e.props.detailStore||{},e.refreshTimer=setInterval((function(){return e.getData()}),4e3),e.refreshHandler=function(){e.isRuning?e.getData():(clearInterval(e.refreshTimer),e.refreshTimer=null)},e.getData=function(){var t=e.props.match.params,r=(0,y.parse)(location.search.slice(1));e.store.getPullRequest(R(R({},t),r))},e.handleFetch=function(t,r){e.routing.query(t,r)},e.getFilteredValue=function(t){return e.store.list.filters[t]},e.getColumns=function(){return[{title:t("STATUS"),width:"15%",render:function(e){return f.default.createElement(E.default,(0,S.getPipelineStatus)((0,p.default)(e,"latestRun",{})))}},{title:t("NAME"),dataIndex:"name",width:"15%",render:function(t,r){return f.default.createElement(k.default,{className:(0,_.default)("item-name",(0,i.default)({},N.default.itemNameDisabled,r.disabled)),to:"".concat(e.prefix,"/branch/").concat(t,"/"),disabled:r.disabled},t)}},{title:t("HEALTH_STATUS"),dataIndex:"weatherScore",width:"15%",render:function(e){return f.default.createElement(D.default,{score:e})}},{title:t("LAST_MESSAGE"),width:"20%",render:function(e){return(0,p.default)(e,"pullRequest.title","")}},{title:t("AUTHOR"),width:"15%",render:function(e){return(0,p.default)(e,"pullRequest.author","")}},{title:t("TIME"),dataIndex:"latestRun",width:"20%",render:function(e){return(0,b.getLocalTime)(e.startTime).format("YYYY-MM-DD HH:mm:ss")}}]},e.getRowKey=function(e){return e.enQueueTime},e}return(0,s.default)(n,[{key:"componentDidMount",value:function(){var e=this,t=this.props.match.params;this.unsubscribe=this.routing.history.subscribe((function(r){if(r.pathname===e.props.match.url){var n=(0,y.parse)(r.search.slice(1));e.store.getPullRequest(R(R({},t),n))}}))}},{key:"componentDidUpdate",value:function(){var e=this;null===this.refreshTimer&&this.isRuning&&(this.refreshTimer=setInterval((function(){return e.refreshHandler()}),4e3))}},{key:"componentWillUnmount",value:function(){clearInterval(this.refreshTimer),this.unsubscribe&&this.unsubscribe()}},{key:"render",value:function(){var e=this.store.pullRequestList,t=e.data,r=e.isLoading,n=e.total,a=e.page,o=e.limit,i=e.filters,l=!1===r&&0===n&&t.length>0,s={total:n,page:a,limit:o},u=(0,h.default)(i,"page","workspace");return l&&!i.page?f.default.createElement(w.default,{name:this.name}):f.default.createElement(O.default,{data:(0,v.toJS)(t),columns:this.getColumns(),rowKey:"displayName",filters:u,pagination:s,isLoading:r,onFetch:this.handleFetch,hideSearch:!0})}},{key:"isRuning",get:function(){var e=(0,p.default)((0,v.toJS)(this.store),"pullRequestList.data",[]).filter((function(e){var t=(0,p.default)(e,"latestRun.state");return t&&"FINISHED"!==t&&"PAUSED"!==t}));return!(0,m.default)(e)}},{key:"routing",get:function(){return this.props.rootStore.routing}},{key:"prefix",get:function(){var e=this.props.match.params,t=e.workspace,r=e.devops,n=e.name,a=e.cluster;return"/".concat(t,"/clusters/").concat(a,"/devops/").concat(r,"/pipelines/").concat(n)}}]),n}(f.default.Component))||o)||o;r.default=I},5078:function(e,t,r){e.exports={itemNameDisabled:"_1imWThkNtbXZSBAEQgwMK"}},5079:function(e,r,n){"use strict";var a=n(20);n(12),n(5),n(11),n(6),n(84),n(73),n(48),n(16),n(9),n(13),n(10),n(4),n(23),n(24),n(17),n(85),n(62),n(64),n(188),n(136),n(7),n(110),Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0,n(12),n(45),n(5),n(11),n(6),n(84),n(73),n(28),n(48),n(42),n(16),n(34),n(15),n(9),n(13),n(10),n(4),n(22),n(23),n(57),n(24),n(17),n(85),n(62),n(64),n(188),n(7),n(110);var o=a(n(61)),i=a(n(43));n(41);var l,s=a(n(44)),u=a(n(30)),c=a(n(36)),d=a(n(37)),f=a(n(55)),p=a(n(56)),h=a(n(51)),m=a(n(0)),v=a(n(26)),g=a(n(189)),y=a(n(800)),b=a(n(63)),E=n(433),S=n(14),D=n(244),_=n(239),k=n(186),O=a(n(240)),w=n(52),N=a(n(921)),P=n(434),R=n(1144),C=n(791),I=a(n(796)),L=a(n(963)),T=a(n(960));function A(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function j(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?A(Object(r),!0).forEach((function(t){(0,u.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):A(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function x(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,h.default)(e);if(t){var a=(0,h.default)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return(0,p.default)(this,r)}}var M=(0,_.inject)("rootStore","detailStore")(l=(0,_.observer)(l=(0,C.trigger)(l=function(e){(0,f.default)(n,e);var r=x(n);function n(){var e;(0,c.default)(this,n);for(var a=arguments.length,l=new Array(a),u=0;u<a;u++)l[u]=arguments[u];return(e=r.call.apply(r,[this].concat(l))).name="Activity",e.store=e.props.detailStore||{},e.deletedStore=new T.default,e.refreshTimer=setInterval((function(){return e.getData()}),4e3),e.getData=function(){var t=e.props.match.params,r=(0,D.parse)(location.search.slice(1));e.store.getActivities(j(j({},t),r))},e.refreshHandler=function(){e.isRuning?e.getData():(clearInterval(e.refreshTimer),e.refreshTimer=null)},e.handleRunning=(0,y.default)((0,s.default)(i.default.mark((function r(){var n,a,o;return i.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=e.props.match.params,r.next=3,e.store.fetchDetail(n);case 3:if(a=e.store.detail,o=!(0,b.default)((0,S.toJS)(a.parameters)),!!(0,b.default)((0,S.toJS)(a.branchNames))&&!o){r.next=10;break}e.trigger("pipeline.params",{devops:n.devops,cluster:n.cluster,params:n,branches:(0,S.toJS)(a.branchNames),disabledBrancheNames:(0,S.toJS)(a.disabledBrancheNames),parameters:(0,S.toJS)(a.parameters),success:function(){e.handleFetch()}}),r.next=14;break;case 10:return O.default.success({content:"".concat(t("PIPELINE_RUN_START_SI"))}),r.next=13,e.props.detailStore.runBranch(n);case 13:e.handleFetch();case 14:case"end":return r.stop()}}),r)}))),500),e.handleFetch=function(t,r){e.routing.query(t,r)},e.handleReplay=function(r){return(0,s.default)(i.default.mark((function n(){var a;return i.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(a=e.props.match.params,!e.isMultiBranch){n.next=7;break}return n.next=4,e.deletedStore.getBranchDetail(j(j({},a),{},{branch:r.pipeline}));case 4:if(!n.sent.disabled){n.next=7;break}return n.abrupt("return",O.default.error(t("BRANCH_DISABLED_NOT_REPLAY")));case 7:return n.next=9,e.props.detailStore.handleActivityReplay(j(j({},a),{},{url:e.getActivityDetailLinks(r)}));case 9:O.default.success({content:"".concat(t("PIPELINE_RUN_START_SI"))}),e.handleFetch();case 11:case"end":return n.stop()}}),n)})))},e.handleScanRepository=(0,s.default)(i.default.mark((function r(){var n,a;return i.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=e.props.match.params,a=e.props.detailStore.detail,r.next=4,e.props.detailStore.scanRepository({devops:n.devops,name:a.name,cluster:n.cluster});case 4:e.store.fetchDetail(n),O.default.success({content:t("SCAN_REPO_SUCCESSFUL")}),e.handleFetch();case 7:case"end":return r.stop()}}),r)}))),e.handleStop=function(r){return(0,s.default)(i.default.mark((function n(){var a;return i.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return a=e.props.match.params,n.next=3,e.props.detailStore.handleActivityStop(j({url:e.getActivityDetailLinks(r)},a));case 3:O.default.success({content:t("STOP_PIPELINE_SUCCESSFUL")}),e.handleFetch();case 5:case"end":return n.stop()}}),n)})))},e.getActivityDetailLinks=function(e){var t=(0,v.default)(e,"_originData.spec.scm.refName");return t?"branches/".concat(encodeURIComponent(t),"/runs/").concat(e.id):"runs/".concat(e.id)},e.getRunhref=function(t){var r=(0,v.default)(t,"_originData.spec.scm.refName"),n=(0,v.default)(t,"_originData.metadata.name");return r&&!e.isAtBranchDetailPage?"".concat(e.prefix,"/branch/").concat(t.pipeline,"/run/").concat(n):"".concat(e.prefix,"/run/").concat(n)},e.getColumns=function(){return[{title:t("STATUS"),width:"15%",key:"status",render:function(t){var r;return"nostatus"!==(null===(r=(0,P.getPipelineStatus)(t))||void 0===r?void 0:r.type)&&t.result?m.default.createElement(E.Link,{className:"item-name",to:e.getRunhref(t)},m.default.createElement(N.default,(0,P.getPipelineStatus)(t))):m.default.createElement(N.default,(0,P.getPipelineStatus)(t))}},{title:t("RUN_ID"),width:"10%",key:"run",render:function(t){return t.id?m.default.createElement(E.Link,{className:"item-name",to:e.getRunhref(t)},t.id):m.default.createElement("span",null,"-")}},{title:t("COMMIT"),dataIndex:"commitId",width:"10%",render:function(e){return e&&e.slice(0,6)||"-"}}].concat((0,o.default)(e.isAtBranchDetailPage||!e.isMultiBranch?[]:[{title:t("BRANCH_SI"),width:"15%",key:"branch",render:function(t){var r=(0,v.default)(t,"_originData.spec.scm.refName","");return r?m.default.createElement(E.Link,{className:"item-name",to:"".concat(e.prefix,"/branch/").concat(r,"/activity")},m.default.createElement(R.ReactComponent,{style:{width:"20px",height:"20px"}})," ",decodeURIComponent(r)):"-"}}]),[{title:t("LAST_MESSAGE"),dataIndex:"causes",width:"25%",render:function(e,t){var r=(0,v.default)(e,"[0].shortDescription",""),n=(0,v.default)(t,'_originData.metadata.annotations["devops.kubesphere.io/creator"]');return n?("Started by user admin"===r&&(r=r.replace("user admin","user ".concat(n))),r):r}},{title:t("DURATION"),dataIndex:"durationInMillis",width:"10%",render:function(e){return e?(0,w.formatUsedTime)(e):"-"}},{title:t("UPDATE_TIME_TCAP"),dataIndex:"startTime",width:"20%",render:function(e){return e?(0,w.getLocalTime)(e).format("YYYY-MM-DD HH:mm:ss"):"-"}},{isHideable:!1,width:"10%",key:"action",render:function(r){return r.branch&&!r.commitId||!e.enabledActions.includes("edit")||!r.id?null:"FINISHED"===r.state?m.default.createElement(k.Tooltip,{content:t("Replay")},m.default.createElement(k.Button,{onClick:e.handleReplay(r),icon:"restart",type:"flat"})):m.default.createElement(k.Tooltip,{content:t("STOP")},m.default.createElement(k.Button,{onClick:e.handleStop(r),icon:"stop",type:"flat"}))}}])},e.getActions=function(){return e.isAtBranchDetailPage?null:[{type:"control",key:"run",text:t("RUN"),action:"edit",onClick:e.handleRunning}]},e}return(0,d.default)(n,[{key:"componentDidMount",value:function(){var e=this,t=this.props.match.params;this.unsubscribe=this.routing.history.subscribe((function(r){if(r.pathname===e.props.match.url){var n=(0,D.parse)(r.search.slice(1));e.store.getActivities(j(j({},t),n))}}))}},{key:"componentDidUpdate",value:function(){var e=this;null===this.refreshTimer&&this.isRuning&&(this.refreshTimer=setInterval((function(){return e.refreshHandler()}),4e3))}},{key:"componentWillUnmount",value:function(){clearInterval(this.refreshTimer),this.unsubscribe&&this.unsubscribe()}},{key:"render",value:function(){var e=this.store.activityList,r=e.data,n=e.isLoading,a=e.total,o=e.page,i=e.limit,l=e.filters,s=(0,g.default)(l,"page","workspace"),u={total:a,page:o,limit:i};if(0===a){var c=this.store.detail,d=this.enabledActions.includes("edit"),f=!(0,b.default)((0,S.toJS)(c.branchNames)),p=(0,v.default)(this.props,"match.params.branch");return!f||(0,b.default)(f)||p?m.default.createElement(L.default,{desc:t("ACTIVITY_EMPTY_TIP")},d&&m.default.createElement(k.Button,{type:"control",onClick:this.handleRunning},t("RUN"))):m.default.createElement(L.default,{desc:t("NO_PIPELINE_CONFIG_FILE_TIP")},d&&m.default.createElement(k.Button,{type:"control",onClick:this.handleScanRepository},t("SCAN_REPOSITORY")))}return m.default.createElement(I.default,{data:(0,S.toJS)(r),columns:this.getColumns(),rowKey:"uid",filters:s,pagination:u,isLoading:n,onFetch:this.handleFetch,actions:this.getActions(),showEmpty:!1,hideSearch:!0,enabledActions:this.enabledActions})}},{key:"enabledActions",get:function(){var e=this.props.match.params,t=e.devops,r=e.cluster;return globals.app.getActions({module:"pipelineruns",cluster:r,devops:t})}},{key:"isRuning",get:function(){var e=(0,v.default)((0,S.toJS)(this.store),"activityList.data",[]).filter((function(e){return"FINISHED"!==e.state&&"PAUSED"!==e.state}));return!(0,b.default)(e)}},{key:"isAtBranchDetailPage",get:function(){return this.props.match.params.branch}},{key:"isMultiBranch",get:function(){return!(0,b.default)((0,S.toJS)(this.store.detail.branchNames))}},{key:"isDisabled",get:function(){var e,t;return null===(e=this.store)||void 0===e||null===(t=e.branchDetail)||void 0===t?void 0:t.disabled}},{key:"prefix",get:function(){var e=this.props.match.url.split("/");return e.pop(),e.join("/")}},{key:"routing",get:function(){return this.props.rootStore.routing}}]),n}(m.default.Component))||l)||l)||l;r.default=M},5080:function(e,r,n){"use strict";var a=n(20);n(12),n(11),n(6),n(9),n(13),n(10),n(4),n(23),n(24),n(17),n(62),n(7),Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0,n(12),n(45),n(11),n(6),n(28),n(42),n(34),n(15),n(9),n(13),n(10),n(4),n(22),n(23),n(57),n(24),n(17),n(62),n(7);var o=a(n(315)),i=a(n(65)),l=a(n(43)),s=a(n(30));n(41);var u,c,d,f,p,h=a(n(44)),m=a(n(36)),v=a(n(37)),g=a(n(88)),y=a(n(55)),b=a(n(56)),E=a(n(51)),S=a(n(49)),D=(a(n(66)),a(n(0))),_=a(n(1)),k=a(n(3)),O=n(239),w=n(14),N=a(n(26)),P=a(n(63)),R=a(n(854)),C=n(186),I=n(453),L=a(n(1314)),T=a(n(921)),A=n(434),j=a(n(5081)),x=a(n(5086)),M=a(n(5092));function U(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function F(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?U(Object(r),!0).forEach((function(t){(0,s.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):U(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function B(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,E.default)(e);if(t){var a=(0,E.default)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return(0,b.default)(this,r)}}var Y=(0,O.inject)("rootStore","detailStore")(u=(0,O.observer)((p=f=function(e){(0,y.default)(n,e);var r=B(n);function n(e){var a;return(0,m.default)(this,n),(a=r.call(this,e)).handleFetch=function(){var e=a.store.runDetail;if(!(0,P.default)((0,w.toJS)(e))&&!a.isQueued){var t=a.props.match.params;a.store.getNodesStatus(t)}},a.handleTabChange=function(e){a.setState({activeTab:e})},a.toggleFullScreenState=function(){var e=a.state.isFullScreen;a.setState({isFullScreen:!e})},a.handleEnterFullScreen=function(){(0,I.enterFullScreen)(a.container),a.setState({isFullScreen:!0})},a.showLog=function(){a.setState({showLog:!0})},a.showErrorLog=function(){a.setState({showErrorLog:!0})},a.hideLog=function(){a.setState({showLog:!1})},a.handleDownloadLogs=function(){var e=a.props.match.params;a.store.handleDownloadLogs(e)},a.handleProceed=function(){var e=(0,h.default)(l.default.mark((function e(t,r){var n;return l.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=a.props.match.params,e.next=4,a.store.handleProceed(F(F({},t),n));case 4:return e.next=6,a.store.getRunDetail(n);case 6:return e.prev=6,r&&r(),e.finish(6);case 9:case"end":return e.stop()}}),e,null,[[0,,6,9]])})));return function(t,r){return e.apply(this,arguments)}}(),a.handleBreak=function(){var e=(0,h.default)(l.default.mark((function e(t,r){var n;return l.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=a.props.match.params,e.next=4,a.store.handleBreak(F(F({},t),n));case 4:return e.next=6,a.store.getRunDetail(n);case 6:return e.prev=6,r&&r(),e.finish(6);case 9:case"end":return e.stop()}}),e,null,[[0,,6,9]])})));return function(t,r){return e.apply(this,arguments)}}(),a.renderLoadingCard=function(){return D.default.createElement("div",{className:M.default.card},D.default.createElement("div",null,D.default.createElement("span",{className:(0,k.default)(M.default.runningIcon,M.default.icon)})),D.default.createElement("div",{className:M.default.title},t("INITIALIZING_PIPELINE")),D.default.createElement("div",{className:M.default.desc},t("INITIALIZING_PIPELINE_DESC")),D.default.createElement("div",{className:M.default.btn},D.default.createElement(C.Button,{onClick:a.showErrorLog},t("VIEW_LOGS"))))},a.renderQueuedCard=function(e){return D.default.createElement("div",{className:M.default.card},D.default.createElement("div",null,D.default.createElement("span",{className:(0,k.default)(M.default.QueuedIcon,M.default.icon)})),D.default.createElement("div",{className:M.default.title},t("PIPELINE_QUEUED_TITLE")),D.default.createElement("div",{className:M.default.desc},(0,N.default)(e,"causeOfBlockage")||t("INITIALIZING_PIPELINE_DESC")))},(0,i.default)(a,"refreshFlag",d,(0,g.default)(a)),a.handleRefresh=(0,R.default)((function(){a.refreshFlag=!a.refreshFlag}),1e3),a.state={isFullScreen:!1,showLog:!1,showErrorLog:!1,activeTab:"pipeline",refreshFlag:!0},a.store=e.detailStore||{},a.updateReaction=(0,w.reaction)((function(){return a.store.runDetail}),a.handleFetch),a}return(0,v.default)(n,[{key:"componentDidMount",value:function(){this.handleFetch(),(0,I.addFullScreenChangeEvents)(this.toggleFullScreenState)}},{key:"componentWillUnmount",value:function(){this.updateReaction(),(0,I.removeFullScreenChangeEvents)(this.toggleFullScreenState)}},{key:"getChildContext",value:function(){return{onProceed:this.handleProceed,onBreak:this.handleBreak,result:this.store.runDetail.result}}},{key:"renderBtnGroup",value:function(){return D.default.createElement("div",{className:M.default.pipelineCard__btnGroup},D.default.createElement("span",{onClick:this.handleEnterFullScreen},D.default.createElement(C.Button,{icon:"maximize",type:"flat"})),D.default.createElement(C.Button,{onClick:this.showLog},t("VIEW_LOGS")))}},{key:"render",value:function(){var e=this,r=this.state.showErrorLog,n=this.store,a=n.nodesStatus,i=n.runDetailLogs,l=n.runDetail;return 0===a.length?this.isQueued?this.renderQueuedCard(l):this.hasRuning&&!r?this.renderLoadingCard():D.default.createElement("div",{className:M.default.pipelineCard},D.default.createElement("div",{className:M.default.pipelineCard__toolbar},this.hasRuning?D.default.createElement("span",{className:M.default.running_tips},D.default.createElement(T.default,(0,o.default)({hasLabel:!1},(0,A.getPipelineStatus)(l))),t("PIPELINE_PREPARE_DESC")):null,D.default.createElement("div",{className:M.default.pipelineCard__btnGroup},D.default.createElement(C.Button,{onClick:this.handleDownloadLogs},t("DOWNLOAD_LOGS")))),D.default.createElement("div",{className:M.default.pipelineCard__main,ref:function(t){e.container=t}},D.default.createElement("pre",null,i))):D.default.createElement(D.default.Fragment,null,D.default.createElement("div",{className:M.default.pipelineCard},D.default.createElement("div",{className:M.default.pipelineCard__tab},D.default.createElement("div",null,D.default.createElement(L.default,{value:this.state.activeTab,onChange:this.handleTabChange,options:[{label:t("PIPELINE"),value:"pipeline"},{label:t("RUN_LOGS"),value:"logs"}]}))),"pipeline"===this.state.activeTab&&D.default.createElement("div",{className:(0,k.default)(M.default.pipelineCard_content,M.default.pipelineCard_pipeline_content)},D.default.createElement("div",{className:(0,k.default)(M.default.pipelineCard__main),ref:function(t){e.container=t}},D.default.createElement(j.default,{jsonData:a}))),"logs"===this.state.activeTab&&D.default.createElement("div",{className:(0,k.default)(M.default.pipelineCard_content)},D.default.createElement("div",{className:M.default.pipelineCard__main},D.default.createElement(x.default,{handleDownloadLogs:this.handleDownloadLogs,params:this.props.match.params,runId:this.store.runDetail.id,nodes:a,refreshFlag:this.refreshFlag,hasRunning:this.hasRunningOmitPaused})))))}},{key:"enabledActions",get:function(){var e=this.props.match.params,t=e.cluster,r=e.devops;return globals.app.getActions({module:"pipelines",cluster:t,devops:r})}},{key:"hasRuning",get:function(){var e=this.store.runDetail,t=(0,N.default)(e,"state");return t&&"FINISHED"!==t&&"PAUSED"!==t}},{key:"hasRunningOmitPaused",get:function(){var e=this.store.runDetail;return"FINISHED"!==(0,N.default)(e,"state")}},{key:"isQueued",get:function(){var e=this.store.runDetail;return"QUEUED"===(0,N.default)(e,"state","")}}]),n}(D.default.Component),f.childContextTypes={onProceed:_.default.func,onBreak:_.default.func,result:_.default.string},c=p,d=(0,S.default)(c.prototype,"refreshFlag",[w.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),u=c))||u)||u;r.default=Y},5081:function(e,t,r){"use strict";var n=r(20);r(12),r(11),r(6),r(9),r(13),r(10),r(4),r(23),r(17),r(7),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,r(12),r(45),r(11),r(6),r(28),r(42),r(34),r(15),r(9),r(13),r(10),r(4),r(22),r(23),r(57),r(17),r(7);var a=n(r(43)),o=n(r(30));r(41);var i,l,s,u,c,d,f,p,h,m=n(r(44)),v=n(r(58)),g=n(r(65)),y=n(r(36)),b=n(r(37)),E=n(r(88)),S=n(r(55)),D=n(r(56)),_=n(r(51)),k=n(r(49)),O=(n(r(66)),n(r(0))),w=r(239),N=n(r(63)),P=r(14),R=n(r(1)),C=n(r(1171)),I=n(r(1729)),L=n(r(5082)),T=n(r(5085));function A(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function j(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?A(Object(r),!0).forEach((function(t){(0,o.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):A(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function x(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,_.default)(e);if(t){var a=(0,_.default)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return(0,D.default)(this,r)}}var M=(0,w.observer)((h=p=function(e){(0,S.default)(r,e);var t=x(r);function r(e){var n;return(0,y.default)(this,r),n=t.call(this,e),(0,g.default)(n,"isUserMoved",s,(0,E.default)(n)),(0,g.default)(n,"parameters",u,(0,E.default)(n)),(0,g.default)(n,"showParamsModal",c,(0,E.default)(n)),(0,g.default)(n,"handleRefresh",d,(0,E.default)(n)),(0,g.default)(n,"handleProceed",f,(0,E.default)(n)),n.handelShowProceedModal=function(e,t){var r=e.parameters,a=(0,v.default)(e,["parameters"]);n.parameters=r,n.elseParams=a,(0,N.default)(r)?n.handleProceed(r,t):n.showParamsModal=!0},n.hideProceedModal=function(){n.showParamsModal=!1},n.draggerCref=O.default.createRef(),n}return(0,b.default)(r,[{key:"componentDidUpdate",value:function(){this.draggerCref.current&&!this.draggerCref.current.isMoved&&this.draggerCref.current.initialComponent&&this.draggerCref.current.initialComponent()}},{key:"render",value:function(){var e=this.props,t=e.isEditMode,r=e.jsonData;return O.default.createElement(O.default.Fragment,null,O.default.createElement(C.default,{ref:this.draggerCref,className:T.default.container,enableToggleFullScreen:!0,XOffset:30,YOffset:60},O.default.createElement(L.default,{isEditMode:t,stages:r,onProceed:this.handelShowProceedModal,onBreak:this.context.onBreak})),O.default.createElement(I.default,{visible:this.showParamsModal,parameters:(0,P.toJS)(this.parameters),onCancel:this.hideProceedModal,onOk:this.handleProceed}))}}]),r}(O.default.Component),p.contextTypes={onProceed:R.default.func,onBreak:R.default.func},l=h,s=(0,k.default)(l.prototype,"isUserMoved",[P.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),u=(0,k.default)(l.prototype,"parameters",[P.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),c=(0,k.default)(l.prototype,"showParamsModal",[P.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),d=(0,k.default)(l.prototype,"handleRefresh",[P.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){e.scale=1,e.translateX=0,e.translateY=0}}}),f=(0,k.default)(l.prototype,"handleProceed",[P.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){var t=(0,m.default)(a.default.mark((function t(r,n){return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.context.onProceed(j({parameters:r},e.elseParams),"function"==typeof n?n:void 0);case 2:e.showParamsModal=!1;case 3:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}()}}),i=l))||i;t.default=M},5082:function(e,t,r){"use strict";r(15);var n=r(20);r(5),r(18),r(48),r(9),r(4),r(23),r(17),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,r(45),r(5),r(18),r(48),r(191),r(42),r(159),r(9),r(4),r(23),r(57),r(17);var a,o,i,l,s=n(r(61)),u=n(r(65)),c=n(r(36)),d=n(r(37)),f=n(r(88)),p=n(r(55)),h=n(r(56)),m=n(r(51)),v=n(r(49)),g=(n(r(66)),n(r(0))),y=r(14),b=r(239),E=n(r(5083)),S=n(r(1734));function D(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,m.default)(e);if(t){var a=(0,m.default)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return(0,h.default)(this,r)}}var _=(0,b.observer)((o=function(e){(0,p.default)(r,e);var t=D(r);function r(){var e;(0,c.default)(this,r);for(var n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return e=t.call.apply(t,[this].concat(a)),(0,u.default)(e,"heights",i,(0,f.default)(e)),(0,u.default)(e,"setHeight",l,(0,f.default)(e)),e}return(0,d.default)(r,[{key:"render",value:function(){var e=this,t=this.props.stages;return g.default.createElement(g.default.Fragment,null,g.default.createElement(S.default,{index:-1,heights:this.sumHeights}),t.map((function(t,r){return g.default.createElement(g.default.Fragment,{key:JSON.stringify(t)},g.default.createElement(E.default,{nodes:(0,y.toJS)(t),index:r,setHeight:e.setHeight(r),onProceed:e.props.onProceed,onBreak:e.props.onBreak}),g.default.createElement(S.default,{index:r,heights:e.sumHeights}))})))}},{key:"sumHeights",get:function(){var e=this.props.stages,t=void 0===e?[]:e;return this.heights.slice(0,t.length).map((function(e){var t=0;return e.map((function(e){return t+=e}))}))}}]),r}(g.default.Component),i=(0,v.default)(o.prototype,"heights",[y.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),(0,v.default)(o.prototype,"sumHeights",[y.computed],Object.getOwnPropertyDescriptor(o.prototype,"sumHeights"),o.prototype),l=(0,v.default)(o.prototype,"setHeight",[y.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){return function(r){var n=(0,s.default)(e.heights);n[t]=r,e.heights=n}}}}),a=o))||a;t.default=_},5083:function(e,r,n){"use strict";n(15);var a=n(20);n(31),n(18),n(4),n(23),n(17),Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0,n(45),n(31),n(160),n(18),n(191),n(42),n(159),n(4),n(23),n(57),n(17);var o=a(n(315)),i=a(n(30)),l=a(n(36)),s=a(n(37)),u=a(n(55)),c=a(n(56)),d=a(n(51)),f=a(n(0)),p=a(n(3)),h=a(n(1)),m=a(n(26)),v=n(186),g=n(434),y=a(n(921)),b=a(n(5084));function E(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,d.default)(e);if(t){var a=(0,d.default)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return(0,c.default)(this,r)}}var S=function(e){(0,u.default)(n,e);var r=E(n);function n(e){var t;return(0,l.default)(this,n),(t=r.call(this,e)).handleProceed=function(e,r){return function(){t.setState({runLoading:!0}),t.props.onProceed({parameters:e.input.parameters,nodeId:r,stepId:e.id,inputId:e.input.id},(function(){t.setState({runLoading:!1})}))}},t.handleBreak=function(e,r){return function(){t.setState({runLoading:!0}),t.props.onBreak({nodeId:r,stepId:e.id,inputId:e.input.id},(function(){t.setState({runLoading:!1})}))}},t.domTree=[],t.state={runLoading:!1},t}return(0,s.default)(n,[{key:"componentDidMount",value:function(){this.calculateHeight()}},{key:"calculateHeight",value:function(){this.heights=this.domTree.map((function(e){return e.clientHeight})),this.props.setHeight(this.heights)}},{key:"renderCard",value:function(e){var r,n,a=e.steps,l=void 0===a?[]:a,s="",u=l.find((function(e,t){var r="FINISHED"===e.state&&"SUCCESS"!==e.result;return r||(s=t),r?e:null})),c=("ABORTED"===this.context.result||"FAILURE"===this.context.result)&&!e.result,d=!(c||e.state&&"QUEUED"!==e.state),h=e.state&&"PAUSED"===e.state;if(c)return f.default.createElement("div",{className:(0,p.default)(b.default.pipelineCard)},f.default.createElement("div",{className:b.default.pipelineCard__title},e.displayName),f.default.createElement("div",{className:b.default.pipelineCard__content},f.default.createElement("div",{className:b.default.pipelineCard__item},f.default.createElement("div",{className:(0,p.default)(b.default.content__status,b.default.content__status__quene)},t("ABORTED")))));if(h){var E=e.steps.find((function(e){return e.input}));if("FAILURE"===this.context.result)return f.default.createElement("div",{className:(0,p.default)(b.default.pipelineCard,b.default["pipelineCard--paused"])},f.default.createElement("div",{className:b.default.pipelineCard__title},e.displayName),f.default.createElement("div",{className:b.default.pipelineCard__content},f.default.createElement("div",{className:b.default.pipelineCard__item},f.default.createElement("p",{className:b.default.content__title__paused},t("WAITING_FOR_INPUT")),f.default.createElement("div",{className:(0,p.default)(b.default.content__status,b.default.content__status__quene)},t("TASK_FAILED_NOT_OPERATIONAL")))));var S=(0,m.default)(E,"approvable");return f.default.createElement("div",{className:(0,p.default)(b.default.pipelineCard,b.default["pipelineCard--paused"])},f.default.createElement("div",{className:b.default.pipelineCard__title},e.displayName),f.default.createElement("div",{className:b.default.pipelineCard__content},f.default.createElement("div",{className:b.default.pipelineCard__item},f.default.createElement("p",{className:b.default.content__title__paused},t("WAITING_FOR_INPUT")),f.default.createElement("p",{className:b.default.content__title__paused},(0,m.default)(E,"input.message")),f.default.createElement("div",{className:(0,p.default)(b.default.content__status,b.default.content__status__quene)},f.default.createElement(f.default.Fragment,null,f.default.createElement(v.Button,{size:"small",type:"primary",loading:this.state.runLoading,onClick:this.handleProceed(E,e.id),disabled:!S},t((0,m.default)(E,"input.ok")||"PROCEED")),f.default.createElement(v.Button,{size:"small",type:"danger",loading:this.state.runLoading,onClick:this.handleBreak(E,e.id),disabled:!S},t("BREAK")))))))}return f.default.createElement("div",{className:(0,p.default)(b.default.pipelineCard,(r={},(0,i.default)(r,b.default["pipelineCard--error"],u),(0,i.default)(r,b.default["pipelineCard--queue"],d),r))},f.default.createElement("div",{className:b.default.pipelineCard__title},e.displayName),f.default.createElement("div",{className:b.default.pipelineCard__content},f.default.createElement("div",{className:b.default.pipelineCard__item},d?null:f.default.createElement("div",{className:b.default.content__title},t("STEPS_COMPLETE_TOTAL",{complete:""===s?0:s+1,total:l.length})),d&&e.causeOfBlockage?f.default.createElement("p",{className:b.default.errorMessage},e.causeOfBlockage):null,f.default.createElement("div",{className:(0,p.default)(b.default.content__status,(n={},(0,i.default)(n,b.default.content__status__error,u),(0,i.default)(n,b.default.content__status__quene,d),n))},d?null:f.default.createElement(y.default,(0,o.default)({},(0,g.getPipelineStatus)(e),{hasLabel:!1})),this.renderStatus(e,u)))))}},{key:"renderStatus",value:function(e,r){if(!e.state||"QUEUED"===e.state)return t("QUEUED");if("NOT_BUILT"===e.state)return t("NOT_BUILT");if("SKIPPED"===e.state)return t("SKIPPED");if("PAUSED"===e.state)return t("PAUSED");if("ABORTED"===e.result)return t("ABORTED");if(r||"FAILURE"===e.result){var n=(0,m.default)(r,"displayName","");return"Wait for interactive input"===n?f.default.createElement("span",{className:b.default.errorMessage},t("CANCELLED_IN_REVIEW")):n||f.default.createElement("span",{className:b.default.errorMessage},t("FAILED"))}return"FINISHED"!==e.state?t("RUNNING"):t("SUCCESSFUL")}},{key:"render",value:function(){var e=this,t=this.props.nodes;return Array.isArray(t)?f.default.createElement("div",{className:b.default.pipeline_column},t.map((function(t,r){return f.default.createElement("div",{key:JSON.stringify(t),ref:function(t){r?e.domTree[r]=t:e.domTree=[t]}},e.renderCard(t,r))}))):f.default.createElement("div",{className:b.default.pipeline_column},f.default.createElement("div",{ref:function(t){e.domTree=[t]}},this.renderCard(t)))}}]),n}(f.default.Component);r.default=S,S.contextTypes={result:h.default.string}},5084:function(e,t,r){e.exports={pipelineCard:"_2eHBzosCxbgtloqHDn1-Ex","pipelineCard--error":"_2a6xR8GNuS0WVUKb19NUNR",pipelineCard__title:"_2jIhkiVtLET_xvuGZ-0M-6",pipelineCard__content:"_2T51miiusy8tWiUZmCux0q","pipelineCard--queue":"_3VZzEVJYHZPMpNZ4eDRXss","pipelineCard--paused":"v22GI6pGaLWAoWVvxwD5c",content__title__paused:"Pnq2vGrXWut7p-pStLEub",pipelineCard__item:"SR1CpCBrPBNkI7Ul2_EDK",content__title:"_2cmMrQLyRDmg3OHpHuBbIm",content__detail:"iwd1h6uag7bPGEDdkNh1_",content__status:"_1lkOPUVjrmRUkQA0p7w858",content__status__error:"_2IiISSMW_ulN17yQJlI8uU",content__status__quene:"_30zBiI2PKLrxdi9m930M3g",errorMessage:"_2A_dHZbdDPFnx0KKnRZY7Y",pipeline_column:"_1O8inhZFVScpzI2D4NJS5C"}},5085:function(e,t,r){e.exports={pipeline_column:"_20jzi3f52Hrb5pgs-646AE",container:"_3xW8vKI_CL7cAuQZ9TwYGQ",controls:"_2jEekIW0yyt9loU5COPCDB",control:"VAw4xLNG7YiUysd4l1e7a","slider-wrapper":"_2Q30NeHKzFm0-m0p7oEjhs"}},5086:function(e,r,n){"use strict";var a=n(20);n(12),n(11),n(1037),n(6),n(18),n(1038),n(9),n(13),n(10),n(4),n(23),n(17),n(7),n(110),Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0,n(12),n(45),n(11),n(1037),n(6),n(160),n(18),n(28),n(1038),n(42),n(34),n(15),n(9),n(13),n(10),n(4),n(22),n(23),n(57),n(17),n(7),n(110);var o=a(n(315)),i=a(n(30)),l=a(n(43));n(41);var s,u,c,d,f,p=a(n(44)),h=a(n(65)),m=a(n(36)),v=a(n(37)),g=a(n(88)),y=a(n(55)),b=a(n(56)),E=a(n(51)),S=a(n(49)),D=(a(n(66)),a(n(0))),_=a(n(3)),k=a(n(60)),O=a(n(63)),w=n(14),N=n(239),P=a(n(787)),R=n(186),C=a(n(921)),I=n(434),L=a(n(1986)),T=a(n(5087)),A=a(n(5088)),j=a(n(1987)),x=a(n(5090));function M(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function U(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?M(Object(r),!0).forEach((function(t){(0,i.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):M(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function F(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,E.default)(e);if(t){var a=(0,E.default)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return(0,b.default)(this,r)}}var B=(0,N.observer)((u=function(e){(0,y.default)(s,e);var r,n,a=F(s);function s(e){var r;return(0,m.default)(this,s),r=a.call(this,e),(0,h.default)(r,"isShowLog",c,(0,g.default)(r)),(0,h.default)(r,"activeNodeIndex",d,(0,g.default)(r)),r.logRefresh=null,(0,h.default)(r,"updateActiveTabs",f,(0,g.default)(r)),r.handleDownloadLogs=function(){r.props.handleDownloadLogs()},r.handleExpandErrorStep=function(){var e=(0,w.toJS)(r.props.nodes);if(0!==e.length){var t=e.flat().map((function(e){return e.result})),n=-1;if(-1!==(n=r.props.hasRunning?t.filter((function(e){return"FAILURE"===e||"SUCCESS"===e})).length:Math.max(t.filter((function(e){return"FAILURE"===e||"SUCCESS"===e})).length-1,0)))for(var a=0,o=0;a<e.length;){if(Array.isArray(e[a])){if(n<o+e[a].length)return void(r.activeNodeIndex=[a,n-o]);o+=e[a].length}else{if(a===n)return void(r.activeNodeIndex=[a]);o+=1}a+=1}}},r.handleDownload=(0,p.default)(l.default.mark((function e(){return l.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.setState({isDownloading:!0}),e.next=3,r.store.handleDownloadLogs(r.props.params);case 3:r.setState({isDownloading:!1});case 4:case"end":return e.stop()}}),e)}))),r.handleJumpFullLogs=function(){r.store.handleJumpFullLogs(r.props.params)},r.handleVisableLog=function(){r.isShowLog=!r.isShowLog},r.renderLogButton=function(){return r.isRunning?D.default.createElement(R.Button,{onClick:r.handleVisableLog},t("VIEW_REAL_TIME_LOG")):D.default.createElement("span",null,D.default.createElement(R.Button,{loading:r.state.isLoading,onClick:r.handleDownload},t("DOWNLOAD_LOGS")),D.default.createElement(R.Button,{onClick:r.handleJumpFullLogs},t("VIEW_FULL_LOG")))},r.store=new L.default,r.state={isDownloading:!1},r.reaction=(0,w.reaction)((function(){return r.isEmptySteps}),(function(){var e;clearInterval(r.getIndexLogInterval),r.isEmptySteps&&Array.isArray(null===(e=r.activeStage)||void 0===e?void 0:e.steps)&&(r.getIndexLogInterval=setInterval(r.getPipelineIndexLog,4e3))})),r}return(0,v.default)(s,[{key:"componentDidMount",value:(n=(0,p.default)(l.default.mark((function e(){return l.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getPipelineIndexLog();case 2:this.handleExpandErrorStep(),this.store.getRunDetail(this.props.params);case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"getPipelineIndexLog",value:(r=(0,p.default)(l.default.mark((function e(){return l.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.store.getRunStatusLogs(this.params);case 2:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"renderLeftTab",value:function(e,r){var n,a=this;return Array.isArray(e)?D.default.createElement("div",{key:null!==(n=e.id)&&void 0!==n?n:r,className:j.default.stageContainer},D.default.createElement("div",{className:(0,_.default)(j.default.cutTitle,(0,i.default)({},j.default.activeTitle,this.activeNodeIndex[0]===r))},t("STAGE")),e.map((function(e,t){return D.default.createElement("div",{key:e.id,onClick:a.updateActiveTabs(r,t),className:(0,_.default)(j.default.leftTab,(0,i.default)({},j.default.leftTab__active,a.activeNodeIndex[0]===r&&a.activeNodeIndex[1]===t))},D.default.createElement(C.default,(0,o.default)({},(0,I.getPipelineStatus)(e),{hasLabel:!1})),e.displayName)}))):D.default.createElement("div",{key:e.id,className:j.default.stageContainer},D.default.createElement("div",{className:(0,_.default)(j.default.cutTitle,(0,i.default)({},j.default.activeTitle,this.activeNodeIndex[0]===r))},t("STAGE")),D.default.createElement("div",{className:(0,_.default)(j.default.leftTab,(0,i.default)({},j.default.leftTab__active,this.activeNodeIndex[0]===r)),onClick:this.updateActiveTabs(r,0)},D.default.createElement(C.default,(0,o.default)({},(0,I.getPipelineStatus)(e),{hasLabel:!1})),e.displayName))}},{key:"renderLogContent",value:function(){var e,t,r=this,n=this.store.runDetailLogs;return this.isEmptySteps?"FINISHED"!==(null===(t=this.activeStage)||void 0===t?void 0:t.state)?null:D.default.createElement("pre",{className:j.default.LogItem_content},n):null===(e=this.activeStage)||void 0===e?void 0:e.steps.map((function(e){var t;return D.default.createElement(A.default,{key:e.id,step:e,nodeId:null===(t=r.activeStage)||void 0===t?void 0:t.id,params:r.params,refreshFlag:r.props.refreshFlag})}))}},{key:"render",value:function(){var e,r,n,a=this,o=this.props.nodes,i=(0,w.toJS)(o);return D.default.createElement(D.default.Fragment,null,D.default.createElement("div",{className:j.default.container},D.default.createElement("div",{className:j.default.left},i.map((function(e,t){return a.renderLeftTab(e,t)}))),D.default.createElement("div",{className:j.default.right},D.default.createElement("div",{className:j.default.header},D.default.createElement("span",null,D.default.createElement(T.default,{startTime:null===(e=this.activeStage)||void 0===e?void 0:e.startTime,time:"UNKNOWN"!==(null===(r=this.activeStage)||void 0===r?void 0:r.result)?null===(n=this.activeStage)||void 0===n?void 0:n.durationInMillis:void 0})),this.renderLogButton()),D.default.createElement("div",{className:j.default.logContainer},this.renderLogContent()))),D.default.createElement(P.default,{visible:this.isShowLog,title:t("PIPELINE_LOG"),width:1162,onCancel:this.handleVisableLog},D.default.createElement(x.default,{store:this.store,isShowLog:this.isShowLog,params:this.params,handleVisableLog:this.handleVisableLog})))}},{key:"activeStage",get:function(){var e=this.props.nodes,t=(0,w.toJS)(e[this.activeNodeIndex[0]]);return(0,k.default)(t)&&!(0,O.default)(t)?t[this.activeNodeIndex[1]]:t}},{key:"isEmptySteps",get:function(){var e;return(0,O.default)(null===(e=this.activeStage)||void 0===e?void 0:e.steps)}},{key:"params",get:function(){var e=this.props,t=e.params,r=e.runId;return U(U({},t),{},{runId:r})}},{key:"isRunning",get:function(){var e,t;return(null===(e=this.activeStage)||void 0===e?void 0:e.result)&&"UNKNOWN"===(null===(t=this.activeStage)||void 0===t?void 0:t.result)}}]),s}(D.default.Component),c=(0,S.default)(u.prototype,"isShowLog",[w.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),(0,S.default)(u.prototype,"activeStage",[w.computed],Object.getOwnPropertyDescriptor(u.prototype,"activeStage"),u.prototype),(0,S.default)(u.prototype,"isEmptySteps",[w.computed],Object.getOwnPropertyDescriptor(u.prototype,"isEmptySteps"),u.prototype),d=(0,S.default)(u.prototype,"activeNodeIndex",[w.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[0,0]}}),f=(0,S.default)(u.prototype,"updateActiveTabs",[w.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t,r){return function(){e.activeNodeIndex=[t,r]}}}}),(0,S.default)(u.prototype,"getPipelineIndexLog",[w.action],Object.getOwnPropertyDescriptor(u.prototype,"getPipelineIndexLog"),u.prototype),s=u))||s;r.default=B},5087:function(e,r,n){"use strict";n(15);var a=n(20);n(110),Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0,n(42),n(110);var o=a(n(96)),i=n(0),l=n(52),s=function(e){var r=e.startTime,n=e.time,a=(0,i.useState)(0),s=(0,o.default)(a,2),u=s[0],c=s[1],d=(0,i.useRef)(null);return(0,i.useEffect)((function(){if(r){var e=setInterval((function(){var e=(new Date).getTime()-new Date(r).getTime();c(e)}),300);return d.current=e,function(){return clearInterval(e)}}}),[r]),(0,i.useEffect)((function(){n&&d.current&&clearInterval(d.current)}),[n]),t("DURATION_VALUE",{value:r?(0,l.formatUsedTime)(null!=n?n:u):"-"})};r.default=s},5088:function(e,t,r){"use strict";var n=r(20);r(12),r(11),r(6),r(9),r(13),r(10),r(4),r(23),r(17),r(7),r(110),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,r(12),r(45),r(11),r(6),r(28),r(42),r(34),r(15),r(9),r(13),r(10),r(4),r(23),r(57),r(17),r(7),r(110);var a,o,i=n(r(30)),l=n(r(36)),s=n(r(37)),u=n(r(55)),c=n(r(56)),d=n(r(51)),f=n(r(49)),p=n(r(0)),h=n(r(3)),m=r(186),v=r(14),g=r(239),y=n(r(921)),b=r(434),E=n(r(5089)),S=r(52),D=n(r(1987));function _(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function k(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?_(Object(r),!0).forEach((function(t){(0,i.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function O(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,d.default)(e);if(t){var a=(0,d.default)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return(0,c.default)(this,r)}}var w=(0,g.observer)((o=function(e){(0,u.default)(r,e);var t=O(r);function r(e){var n;return(0,l.default)(this,r),(n=t.call(this,e)).handleExpandByFail=function(){var e=n.props.step;e&&"SUCCESS"!==e.result&&n.toggleExpand()},n.handleRefresh=function(){var e=n.props.step,t=n.store.stepLogData.hasMore;n.state.isExpand&&(t||"FINISHED"!==e.state)&&n.getLog()},n.toggleExpand=function(){var e=n.store.stepLogData.log,t=n.state.isExpand;t||e||n.getLog(),n.setState({isExpand:!t})},n.state={isExpand:!1},n.store=new E.default,n}return(0,s.default)(r,[{key:"componentDidMount",value:function(){this.timer=setInterval(this.handleRefresh,4e3),this.handleExpandByFail()}},{key:"componentDidUpdate",value:function(e){this.state.isExpand&&e.refreshFlag!==this.props.refreshFlag&&(this.store.handleResetStepLog(),this.getLog())}},{key:"componentWillUnmount",value:function(){clearInterval(this.timer)}},{key:"getLog",value:function(){var e=this.props,t=e.step,r=e.params,n=e.nodeId;this.store.getStepLog(k(k({},r),{},{nodeId:n,stepId:t.id}))}},{key:"render",value:function(){var e=this.props.step,t=this.store.stepLogData.log;return p.default.createElement("div",{className:D.default.LogItem},p.default.createElement("div",{className:(0,h.default)(D.default.LogItem__title),onClick:this.toggleExpand},p.default.createElement(m.Icon,{name:this.state.isExpand?"caret-down":"caret-right",size:16}),e.displayName,p.default.createElement("span",{className:D.default.logitem_status},p.default.createElement("span",null,e.durationInMillis?(0,S.formatUsedTime)(e.durationInMillis):"-"),p.default.createElement(y.default,(0,b.getPipelineStatus)(e)))),p.default.createElement("div",null,this.state.isExpand?p.default.createElement("pre",{className:D.default.LogItem_content},t):null))}}]),r}(p.default.Component),(0,f.default)(o.prototype,"getLog",[v.action],Object.getOwnPropertyDescriptor(o.prototype,"getLog"),o.prototype),a=o))||a;t.default=w},5089:function(e,t,r){"use strict";r(15);var n=r(20);r(5),r(16),r(4),r(23),r(17),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,r(45),r(5),r(42),r(16),r(4),r(22),r(23),r(57),r(17);var a=n(r(43));r(41);var o,i,l,s=n(r(44)),u=n(r(65)),c=n(r(36)),d=n(r(37)),f=n(r(88)),p=n(r(55)),h=n(r(56)),m=n(r(51)),v=n(r(49)),g=(n(r(66)),n(r(26))),y=r(14);function b(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,m.default)(e);if(t){var a=(0,m.default)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return(0,h.default)(this,r)}}var E=(o=function(e){(0,p.default)(n,e);var t,r=b(n);function n(){var e;(0,c.default)(this,n);for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return e=r.call.apply(r,[this].concat(a)),(0,u.default)(e,"stepLogData",i,(0,f.default)(e)),(0,u.default)(e,"handleResetStepLog",l,(0,f.default)(e)),e}return(0,d.default)(n,[{key:"getStepLog",value:(t=(0,s.default)(a.default.mark((function e(t){var r,n,o,i,l,s,u,c,d,f,p,h;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.devops,o=t.cluster,i=t.name,l=t.branch,s=t.runId,u=t.nodeId,c=t.stepId,d=this.stepLogData.start?"?start=".concat(this.stepLogData.start):"",f=l?{}:{"x-file-size-limit":5242880},e.next=5,request.defaults({url:"".concat(this.getDevopsUrlV2({cluster:o,devops:n}),"pipelines/").concat(decodeURIComponent(i)).concat(l?"/branches/".concat(encodeURIComponent(l)):"","/runs/").concat(s,"/nodes/").concat(u,"/steps/").concat(c,"/log/").concat(d),options:{headers:f},handler:function(e){if(200===e.status)return e.text().then((function(t){return{data:t,headers:e.headers}}))}});case 5:p=e.sent,h=this.stepLogData.start?this.stepLogData.log:"",this.stepLogData={log:h+(0,g.default)(p,"data",""),start:p.headers.get("x-text-size"),hasMore:Boolean(p.headers.get("x-more-data"))},("true"===p.headers.get("X-File-Size-Limit-Out")||(null===(r=this.log)||void 0===r?void 0:r.length)>5242880)&&(this.stepLogData.hasMore=!1,this.stepLogData.log+="\n\n*****************************************************************   \n*                                                               * \n* The log is too large, please download it to view the details. *\n*                                                               * \n*****************************************************************    \n      ");case 9:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),n}(n(r(323)).default),i=(0,v.default)(o.prototype,"stepLogData",[y.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{log:"",start:0,hasMore:!1}}}),l=(0,v.default)(o.prototype,"handleResetStepLog",[y.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){e.stepLogData={log:"",start:0,hasMore:!1}}}}),o);t.default=E},5090:function(e,r,n){"use strict";n(15);var a=n(20);n(5),n(86),n(9),n(4),n(23),n(24),n(17),n(136),n(110),Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0,n(45),n(5),n(86),n(42),n(9),n(4),n(22),n(23),n(57),n(24),n(17),n(136),n(110);var o=a(n(43));n(41);var i,l,s=a(n(44)),u=a(n(36)),c=a(n(37)),d=a(n(55)),f=a(n(56)),p=a(n(51)),h=a(n(49)),m=a(n(0)),v=n(14),g=n(239),y=n(186),b=a(n(5091));function E(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,p.default)(e);if(t){var a=(0,p.default)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return(0,f.default)(this,r)}}var S=(0,g.observer)((l=function(e){(0,d.default)(n,e);var r=E(n);function n(){var e;(0,u.default)(this,n);for(var a=arguments.length,i=new Array(a),l=0;l<a;l++)i[l]=arguments[l];return(e=r.call.apply(r,[this].concat(i))).ref=m.default.createRef(),e.store=e.props.store,e.logRefreshInterval=null,e.state={isRealtime:!1,isDownloading:!1},e.scrollToBottom=function(){var t=e.ref.current;t&&(t.scrollTop=t.scrollHeight)},e.handleGetLogs=(0,s.default)(o.default.mark((function t(){return o.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.getPipelineIndexLog();case 2:e.handleAutoRefreshLogs();case 3:case"end":return t.stop()}}),t)}))),e.handleDownload=(0,s.default)(o.default.mark((function t(){return o.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.setState({isDownloading:!0}),t.next=3,e.store.handleDownloadLogs(e.props.params);case 3:e.setState({isDownloading:!1});case 4:case"end":return t.stop()}}),t)}))),e.handleRefreshLogs=(0,s.default)(o.default.mark((function t(){return o.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.getPipelineIndexLog(!0);case 2:return t.next=4,e.handleRealtime();case 4:e.scrollToBottom();case 5:case"end":return t.stop()}}),t)}))),e.handleSetLogsInterval=function(t){e.logRefreshInterval=setInterval((0,s.default)(o.default.mark((function r(){return o.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,e.getPipelineIndexLog();case 2:e.scrollToBottom(),e.isLogFinish&&(clearInterval(e.logRefreshInterval),t&&t());case 4:case"end":return r.stop()}}),r)}))),2e3)},e.handleRealtime=function(){e.state.isRealtime?(clearInterval(e.logRefreshInterval),e.setState({isRealtime:!1})):(e.setState({isRealtime:!0}),e.handleSetLogsInterval((function(){e.setState({isRealtime:!1})})))},e.handleAutoRefreshLogs=function(){e.isLogFinish||e.logRefreshInterval||(e.setState({isRealtime:!0}),e.handleSetLogsInterval((function(){e.setState({isRealtime:!1})}))),e.isLogFinish&&e.scrollToBottom()},e.renderOperations=function(){var r=e.state,n=r.isRealtime,a=r.isDownloading;return m.default.createElement("div",{className:b.default.operations},m.default.createElement(y.Tooltip,{content:t("BACK")},m.default.createElement(y.Icon,{name:"return",color:{primary:"#fff",secondary:"#fff"},size:20,onClick:e.props.handleVisableLog,clickable:!0,changeable:!0})),m.default.createElement("span",{className:b.default.split},"|"),m.default.createElement(y.Tooltip,{content:t(n?"STOP_REAL_TIME_LOG":"START_REAL_TIME_LOG")},m.default.createElement(y.Icon,{name:n?"stop":"start",color:{primary:"#fff",secondary:"#fff"},size:20,onClick:e.handleRealtime,clickable:!0,changeable:!0})),m.default.createElement("span",{className:b.default.split},"|"),m.default.createElement(y.Tooltip,{content:t("REFRESH")},m.default.createElement(y.Icon,{name:"refresh",color:{primary:"#fff",secondary:"#fff"},size:20,onClick:n?null:e.handleRefreshLogs,clickable:!0,changeable:!0,disabled:n})),m.default.createElement("span",{className:b.default.split},"|"),m.default.createElement(y.Tooltip,{content:t("DOWNLOAD")},a?m.default.createElement(y.Loading,{size:16}):m.default.createElement(y.Icon,{name:"download",color:{primary:"#fff",secondary:"#fff"},size:20,onClick:e.handleDownload,clickable:!0,changeable:!0})))},e}return(0,c.default)(n,[{key:"getPipelineIndexLog",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.props.params;this.store.getRunStatusLogs(t,e)}},{key:"componentDidMount",value:function(){this.handleGetLogs()}},{key:"componentWillUnmount",value:function(){clearInterval(this.logRefreshInterval)}},{key:"render",value:function(){var e=this.store.runDetailLogs;return m.default.createElement("div",{className:b.default.logs_container},m.default.createElement("div",{className:b.default.log,ref:this.ref},this.renderOperations(),m.default.createElement("pre",{className:b.default.LogItem_content},e)))}},{key:"isLogFinish",get:function(){if(this.store.overflow)return!0;for(var e=this.store.runDetailLogs.split("\n"),t=e.length-1,r=0,n=!1;r<2;)n=e[t]&&e[t].indexOf("Finished")>-1,t--,r++;return n}}]),n}(m.default.Component),(0,h.default)(l.prototype,"getPipelineIndexLog",[v.action],Object.getOwnPropertyDescriptor(l.prototype,"getPipelineIndexLog"),l.prototype),(0,h.default)(l.prototype,"isLogFinish",[v.computed],Object.getOwnPropertyDescriptor(l.prototype,"isLogFinish"),l.prototype),i=l))||i;r.default=S},5091:function(e,t,r){e.exports={logs_container:"_1a-zP9_2YDUkWD-6LJkS9c",log:"_7SKszFrl5ToySuqKb58u_",operations:"QVvKuNdaSqvfGkf6g4REX",split:"q-xnWS4mmEgTxiHJB-Mje"}},5092:function(e,t,r){e.exports={pipelineCard:"_15Io83PX3ThKRG-aELylW-",pipelineCard__tab:"_3618Tf5Fsa2rvv2BDhJxih",pipelineCard_content:"bIQp-H7_AePWnP-iqbWXS",pipelineCard_pipeline_content:"d8kWWAlfJhFL8fYgY8Nvk",pipelineCard__toolbar:"_2-2rg2XNK4zLkGIDllkyh",icon:"_3Kbhn58kNwzcDj56uGaotu",pipelineCard__btnGroup:"_1s6pPyPc-w54dHQomyI86W",pipelineCard__main:"_2jX4VRaYREStNMY3wXj5EN",footer:"_2trt1J67jrYmriGPqLKZDV",running_tips:"_2KW8xeUQEVlEv60ExnekFN",runningIcon:"_1UVLjnaxVf-hr4kl8rQxkm",rotate:"Dacx0RATJmtvUY10xbkIq",QueuedIcon:"_2RuQE76Kv9oKvrUnVEZMkX",breath:"_1GD36aiJGyeNr3qUQuodKa",card:"_118Qk5exDgXSaS3rqlSgX0",title:"CqPIRnLO2E1dTMGYHHyNQ",desc:"_2SC0de7wLtaphQs2_5YQYo"}},5093:function(e,r,n){"use strict";var a=n(20);n(12),n(5),n(11),n(6),n(48),n(16),n(9),n(13),n(10),n(4),n(23),n(24),n(17),n(62),n(188),n(7),Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0,n(12),n(45),n(5),n(11),n(6),n(28),n(48),n(42),n(16),n(34),n(15),n(9),n(13),n(10),n(4),n(23),n(57),n(24),n(17),n(62),n(188),n(7);var o,i=a(n(30)),l=a(n(36)),s=a(n(37)),u=a(n(55)),c=a(n(56)),d=a(n(51)),f=a(n(0)),p=a(n(189)),h=n(14),m=n(239),v=n(244),g=n(52),y=a(n(796)),b=a(n(963));function E(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function S(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?E(Object(r),!0).forEach((function(t){(0,i.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):E(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function D(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,d.default)(e);if(t){var a=(0,d.default)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return(0,c.default)(this,r)}}var _=(0,m.inject)("rootStore","detailStore")(o=(0,m.observer)(o=function(e){(0,u.default)(n,e);var r=D(n);function n(){var e;(0,l.default)(this,n);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(e=r.call.apply(r,[this].concat(o))).store=e.props.detailStore||{},e.name="Commit",e.handleFetch=function(t,r){e.routing.query(t,r)},e.getFilteredValue=function(t){return e.store.list.filters[t]},e.getColumns=function(){return[{title:t("COMMIT"),dataIndex:"commitId",width:"20%",render:function(e,t){return f.default.createElement("a",{href:t.url,target:"_blank",rel:"noreferrer noopener"},e&&e.slice(0,6))}},{title:t("AUTHOR"),dataIndex:"author",width:"20%",render:function(e){return e||"-"}},{title:t("MESSAGE"),dataIndex:"title",width:"40%"},{title:t("UPDATE_TIME_TCAP"),dataIndex:"startTime",isHideable:!0,width:"15%",render:function(e){return(0,g.getLocalTime)(e).format("YYYY-MM-DD HH:mm:ss")}}]},e}return(0,s.default)(n,[{key:"componentDidMount",value:function(){var e=this,t=this.props.match.params;this.unsubscribe=this.routing.history.subscribe((function(r){if(r.pathname===e.props.match.url){var n=(0,v.parse)(r.search.slice(1));e.getData(S(S({},t),n))}}))}},{key:"componentWillUnmount",value:function(){this.unsubscribe&&this.unsubscribe()}},{key:"getData",value:function(e){this.store.getCommits(S({},e))}},{key:"render",value:function(){var e=(0,h.toJS)(this.store.commitsList),r=e.data,n=e.filters,a=e.selectedRowKeys,o=e.isLoading,i=e.total,l=e.page,s=e.limit,u=!1===o&&0===i,c=(0,p.default)(n,"page");if(u&&!n.page)return f.default.createElement(b.default,{desc:t("NO_COMMIT_FOUND")});var d={total:i,page:l,limit:s};return f.default.createElement(y.default,{data:r,rowKey:"commitId",columns:this.getColumns(),filters:c,pagination:d,isLoading:o,selectedRowKeys:a,onFetch:this.handleFetch,hideSearch:!0})}},{key:"routing",get:function(){return this.props.rootStore.routing}}]),n}(f.default.Component))||o)||o;r.default=_},5094:function(e,r,n){"use strict";var a=n(20);n(12),n(5),n(11),n(6),n(48),n(16),n(9),n(13),n(10),n(4),n(23),n(24),n(17),n(62),n(188),n(7),Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0,n(12),n(45),n(5),n(11),n(6),n(28),n(48),n(42),n(16),n(34),n(15),n(9),n(13),n(10),n(4),n(23),n(57),n(24),n(17),n(62),n(188),n(7);var o,i=a(n(30)),l=a(n(36)),s=a(n(37)),u=a(n(55)),c=a(n(56)),d=a(n(51)),f=a(n(0)),p=n(14),h=n(239),m=n(244),v=a(n(189)),g=n(186),y=n(52),b=a(n(796)),E=a(n(963));function S(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function D(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?S(Object(r),!0).forEach((function(t){(0,i.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):S(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function _(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,d.default)(e);if(t){var a=(0,d.default)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return(0,c.default)(this,r)}}var k=(0,h.inject)("rootStore","detailStore")(o=(0,h.observer)(o=function(e){(0,u.default)(n,e);var r=_(n);function n(){var e;(0,l.default)(this,n);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(e=r.call.apply(r,[this].concat(o))).name="Artifacts",e.store=e.props.detailStore||{},e.handleFetch=function(t,r){e.routing.query(t,r)},e.getDownloadUrl=function(t,r,n){var a=e.props.match.params;return"default"!==a.cluster&&a.cluster?"/kapis/clusters/".concat(a.cluster,"/devops.kubesphere.io/v1alpha3/namespaces/").concat(a.devops,"/pipelineruns/").concat(r,"/artifacts/download?filename=").concat(n):"/kapis/devops.kubesphere.io/v1alpha3/namespaces/".concat(a.devops,"/pipelineruns/").concat(r,"/artifacts/download?filename=").concat(n)},e.getFilteredValue=function(t){return e.store.list.filters[t]},e.getColumns=function(r,n){return[{title:t("NAME"),dataIndex:"path",width:"40%",render:function(t){return f.default.createElement("a",{href:e.getDownloadUrl(r,n,t),target:"_blank",download:!0,rel:"noreferrer noopener"},t)}},{title:t("SIZE"),dataIndex:"size",width:"40%",render:function(e){return(0,y.formatSize)(e)}},{title:t("DOWNLOAD"),width:"20%",key:"download",render:function(t,a){var o=a.path;return f.default.createElement("a",{href:e.getDownloadUrl(r,n,o),target:"_blank",download:!0,rel:"noreferrer noopener"},f.default.createElement(g.Icon,{name:"download"}))}}]},e}return(0,s.default)(n,[{key:"componentDidMount",value:function(){var e=this,t=this.props.match.params;this.unsubscribe=this.routing.history.subscribe((function(r){if(r.pathname===e.props.match.url){var n=(0,m.parse)(r.search.slice(1));e.getData(D(D({},t),n))}}))}},{key:"componentWillUnmount",value:function(){this.unsubscribe&&this.unsubscribe()}},{key:"getData",value:function(e){this.store.getArtifacts(D({},e))}},{key:"render",value:function(){var e=(0,p.toJS)(this.store.artifactsList),r=e.data,n=e.pipeline,a=e.pipelineRun,o=e.filters,i=e.isLoading,l=e.total,s=e.page,u=e.limit,c=0===l,d=(0,v.default)(o,"page","workspace");if(c&&!o.page)return f.default.createElement(E.default,{desc:t("NO_ARTIFACT_FOUND_TIP")});var h={total:l,page:s,limit:u};return f.default.createElement(b.default,{data:r,columns:this.getColumns(n,a),filters:d,rowKey:"path",pagination:h,isLoading:i,onFetch:this.handleFetch,hideSearch:!0})}},{key:"routing",get:function(){return this.props.rootStore.routing}},{key:"prefix",get:function(){return this.props.match.url}}]),n}(f.default.Component))||o)||o;r.default=k},5095:function(e,t,r){"use strict";r(15);var n=r(20);r(5),r(4),r(23),r(17),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,r(45),r(5),r(28),r(42),r(4),r(23),r(57),r(17);var a,o=n(r(36)),i=n(r(37)),l=n(r(55)),s=n(r(56)),u=n(r(51)),c=n(r(0)),d=r(14),f=r(239),p=n(r(5096)),h=n(r(5098));function m(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,u.default)(e);if(t){var a=(0,u.default)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return(0,s.default)(this,r)}}var v=(0,f.inject)("rootStore","sonarqubeStore")(a=(0,f.observer)(a=function(e){(0,l.default)(r,e);var t=m(r);function r(){var e;(0,o.default)(this,r);for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).renderResult=function(){var t=e.props.sonarqubeStore,r=t.detail,n=void 0===r?{}:r,a=t.isLoading;return c.default.createElement(p.default,{detail:n,loading:a})},e.renderIssues=function(){var t=e.props.sonarqubeStore,r=t.detail,n=void 0===r?{}:r,a=t.isLoading;return c.default.createElement(h.default,{detail:n,issues:(0,d.toJS)(n.issues),loading:a})},e}return(0,i.default)(r,[{key:"componentDidMount",value:function(){var e=this.props.sonarqubeStore,t=e.detail,r=void 0===t?{}:t,n=e.isLoading;r.totalStatus||n||this.props.rootStore.routing.push("./activity")}},{key:"render",value:function(){return c.default.createElement("div",null,this.renderResult(),this.renderIssues())}}]),r}(c.default.Component))||a)||a;t.default=v},5096:function(e,r,n){"use strict";n(15);var a=n(20);n(5),n(190),n(4),n(23),n(17),Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0,n(45),n(5),n(42),n(190),n(4),n(436),n(23),n(57),n(17);var o=a(n(30)),i=a(n(36)),l=a(n(37)),s=a(n(55)),u=a(n(56)),c=a(n(51)),d=a(n(0)),f=a(n(1)),p=a(n(3)),h=a(n(26)),m=a(n(801)),v=n(186),g=n(52),y=a(n(5097)),b=a(n(1988));function E(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,c.default)(e);if(t){var a=(0,c.default)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return(0,u.default)(this,r)}}var S=function(e){(0,s.default)(n,e);var r=E(n);function n(){var e;(0,i.default)(this,n);for(var a=arguments.length,l=new Array(a),s=0;s<a;s++)l[s]=arguments[s];return(e=r.call.apply(r,[this].concat(l))).goToSonarqube=function(){var t=e.props.detail.sonarqubeDashboardUrl,r=(0,h.default)(globals,"config.devops.sonarqubeURL");if(r){var n=(0,g.parseUrl)(t),a=r+(0,h.default)(n,"pathname","")+(0,h.default)(n,"search","");window.open(a)}else window.open(t)},e.renderTotalResult=function(){var r,n="ERROR"!==e.props.detail.totalStatus;return d.default.createElement("div",{className:(0,p.default)(b.default.totalResult,(r={},(0,o.default)(r,b.default.success,n),(0,o.default)(r,b.default.error,!n),r))},d.default.createElement(v.Icon,{name:n?"check":"close",className:b.default.icon,size:24,color:{primary:"#ffffff",secondary:"#ffffff"}}),d.default.createElement("p",null,t("CODE_CHECK")),d.default.createElement("p",null,n?t("PASSED"):t("FAILED")))},e.renderOtherResults=function(){var r=e.props.detail,n=r.bugRating,a=r.bugs,o=r.securityRating,i=r.vulnerabilities,l=r.codeSmells,s=r.coverage,u=r.key,c=r.totalCode>1e3?parseFloat(r.totalCode/1e3).toFixed(2):r.totalCode,f=r.totalCode>1e3?"K":"";return d.default.createElement("div",{className:b.default.otherCards},d.default.createElement(y.default,{title:t("CODE_LINE_COUNT"),value:c,unit:f,url:"".concat(e.sonarqubeOrigin,"/component_measures?id=").concat(u,"&metric=ncloc")}),d.default.createElement(y.default,{hasIcon:!0,title:t("BUG_PL"),value:a,unit:"",resultClass:n,url:"".concat(e.sonarqubeOrigin,"/project/issues?id=").concat(u,"&resolved=false&types=BUG")}),d.default.createElement(y.default,{hasIcon:!0,title:t("VULNERABILITY_PL"),value:i,unit:"",resultClass:o,url:"".concat(e.sonarqubeOrigin,"/project/issues?id=").concat(u,"&resolved=false&types=VULNERABILITY")}),d.default.createElement(y.default,{hasIcon:!0,title:t("CODE_SMELL_PL"),value:l,unit:"",url:"".concat(e.sonarqubeOrigin,"/project/issues?id=").concat(u,"&resolved=false&types=CODE_SMELL")}),d.default.createElement(y.default,{hasIcon:!0,title:t("COVERAGE"),value:s,unit:"%",url:"".concat(e.sonarqubeOrigin,"/component_measures?id=").concat(u,"&metric=coverage")}))},e.renderLogo=function(){return d.default.createElement("span",{onClick:e.goToSonarqube,className:b.default.logo})},e}return(0,l.default)(n,[{key:"render",value:function(){return this.props.loading?null:d.default.createElement(m.default,{title:t("TEST_RESULTS"),operations:this.renderLogo()},d.default.createElement("div",{className:b.default.content},this.renderTotalResult(),this.renderOtherResults()))}},{key:"sonarqubeOrigin",get:function(){var e=this.props.detail.sonarqubeDashboardUrl;return(0,h.default)(globals,"config.devops.sonarqubeURL")||(0,g.parseUrl)(e).origin}}]),n}(d.default.Component);S.propTypes={detail:f.default.object,loading:f.default.bool};var D=S;r.default=D},5097:function(e,t,r){"use strict";r(15);var n=r(20);r(4),r(23),r(17),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,r(45),r(42),r(4),r(319),r(23),r(57),r(17);var a=n(r(36)),o=n(r(37)),i=n(r(55)),l=n(r(56)),s=n(r(51)),u=n(r(0)),c=r(186),d=n(r(1988));function f(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,s.default)(e);if(t){var a=(0,s.default)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return(0,l.default)(this,r)}}var p=["A","B","C","D"],h=function(e){(0,i.default)(r,e);var t=f(r);function r(){return(0,a.default)(this,r),t.apply(this,arguments)}return(0,o.default)(r,[{key:"render",value:function(){var e=this.props,t=e.hasIcon,r=e.title,n=e.value,a=e.resultClass,o=e.unit,i=e.url,l=p[parseInt(a,10)-1];return u.default.createElement("div",{className:d.default.resultCard},u.default.createElement("p",{className:d.default.title},t?u.default.createElement(c.Icon,{name:"debug",size:20}):null,r,a?u.default.createElement("span",{className:d.default[l]},l):null),u.default.createElement("p",{className:d.default.value},i?u.default.createElement("a",{href:i,target:"_blank",rel:"noreferrer noopener"},u.default.createElement("span",null,n)):u.default.createElement("span",null,n),u.default.createElement("span",{className:d.default.unit},o)))}}]),r}(u.default.PureComponent);t.default=h,h.defaultProps={hasIcon:!1,title:"-",value:0,url:""}},5098:function(e,r,n){"use strict";n(15);var a=n(20);n(18),n(4),n(23),n(17),Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0,n(45),n(18),n(42),n(4),n(23),n(57),n(17);var o=a(n(36)),i=a(n(37)),l=a(n(55)),s=a(n(56)),u=a(n(51)),c=a(n(0)),d=a(n(1)),f=a(n(26)),p=a(n(801)),h=n(52),m=a(n(5099)),v=a(n(1989)),g=a(n(1460));function y(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,u.default)(e);if(t){var a=(0,u.default)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return(0,s.default)(this,r)}}var b=function(e){(0,l.default)(n,e);var r=y(n);function n(e){var a;(0,o.default)(this,n),(a=r.call(this,e)).showMore=function(){a.setState({showMore:!0})},a.renderTitle=function(){var e=a.props.detail,r=e.critical,n=e.major,o=e.minor,i=e.info,l=e.blocker;return c.default.createElement("div",{className:g.default.header},c.default.createElement("span",{className:g.default.title},t("ISSUE_PL")),c.default.createElement("div",{className:g.default.details},c.default.createElement("span",null,c.default.createElement(v.default,{errorClass:"blocker"}),l||0),c.default.createElement("span",null,c.default.createElement(v.default,{errorClass:"critical"}),r||0),c.default.createElement("span",null,c.default.createElement(v.default,{errorClass:"major"}),n||0),c.default.createElement("span",null,c.default.createElement(v.default,{errorClass:"minor"}),o||0),c.default.createElement("span",null,c.default.createElement(v.default,{errorClass:"info"}),i||0)))},a.renderIssue=function(e,t){var r=a.props.issues;if(a.state.showMore&&t>10)return null;var n=0===t||e.component!==r[t-1].component;return c.default.createElement(m.default,{key:t,hasTitle:n,issue:e,origin:a.sonarqubeOrigin})},a.renderMoreBtn=function(){return a.state.showMore?null:c.default.createElement("p",{className:g.default.titleShowMore},t("DISPLAY_ONLY_LAST_TEN"),",",c.default.createElement("span",{onClick:a.showMore},t("DISPLAY_ALL")))};var i=e.issues.length<=10;return a.state={showMore:i},a}return(0,i.default)(n,[{key:"sonarqubeOrigin",get:function(){var e=this.props.detail.sonarqubeDashboardUrl;return(0,f.default)(globals,"config.devops.sonarqubeURL")||(0,h.parseUrl)(e).origin}}]),(0,i.default)(n,[{key:"render",value:function(){var e=this,r=this.props,n=r.loading,a=r.issues;return n?null:a.length?c.default.createElement(p.default,{title:this.renderTitle(),operations:this.renderMoreBtn()},c.default.createElement("div",{className:g.default.content},a.map((function(t,r){return e.renderIssue(t,r)})),this.state.showMore?null:c.default.createElement("div",{className:g.default.displayAll,onClick:this.showMore},t("DISPLAY_ALL")))):null}}]),n}(c.default.Component);b.propTypes={issues:d.default.array,loading:d.default.bool},b.defaultProps={issues:[]};var E=b;r.default=E},5099:function(e,r,n){"use strict";n(15);var a=n(20);n(5),n(4),n(23),n(17),Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0,n(45),n(5),n(42),n(4),n(23),n(57),n(17);var o=a(n(36)),i=a(n(37)),l=a(n(55)),s=a(n(56)),u=a(n(51)),c=a(n(0)),d=a(n(1)),f=a(n(3)),p=n(186),h=a(n(1989)),m=a(n(1460));function v(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,u.default)(e);if(t){var a=(0,u.default)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return(0,s.default)(this,r)}}var g=function(e){(0,l.default)(n,e);var r=v(n);function n(){var e;(0,o.default)(this,n);for(var a=arguments.length,i=new Array(a),l=0;l<a;l++)i[l]=arguments[l];return(e=r.call.apply(r,[this].concat(i))).renderErrorCode=function(r){var n=e.props.origin,a=(r.severity||"").toLocaleLowerCase();return c.default.createElement("a",{key:r.line,href:"".concat(n,"/project/issues?id=").concat(r.project,"&open=").concat(r.key),target:"_blank",rel:"noreferrer noopener"},c.default.createElement("div",{className:(0,f.default)(m.default.errorCard,m.default["card-".concat(a)]),onClick:e.handleGoToDetail},c.default.createElement("p",{className:m.default.message},r.message),c.default.createElement("div",{className:m.default.status},c.default.createElement(h.default,{errorClass:a}),c.default.createElement("span",{className:m.default.type},c.default.createElement(p.Icon,{name:"debug",size:20}),t(r.type.toUpperCase())),c.default.createElement("span",null,t("LINE_VALUE",{value:r.line})))))},e}return(0,i.default)(n,[{key:"render",value:function(){var e=this.props,t=e.issue;return e.hasTitle?c.default.createElement(c.default.Fragment,null,c.default.createElement("p",{key:t.component,className:m.default.fileTitle},t.component),this.renderErrorCode(t)):this.renderErrorCode(t)}}]),n}(c.default.PureComponent);g.propTypes={issues:d.default.array,index:d.default.number},g.defaultProps={issues:[]};var y=g;r.default=y},5100:function(e,t,r){"use strict";r(15);var n=r(20);r(4),r(23),r(24),r(17),r(62),Object.defineProperty(t,"__esModule",{value:!0}),t.Component=t.default=void 0,r(45),r(42),r(4),r(22),r(23),r(57),r(24),r(17),r(62);var a=n(r(43));r(41);var o=n(r(44)),i=n(r(36)),l=n(r(37)),s=n(r(55)),u=n(r(56)),c=n(r(51)),d=n(r(0)),f=r(14),p=r(239),h=r(52),m=n(r(1110)),v=n(r(26)),g=n(r(1405));function y(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,c.default)(e);if(t){var a=(0,c.default)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return(0,u.default)(this,r)}}var b=function(e){(0,s.default)(n,e);var t,r=y(n);function n(e){var t;return(0,i.default)(this,n),(t=r.call(this,e)).eventStore=new m.default,t}return(0,l.default)(n,[{key:"componentDidMount",value:function(){this.fetchData()}},{key:"fetchData",value:(t=(0,o.default)(a.default.mark((function e(){var t,r,n,o;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.store.runDetail._originData,r=void 0===t?{}:t,n=(0,v.default)(r,"metadata.namespace",""),o={"involvedObject.name":(0,v.default)(r,"metadata.name",""),"involvedObject.namespace":n,"involvedObject.kind":r.kind,"involvedObject.uid":(0,v.default)(r,"metadata.uid","")},this.eventStore.fetchList({namespace:n,cluster:this.cluster,fieldSelector:(0,h.joinSelector)(o)});case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"render",value:function(){var e=(0,f.toJS)(this.eventStore.list),t=e.data,r=e.isLoading;return d.default.createElement(g.default,{data:t,loading:r})}},{key:"store",get:function(){return this.props.detailStore}},{key:"cluster",get:function(){return this.props.match.params.cluster}},{key:"module",get:function(){return this.store.module}}]),n}(d.default.Component),E=(0,p.inject)("detailStore")((0,p.observer)(b));t.default=E;var S=b;t.Component=S},5101:function(e,r,n){"use strict";n(15);var a=n(157),o=n(20);n(1153),n(1154),n(16),Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0,n(1153),n(1154),n(16),n(4);var i=o(n(963)),l=o(n(26)),s=n(239),u=a(n(0)),c=o(n(5102)),d=(0,s.inject)("detailStore")((0,s.observer)((function(e){var r=(0,l.default)(e,"spec.parameters",[]).flatMap((function(e){return[[e.name,e.value]]}));return 0===r.length?u.createElement(i.default,{desc:t("NO_BUILD_PARAMETERS")}):u.createElement(c.default,{title:t("BUILD_PARAMETERS"),list:r})})));r.default=d},5102:function(e,t,r){"use strict";r(15);var n=r(20);r(18),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,r(160),r(18);var a=n(r(0)),o=n(r(3)),i=n(r(5103)),l=function(e){var t=e.title,r=e.list;return a.default.createElement("div",{className:(0,o.default)(i.default.card,{})},a.default.createElement("div",{className:i.default.header},a.default.createElement("div",{className:i.default.title},t)),a.default.createElement("div",{className:(0,o.default)(i.default.content,{})},r.map((function(e,t){return a.default.createElement("div",{key:t,className:i.default.item},Array.isArray(e)&&e.map((function(e){return a.default.createElement("span",{key:e,className:i.default.kv},e)})),"string"==typeof e&&a.default.createElement("span",{className:i.default.kv},e))}))))};t.default=l},5103:function(e,t,r){e.exports={card:"_1blGTvqEi-bXwWaMYZSA0k",hideContent:"_1EHhyog2LSG60P8q82Rpwt",title:"_3Ptq8f9CHhgUxRPCgAattX",header:"_39urUkpwRMY9vuxAEnCMVF",item:"_1z2NYpACA-Pyx8UoJgp258",kv:"_2iylaXNWKojI2gLQ-AuKJB",content:"_1ftBo6hajH-_nkjQe4ej5Q","max-height":"_3orRaTMVbbaQrxvs365czD",hide:"_2XEcxb-w5iXKKkNZnrKNoX"}},5104:function(e,r,n){"use strict";n(15);var a=n(20);n(5),n(11),n(84),n(16),n(4),n(23),n(24),n(17),n(85),n(62),Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0,n(45),n(5),n(11),n(84),n(42),n(16),n(4),n(22),n(23),n(57),n(24),n(17),n(85),n(62);var o=a(n(315)),i=a(n(43));n(41);var l,s=a(n(44)),u=a(n(36)),c=a(n(37)),d=a(n(55)),f=a(n(56)),p=a(n(51)),h=a(n(240)),m=n(1144),v=a(n(1990)),g=a(n(921)),y=a(n(1143)),b=a(n(800)),E=a(n(26)),S=a(n(63)),D=n(14),_=n(239),k=a(n(243)),O=a(n(0)),w=a(n(1991)),N=n(52),P=n(791),R=n(434);function C(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,p.default)(e);if(t){var a=(0,p.default)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return(0,f.default)(this,r)}}n(1992);var I=(0,_.inject)("rootStore","devopsStore","pipelineStore")(l=(0,_.observer)(l=(0,P.trigger)(l=function(e){(0,d.default)(n,e);var r=C(n);function n(){var e;(0,u.default)(this,n);for(var a=arguments.length,o=new Array(a),l=0;l<a;l++)o[l]=arguments[l];return(e=r.call.apply(r,[this].concat(o))).sonarqubeStore=new w.default,e.module="pipelineruns",e.fetchData=function(){var t=e.props.match.params;e.store.setDevops(t.devops),e.store.getBranchDetail(t),e.getSonarqube()},e.getSonarqube=function(){if((0,E.default)(globals,"config.devops.sonarqubeURL")){var t=e.props.match.params;e.sonarqubeStore.fetchDetail(t)}},e.getOperations=function(){return[{key:"run",type:"control",text:t("RUN"),action:"edit",onClick:e.handleRun}]},e.getAttrs=function(){var r=e.store,n=r.detail,a=r.activityList,o=r.branchDetail,i=e.props.devopsStore.devopsName,l=e.props.match.params.branch;return[{name:t("DEVOPS_PROJECT"),value:(0,N.showNameAndAlias)(i,"devops")},{name:t("PIPELINE"),value:O.default.createElement("span",null,n.name,"/",o.disabled?O.default.createElement("del",null,decodeURIComponent(l)):decodeURIComponent(l))},{name:t("TASK_STATUS"),value:O.default.createElement(g.default,(0,R.getPipelineStatus)((0,E.default)((0,D.toJS)(a.data),"[0]",{})))},{name:t("UPDATE_TIME_TCAP"),value:e.updateTime}]},e.handleRun=(0,b.default)((0,s.default)(i.default.mark((function r(){var n,a,o,l;return i.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=e.props.match.params,r.next=3,e.store.getBranchDetail(n);case 3:if(a=e.store.branchDetail,o=!(0,S.default)((0,D.toJS)(a.branchNames)),l=!(0,S.default)((0,D.toJS)(a.parameters)),!o&&!l){r.next=10;break}e.trigger("pipeline.params",{devops:n.devops,cluster:n.cluster,params:n,branches:e.isAtBranchDetailPage?null:[(0,D.toJS)(a.name)],parameters:(0,D.toJS)(a.parameters),success:function(){h.default.success({content:t("PIPELINE_RUN_START_SI")}),e.handleFetch()}}),r.next=14;break;case 10:return h.default.success({content:t("PIPELINE_RUN_START_SI")}),r.next=13,e.store.runBranch(n);case 13:e.handleFetch();case 14:case"end":return r.stop()}}),r)}))),500),e.handleFetch=function(t,r){e.routing.query(t,r)},e.renderNav=function(){return O.default.createElement(v.default,{sonarqubeStore:e.sonarqubeStore,detailStore:e.store,route:e.props.route,match:e.props.match})},e}return(0,c.default)(n,[{key:"componentDidMount",value:function(){this.fetchData()}},{key:"render",value:function(){var e=this,r={detailStore:this.store,sonarqubeStore:this.sonarqubeStore},n=this.props.match.params.branch,a=this.store.branchDetail,i=this.getOperations().filter((function(t){return e.enabledActions.includes(t.action)})),l=this.props.match.params,s=l.devops,u=l.cluster,c=l.workspace,d=l.name,f={icon:O.default.createElement("span",{className:"icon",style:{width:"20px",height:"20px"}},O.default.createElement(m.ReactComponent,null)),name:a.disabled?O.default.createElement("del",null,decodeURIComponent(n)):decodeURIComponent(n),operations:a.disabled?[]:i,attrs:this.getAttrs(),module:this.module,breadcrumbs:[{label:t("BRANCH_PL"),url:"/".concat(c,"/clusters/").concat(u,"/devops/").concat(s,"/pipelines/").concat(d,"/branch")}]};return O.default.createElement(y.default,(0,o.default)({routes:this.props.route.routes,stores:r,nav:this.renderNav()},f))}},{key:"store",get:function(){return this.props.pipelineStore}},{key:"routing",get:function(){return this.props.rootStore.routing}},{key:"isAtBranchDetailPage",get:function(){return this.props.match.params.branch}},{key:"createTime",get:function(){return(0,k.default)(this.store.detail.createTime).format("YYYY-MM-DD HH:mm:ss")}},{key:"updateTime",get:function(){var e=this.store.activityList,t=(0,E.default)((0,D.toJS)(e.data),"[0].startTime","");return t?(0,k.default)(t).format("YYYY-MM-DD HH:mm:ss"):"-"}},{key:"enabledActions",get:function(){var e=this.props.match.params,t=e.cluster,r=e.devops;return globals.app.getActions({module:this.module,cluster:t,devops:r})}}]),n}(O.default.Component))||l)||l)||l;r.default=I},5105:function(e,t,r){e.exports={baseInfo:"_3HQJmf6iSZPlK8nYquzZhi",baseInfo__item:"_21f4U9zLDoThPP1XVcjrtN",nav:"_1zmZlvZRZpKK0iFQUK4SUS",navItem:"_1qxNj_W4v125O6nycDNJsO",active:"aoFngF_r7TXaP9bczwBXT",loading:"_3rfEP-DWJqUbeEoW_wkgNb",dashboardLable:"OUIocWs0_2aT0fv9yabY9",dashboardValue:"_1LaE4jPHTXp8dZPg_BkotN"}},5106:function(e,r,n){"use strict";var a=n(20);n(12),n(5),n(11),n(6),n(84),n(48),n(16),n(9),n(13),n(10),n(4),n(23),n(24),n(17),n(85),n(62),n(136),n(7),Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0,n(12),n(45),n(5),n(11),n(6),n(84),n(28),n(48),n(42),n(16),n(34),n(15),n(9),n(13),n(10),n(4),n(22),n(23),n(57),n(24),n(17),n(85),n(62),n(7);var o=a(n(1272)),i=a(n(315)),l=a(n(61)),s=a(n(30)),u=a(n(43));n(41);var c,d=a(n(44)),f=a(n(36)),p=a(n(37)),h=a(n(55)),m=a(n(56)),v=a(n(51)),g=a(n(240)),y=a(n(1990)),b=a(n(921)),E=a(n(1143)),S=a(n(26)),D=a(n(198)),_=a(n(60)),k=a(n(63)),O=a(n(449)),w=n(14),N=n(239),P=a(n(243)),R=a(n(0)),C=a(n(1991)),I=n(52),L=n(791),T=n(434),A=n(1183);function j(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function x(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?j(Object(r),!0).forEach((function(t){(0,s.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):j(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function M(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,v.default)(e);if(t){var a=(0,v.default)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return(0,m.default)(this,r)}}n(1992);var U=(0,N.inject)("rootStore","devopsStore","pipelineStore")(c=(0,N.observer)(c=(0,L.trigger)(c=function(e){(0,h.default)(n,e);var r=M(n);function n(){var e;(0,f.default)(this,n);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(e=r.call.apply(r,[this].concat(o))).sonarqubeStore=new C.default,e.state={formTemplate:e.store.pipeLineConfig},e.module="pipelines",e.fetchData=(0,d.default)(u.default.mark((function t(){var r,n;return u.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.props.match.params,n=e.store.detail,t.next=4,e.store.fetchDetail(r);case 4:e.setBranchNames((0,w.toJS)(n.branchNames),r),e.getPipeLineConfig(),e.getSonarqube();case 7:case"end":return t.stop()}}),t)}))),e.getPipeLineConfig=(0,d.default)(u.default.mark((function t(){var r,n;return u.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.props.match.params,t.next=3,e.store.getPipeLineConfig();case 3:(n=t.sent).devops=r.devops,n.cluster=r.cluster,n.devopsName=e.props.devopsStore.devopsName,e.setState({formTemplate:n});case 8:case"end":return t.stop()}}),t)}))),e.setBranchNames=function(e,t){(0,_.default)(e)&&!(0,k.default)(e)&&(t.branch=e[0])},e.getSonarqube=function(){if((0,S.default)(globals,"config.devops.sonarqubeURL")){var t=e.props.match.params;e.sonarqubeStore.fetchDetail(t)}},e.getUpTime=function(){var t=e.store.activityList,r=(0,S.default)((0,w.toJS)(t.data),"[0].startTime","");return r?(0,P.default)(r).format("YYYY-MM-DD HH:mm:ss"):"-"},e.fetchPipelineConfig=(0,d.default)(u.default.mark((function t(){var r;return u.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.props.match.params,t.next=3,e.store.fetchDetail(x(x({},r),{},{isSilent:!0}));case 3:return t.next=5,e.getPipeLineConfig();case 5:case"end":return t.stop()}}),t)}))),e.getOperations=function(){var r,n=(0,w.toJS)(e.store).detail,a=e.props.match.params,o=a.devops,i=a.cluster,s=a.workspace,c=a.name;return[{key:"edit",type:"control",text:t("EDIT_INFORMATION"),action:"edit",onClick:function(){return e.trigger("pipeline.edit",{devops:o,cluster:i,formTemplate:e.state.formTemplate,success:e.fetchData,handleScanRepository:e.handleScanRepository,trigger:function(){var t;(t=e).trigger.apply(t,arguments)}})}},{key:"editConfig",type:"control",text:t("EDIT_SETTINGS"),action:"edit",onClick:(r=(0,d.default)(u.default.mark((function t(){return u.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.fetchPipelineConfig();case 2:e.trigger("pipeline.advance.edit",{devops:o,cluster:i,formTemplate:e.state.formTemplate,success:e.fetchData,handleScanRepository:e.handleScanRepository});case 3:case"end":return t.stop()}}),t)}))),function(){return r.apply(this,arguments)})}].concat((0,l.default)(n.isMultiBranch?[{key:"scan",text:t("SCAN_REPOSITORY"),action:"edit",onClick:e.handleScanRepository},{key:"scanLogs",text:t("VIEW_SCAN_LOGS"),action:"edit",onClick:function(){e.trigger("pipeline.scanRepositoryLogs",{params:{devops:o,cluster:i,workspace:s,name:c},handleScanRepository:e.handleScanRepository})}}]:[]),[{key:"delete",text:t("DELETE"),action:"delete",onClick:function(){e.trigger("resource.delete",{devops:o,cluster:i,type:e.name,detail:{devops:o,cluster:i,name:e.store.detail.name},success:function(){e.routing.push("/".concat(s,"/clusters/").concat(i,"/devops/").concat(o,"/pipelines"))}})}}])},e.getCurrentState=function(){var t=e.store,r=t.activityList,n=t.branchList,a=t.pullRequestList,o={activity:(0,S.default)((0,w.toJS)(r),"data[0]",{}),branch:(0,S.default)((0,w.toJS)(n),"data[0].latestRun",{}),"pull-request":(0,S.default)((0,w.toJS)(a),"data[0].latestRun",{})};return o[(0,O.default)(e.props.location.pathname.split("/"))]||o.activity},e.getPipelineStatus=function(e){return x({},{failed:{type:"failure",label:t("FAILED")},pending:{type:"running",label:t("RUNNING")},working:{type:"running",label:t("RUNNING")},successful:{type:"success",label:t("SUCCESSFUL")}}[e])},e.getAttrs=function(){var r=e.props.devopsStore.devopsName,n={};if(e.store.detail.isMultiBranch){var a,o,i=(0,w.toJS)(e.store.pipelineConfig),l=(0,S.default)(i,"spec.multi_branch_pipeline.source_type"),s=(0,S.default)(i,"spec.multi_branch_pipeline.".concat(l,"_source"),{});n=null!==(a=null===(o=A.getCodeRepoTemplate[l])||void 0===o?void 0:o.call(A.getCodeRepoTemplate,s))&&void 0!==a?a:{}}var u=(0,S.default)(e.store.pipelineConfig,'metadata.annotations["pipeline.devops.kubesphere.io/syncstatus"]'),c=e.store.detail.isMultiBranch?t("MULTI_BRANCH_PIPELINE"):t("PIPELINE_PL");return[{name:t("DEVOPS_PROJECT"),value:(0,I.showNameAndAlias)(r,"devops")},{name:t("KIND_TCAP"),value:c},{hide:!e.store.detail.isMultiBranch,name:t("CODE_REPO"),value:n.repo&&n.url?"".concat(n.repo,"(").concat(n.url,")"):n.url},{name:t("TASK_STATUS"),value:R.default.createElement(b.default,(0,T.getPipelineStatus)(e.getCurrentState()))},{name:t("SYNC_STATUS"),value:R.default.createElement(b.default,e.getPipelineStatus(u))},{name:t("UPDATE_TIME_TCAP"),value:e.getUpTime()}].filter((function(e){return!e.hide}))},e.handleScanRepository=(0,d.default)(u.default.mark((function r(){var n,a;return u.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=e.props.match.params,a=e.store.detail,r.next=4,e.store.scanRepository({devops:n.devops,name:a.name,cluster:n.cluster});case 4:g.default.success({content:t("SCAN_REPO_SUCCESSFUL")}),e.store.fetchDetail(n);case 6:case"end":return r.stop()}}),r)}))),e.renderNav=function(){return R.default.createElement(y.default,{sonarqubeStore:e.sonarqubeStore,detailStore:e.store,route:e.route,match:e.props.match})},e}return(0,p.default)(n,[{key:"componentDidMount",value:function(){var e=this.props.match.params,t=this.store.detail;this.setBranchNames((0,w.toJS)(t.branchNames),e),this.getPipeLineConfig(),this.getSonarqube()}},{key:"render",value:function(){var e=this,r={detailStore:this.store,sonarqubeStore:this.sonarqubeStore},n=this.getOperations().filter((function(t){return e.enabledActions.includes(t.action)})),a=this.state.formTemplate,o=(0,D.default)(a,"pipeline")?"pipeline.description":"multi_branch_pipeline.description",l=(0,S.default)(a,o,"-"),s=this.props.match.params,u=s.devops,c=s.cluster,d=s.workspace,f={module:this.module,name:(0,S.default)(this.store.detail,"name"),desc:l,operations:n,attrs:this.getAttrs(),labels:this.store.detail.labels,breadcrumbs:[{label:t("PIPELINE_PL"),url:"/".concat(d,"/clusters/").concat(c,"/devops/").concat(u,"/pipelines")}]};return R.default.createElement(E.default,(0,i.default)({routes:this.routes,stores:r,nav:this.renderNav()},f))}},{key:"store",get:function(){return this.props.pipelineStore}},{key:"name",get:function(){return"PIPELINE"}},{key:"routing",get:function(){return this.props.rootStore.routing}},{key:"enabledActions",get:function(){var e=this.props.match.params,t=e.cluster,r=e.devops;return globals.app.getActions({module:this.module,cluster:t,devops:r})}},{key:"ksVersion",get:function(){var e,t=this.props.match.params.cluster;return(null===(e=window.parent.globals)||void 0===e?void 0:e.app.isMultiCluster)?(0,S.default)(window,"parent.globals.clusterConfig.".concat(t,".ksVersion")):(0,S.default)(window,"parent.globals.ksConfig.ksVersion")}},{key:"routes",get:function(){var e=(0,o.default)(this.props.route.routes),t=e[0],r=e.slice(1);return[x(x({},t),{},{component:t.getComponent(this.ksVersion)})].concat((0,l.default)(r))}},{key:"route",get:function(){return x(x({},this.props.route),{},{routes:this.routes})}}]),n}(R.default.Component))||c)||c)||c;r.default=U},5107:function(e,r,n){"use strict";var a=n(20);n(12),n(5),n(11),n(6),n(84),n(16),n(9),n(13),n(10),n(4),n(23),n(24),n(17),n(85),n(62),n(7),n(110),Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0,n(12),n(45),n(5),n(11),n(6),n(84),n(28),n(42),n(16),n(34),n(15),n(9),n(13),n(10),n(4),n(22),n(23),n(57),n(24),n(17),n(85),n(62),n(7),n(110);var o=a(n(315)),i=a(n(30)),l=a(n(65)),s=a(n(43));n(41);var u,c,d,f=a(n(44)),p=a(n(36)),h=a(n(37)),m=a(n(88)),v=a(n(55)),g=a(n(56)),y=a(n(51)),b=a(n(49)),E=(a(n(66)),a(n(0))),S=n(14),D=n(239),_=a(n(243)),k=a(n(26)),O=a(n(189)),w=n(434),N=a(n(921)),P=a(n(1986)),R=n(791),C=n(186),I=a(n(240)),L=a(n(1143));function T(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function A(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?T(Object(r),!0).forEach((function(t){(0,i.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):T(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function j(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,y.default)(e);if(t){var a=(0,y.default)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return(0,g.default)(this,r)}}var x=(0,D.inject)("rootStore","devopsStore","pipelineStore")(u=(0,D.observer)(u=(0,R.trigger)((c=function(e){(0,v.default)(n,e);var r=j(n);function n(){var e;(0,p.default)(this,n);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(e=r.call.apply(r,[this].concat(o))).store=new P.default,e.module="pipelines",e.state={showEdit:!1,showYamlEdit:!1,isLoading:!0},e.refreshTimer=setInterval((function(){return e.refreshHandler()}),4e3),e.refreshHandler=function(){var t=e.props.match.params;e.store.runDetail.message||(e.hasRuning?e.store.getRunDetail(t):(clearInterval(e.refreshTimer),e.refreshTimer=null))},e.fetchData=function(){var t=e.props.match.params;e.props.match.params.branch&&e.props.pipelineStore.getBranchDetail((0,O.default)(t,"runName")),e.store.getRunDetail(t)},e.getRunName=(0,f.default)(s.default.mark((function t(){var r;return s.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.props.match.params,t.next=3,e.store.getRunName(r);case 3:case"end":return t.stop()}}),t)}))),(0,l.default)(e,"rePlay",d,(0,m.default)(e)),e.stop=function(){var r,n,a=e.props.match.params;null===(r=e.props.pipelineStore)||void 0===r||null===(n=r.handleActivityStop)||void 0===n||n.call(r,A({url:e.getActivityDetailLinks(e.store.runDetail)},a)),I.default.success({content:t("STOP_PIPELINE_SUCCESSFUL")}),e.fetchData()},e.getActivityDetailLinks=function(e){var t=(0,k.default)(e,"_originData.spec.scm.refName");return t?"branches/".concat(encodeURIComponent(t),"/runs/").concat(e.id):"runs/".concat(e.id)},e.getOperations=function(){return[{key:"replay",type:"control",text:t("Replay"),action:"edit",show:!e.isRuning,onClick:function(){return e.rePlay()}},{key:"stop",text:t("STOP"),action:"edit",type:"danger",show:e.isRuning,onClick:function(){return e.stop()}}]},e.getAttrs=function(){var r=e.store.runDetail;return[{name:t("RUN_ID"),value:r.id},{name:t("TASK_STATUS"),value:E.default.createElement(N.default,(0,w.getPipelineStatus)(r))},{name:t("UPDATE_TIME_TCAP"),value:e.updateTime}]},e}return(0,h.default)(n,[{key:"componentDidMount",value:function(){this.fetchData()}},{key:"componentDidUpdate",value:function(e){var t=this.store.runDetail,r=this.props.match.params,n=r.devops,a=r.runName,o=r.branch,i=r.workspace,l=r.cluster;a!==e.match.params.runName&&(clearInterval(this.refreshTimer),this.refreshTimer=setInterval(this.refreshHandler,4e3)),t.name&&t.name!==a&&this.routing.push("/".concat(i,"/clusters/").concat(l,"devops/").concat(n,"/pipelines/").concat(name).concat(o?"/branch/".concat(o):"","/run/").concat(t.name)),!this.refreshTimer&&this.hasRuning&&(this.refreshTimer=setInterval(this.refreshHandler,4e3))}},{key:"componentWillUnmount",value:function(){clearInterval(this.refreshTimer)}},{key:"render",value:function(){var e=this,r=this.store.runDetail,n=r.id,a=r.annotations,i=r.labels,l=this.props.match.params,s=l.branch,u=l.name,c=l.runId,d={detailStore:this.store};if(this.store.isLoading&&!this.store.detail.name)return E.default.createElement(C.Loading,{className:"ks-page-loading"});var f=this.getOperations().filter((function(t){return e.enabledActions.includes(t.action)})),p={name:n,operations:this.isDisabled?[]:f,attrs:this.getAttrs(),desc:(0,k.default)(a,"desc"),labels:i,module:this.module,breadcrumbs:[{label:s&&c?t("BRANCH_PL"):t("RUN_RECORDS"),url:s?"".concat(this.listUrl,"/").concat(u,"/branch/").concat(s,"/activity"):"".concat(this.listUrl,"/").concat(u,"/activity")}]};return E.default.createElement(L.default,(0,o.default)({routes:this.routes,stores:d},p))}},{key:"isDisabled",get:function(){var e,t;return null===(e=this.props.pipelineStore)||void 0===e||null===(t=e.branchDetail)||void 0===t?void 0:t.disabled}},{key:"listUrl",get:function(){var e=this.props.match.params,t=e.workspace,r=e.devops,n=e.cluster;return"/".concat(t,"/clusters/").concat(n,"/devops/").concat(r,"/pipelines")}},{key:"hasRuning",get:function(){var e=this.store.runDetail,t=(0,k.default)(e,"state");return t&&"FINISHED"!==t}},{key:"routing",get:function(){return this.props.rootStore.routing}},{key:"creator",get:function(){return(0,k.default)(this.store.detail,"creator",t("unknown"))}},{key:"createTime",get:function(){return(0,_.default)(this.store.detail.createTime).format("YYYY-MM-DD HH:mm:ss")}},{key:"updateTime",get:function(){var e=this.store.runDetail,t=(0,k.default)(e,"startTime","");return t?(0,_.default)(t).format("YYYY-MM-DD HH:mm:ss"):"-"}},{key:"enabledActions",get:function(){var e=this.props.match.params,t=e.cluster,r=e.devops;return globals.app.getActions({module:this.module,cluster:t,devops:r})}},{key:"isRuning",get:function(){var e,t;return"FINISHED"!==(null===(e=this.store.runDetail)||void 0===e?void 0:e.state)&&"PAUSED"!==(null===(t=this.store.runDetail.state)||void 0===t?void 0:t.state)}},{key:"routes",get:function(){var e=this.props.route.routes;return(0,k.default)(this.store.runDetail,"spec.parameters",[]).length?e:e.filter((function(e){return"build-parameters"!==e.name}))}}]),n}(E.default.Component),d=(0,b.default)(c.prototype,"rePlay",[S.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return(0,f.default)(s.default.mark((function t(){var r,n;return s.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.props.match.params,t.next=3,e.store.replay(r);case 3:n=t.sent,e.routing.push("/".concat(r.workspace,"/clusters/").concat(r.cluster,"/devops/").concat(r.devops,"/pipelines/").concat(r.name).concat(r.branch?"/branch/".concat(r.branch):"","/activity")),n.id&&(e.store.runDetail=n);case 6:case"end":return t.stop()}}),t)})))}}),u=c))||u)||u)||u;r.default=x},5108:function(e,r,n){"use strict";var a=n(20);n(12),n(109),n(5),n(11),n(6),n(16),n(9),n(13),n(10),n(4),n(23),n(24),n(17),n(62),n(7),Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0,n(12),n(109),n(45),n(5),n(11),n(6),n(28),n(42),n(16),n(34),n(15),n(9),n(13),n(10),n(4),n(23),n(57),n(24),n(17),n(62),n(7);var o,i,l=a(n(315)),s=a(n(30)),u=a(n(36)),c=a(n(37)),d=a(n(55)),f=a(n(56)),p=a(n(51)),h=a(n(49)),m=a(n(0)),v=a(n(1143)),g=n(791),y=a(n(1194)),b=n(239),E=a(n(26)),S=a(n(241)),D=n(52),_=n(14),k=a(n(438)),O=a(n(5109)),w=a(n(1459)),N=a(n(1984));function P(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function R(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?P(Object(r),!0).forEach((function(t){(0,s.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):P(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function C(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,p.default)(e);if(t){var a=(0,p.default)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return(0,f.default)(this,r)}}var I=(0,b.inject)("rootStore")(o=(0,b.observer)(o=(0,g.trigger)((i=function(e){(0,d.default)(n,e);var r=C(n);function n(){var e;(0,u.default)(this,n);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(e=r.call.apply(r,[this].concat(o))).state={showEdit:!1,showYamlEdit:!1,deleteModule:!1,isLoading:!0},e.store=new y.default,e.clusterStore=new k.default,e.fetchData=function(){var t=e.props.match.params;e.store.fetchDetail({name:t.cd,devops:e.devops,cluster:e.cluster})},e.getOperations=function(){return[{key:"edit",type:"control",text:t("EDIT_INFORMATION"),action:"edit",onClick:function(){e.trigger("resource.baseinfo.edit",{formTemplate:e.store.detail,detail:R(R({},e.store.detail),{},{cluster:e.cluster}),success:e.fetchData})}},{key:"sync",icon:"changing-over",text:t("SYNC"),action:"edit",onClick:function(){e.trigger("cd.sync",{title:t("SYNC_RESOURCE"),formTemplate:(0,S.default)((0,_.toJS)(e.store.detail),"repoSource"),devops:e.devops,cluster:e.cluster,noCodeEdit:!0,application:e.store.detail.name,success:e.fetchData})}},{key:"editYaml",icon:"pen",text:t("EDIT_YAML"),action:"edit",onClick:function(){e.trigger("resource.yaml.edit",{detail:R(R({},e.store.detail),{},{cluster:e.cluster}),success:e.fetchData})}},{key:"delete",icon:"trash",text:t("DELETE"),action:"delete",onClick:function(){e.trigger("cd.delete",{type:"CONTINUOUS_DEPLOYMENT",detail:R(R({},e.store.detail),{},{cluster:e.cluster}),success:function(){return e.routing.push(e.listUrl)}})}}]},e.getAttrs=function(){var r=e.store.detail,n=(0,E.default)(r,"status.reconciledAt");return[{name:t("HEALTH_STATUS"),value:m.default.createElement(w.default,{type:r.healthStatus,label:r.healthStatus,noBolder:!0})},{name:t("DEPLOY_LOCATION"),value:m.default.createElement(N.default,{destination:r.destination,clustersDetail:e.clusters})},{name:t("CODE_REPOSITORY_URL"),value:(0,E.default)(r,"repoSource.repoURL","-")},{name:t("REVISION"),value:(0,E.default)(r,"repoSource.targetRevision","-")},{name:t("CODE_RELATIVE_PATH"),value:(0,E.default)(r,"repoSource.path","-")},{name:t("CREATION_TIME_TCAP"),value:(0,D.getLocalTime)(r.createTime).format("YYYY-MM-DD HH:mm:ss")},{name:t("UPDATE_TIME_TCAP"),value:n?(0,D.getLocalTime)(n).format("YYYY-MM-DD HH:mm:ss"):"-"},{name:t("CREATOR"),value:r.creator}]},e}return(0,c.default)(n,[{key:"componentDidMount",value:function(){this.fetchData(),this.clusterStore.fetchList({limit:-1})}},{key:"render",value:function(){var e=this.store.detail,r={detailStore:this.store},n={module:"applications",name:(0,D.getDisplayName)(e),desc:e.description,operations:this.getOperations(),attrs:this.getAttrs(),breadcrumbs:[{label:t("CONTINUOUS_DEPLOYMENT_PL"),url:this.listUrl}]};return m.default.createElement(v.default,(0,l.default)({routes:O.default},n,{stores:r}))}},{key:"clusters",get:function(){return this.clusterStore.list.data}},{key:"listUrl",get:function(){var e=this.props.match.params,t=e.workspace,r=e.cluster,n=e.devops;return"/".concat(t,"/clusters/").concat(r,"/devops/").concat(n,"/cd")}},{key:"devops",get:function(){return this.props.match.params.devops}},{key:"cluster",get:function(){return this.props.match.params.cluster}},{key:"routing",get:function(){return this.props.rootStore.routing}}]),n}(m.default.Component),(0,h.default)(i.prototype,"clusters",[_.computed],Object.getOwnPropertyDescriptor(i.prototype,"clusters"),i.prototype),o=i))||o)||o)||o;r.default=I},5109:function(e,t,r){"use strict";r(15);var n=r(20);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(317),o=n(r(5110)),i="/:workspace/clusters/:cluster/devops/:devops/cd/:cd",l=[{path:"".concat(i,"/syncStatus"),title:"SYNC_STATUS",component:o.default},(0,a.getIndexRoute)({path:i,to:"".concat(i,"/syncStatus"),exact:!0})];t.default=l},5110:function(e,r,n){"use strict";n(15);var a=n(20);n(5),n(48),n(4),n(23),n(24),n(17),n(62),n(110),Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0,n(45),n(5),n(48),n(42),n(4),n(23),n(57),n(24),n(17),n(62),n(110);var o,i,l,s=a(n(36)),u=a(n(37)),c=a(n(55)),d=a(n(56)),f=a(n(51)),p=a(n(0)),h=n(239),m=n(14),v=a(n(1)),g=a(n(796)),y=a(n(26)),b=a(n(63)),E=n(186),S=n(1144),D=n(52),_=a(n(5111)),k=a(n(1459));function O(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,f.default)(e);if(t){var a=(0,f.default)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return(0,d.default)(this,r)}}var w=(0,h.inject)("detailStore")(o=(0,h.observer)((l=i=function(e){(0,c.default)(n,e);var r=O(n);function n(){var e;(0,s.default)(this,n);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(e=r.call.apply(r,[this].concat(o))).refreshTimer=setInterval((function(){return e.getDetail()}),4e3),e.getDetail=function(){var t=e.props.match.params;e.props.detailStore.fetchDetail({name:t.cd,devops:t.devops,cluster:t.cluster})},e.getColumns=function(){return[{title:t("NAME"),dataIndex:"name",width:"20%"},{title:t("TYPE"),dataIndex:"kind",width:"20%"},{title:t("PROJECT_PL"),dataIndex:"namespace",width:"15%"},{title:t("SYNC_STATUS"),dataIndex:"status",width:"10%",render:function(e){return p.default.createElement(k.default,{type:e,label:e})}},{title:t("MESSAGE"),dataIndex:"message"}]},e.renderTable=function(){var t=(0,y.default)(e.detail,"status.operationState.syncResult.resources",[]);return p.default.createElement(g.default,{hideHeader:!0,hideFooter:!0,rowKey:"name",data:t,showEmpty:0===t.length,columns:e.getColumns(),name:"sync_result"})},e.renderSyncTip=function(){var t=(0,y.default)(e.detail,"status.conditions[0]",{}),r=p.default.createElement("div",{className:_.default.statusTip},p.default.createElement("strong",null,t.type),p.default.createElement("p",null,"Last Transition Time:  ",(0,D.getLocalTime)(t.lastTransitionTime).format("YYYY-MM-DD HH:mm:ss")),p.default.createElement("p",null,t.message));return(0,b.default)(t)?p.default.createElement("div",{className:_.default.syncStatus},p.default.createElement(E.Icon,{name:"rocket",size:40}),p.default.createElement("span",{className:_.default.syncStatus_icon},p.default.createElement(k.default,{type:e.detail.syncStatus,hasLabel:!1}))):p.default.createElement(E.Tooltip,{content:r},p.default.createElement("div",{className:_.default.syncStatus},p.default.createElement(E.Icon,{name:"rocket",size:40}),p.default.createElement("span",{className:_.default.syncStatus_icon},p.default.createElement(k.default,{type:e.detail.syncStatus,hasLabel:!1}))))},e}return(0,u.default)(n,[{key:"componentWillUnmount",value:function(){this.refreshTimer&&(clearInterval(this.refreshTimer),this.refreshTimer=null)}},{key:"render",value:function(){var e=(0,y.default)(this.detail,"status.sync.revision");e=e?e.slice(0,6):"-";var r=(0,y.default)(this.detail,"status.operationState.startedAt"),n=(0,y.default)(this.detail,"status.operationState.finishedAt"),a=new Date(n)-new Date(r),o=isNaN(a)?"-":(0,D.formatUsedTime)(a);return p.default.createElement("div",{className:_.default.container},p.default.createElement("div",{className:_.default.sync_info},p.default.createElement("h3",null,t("SYNC_STATUS")),p.default.createElement("div",{className:_.default.info_card},p.default.createElement("div",{className:_.default.wrapper},p.default.createElement("div",{className:_.default.wrapper_icon},this.renderSyncTip(),p.default.createElement("div",null,p.default.createElement("h4",null,this.detail.syncStatus),p.default.createElement("p",null,t("CURRENT_SYNC_STATUS")))),p.default.createElement("div",null,p.default.createElement("div",null,p.default.createElement("h4",null,r?(0,D.getLocalTime)(r).format("YYYY-MM-DD HH:mm:ss"):"-"),p.default.createElement("p",null,t("START_TIME_SCAP")))),p.default.createElement("div",null,p.default.createElement("div",null,p.default.createElement("h4",null,n?(0,D.getLocalTime)(n).format("YYYY-MM-DD HH:mm:ss"):"-"),p.default.createElement("p",null,t("END_TIME_SCAP"))))),p.default.createElement("div",{className:_.default.wrapper},p.default.createElement("div",{className:_.default.wrapper_gray},p.default.createElement(E.Icon,{name:"timed-task",size:40}),p.default.createElement("div",null,p.default.createElement("h4",null,"automated"===this.detail.syncType?t("AUTO_SYNC"):t("MANUAL_SYNC")),p.default.createElement("p",null,t("SYNC_STRATEGY")))),p.default.createElement("div",{className:_.default.wrapper_gray},p.default.createElement(S.ReactComponent,{style:{width:"40px",height:"40px"}}),p.default.createElement("div",null,p.default.createElement("h4",null,e),p.default.createElement("p",null,t("REVISION")))),p.default.createElement("div",{className:_.default.wrapper_gray},p.default.createElement(E.Icon,{name:"druration",size:40}),p.default.createElement("div",null,p.default.createElement("h4",null,o),p.default.createElement("p",null,t("DURATION"))))))),p.default.createElement("div",{className:_.default.sync_result},p.default.createElement("h3",null,t("SYNC_RESULT_PL")),this.renderTable()))}},{key:"detail",get:function(){return(0,m.toJS)(this.props.detailStore.detail)}},{key:"cluster",get:function(){return this.props.match.params.cluster}},{key:"workspace",get:function(){return this.props.match.params.workspace}}]),n}(p.default.Component),i.propTypes={data:v.default.array,loading:v.default.bool},o=l))||o)||o;r.default=w},5111:function(e,t,r){e.exports={sync_info:"P1_DMGCjflKvs2nDETVPp",wrapper:"O2yabE09ScoqgxEEPzkjT",wrapper_icon:"_298y9CFoE0vFZU5RbJX98v",wrapper_gray:"gPtAa_GbDy0pH07Qts0Qz",syncStatus:"D2ZeglI_nUBTcs0zqqC8Y",syncStatus_icon:"_27kGQtFFuQL9CM6S0uyD2k",info_card:"j4sgr02RRxHbSrZCy2rnX",sync_result:"ElQE6OWLJ5fyWrKN1eHoR",statusTip:"_25-wMvCf6ZCnomDV0kUfDA"}},783:function(e,t,r){"use strict";r(15);var n=r(20);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(317),o=n(r(5030)),i=function(){return(0,a.renderRoutes)(o.default)};t.default=i},921:function(e,r,n){"use strict";n(15);var a=n(157),o=n(20);n(4),n(23),n(17),Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0,n(45),n(42),n(4),n(23),n(57),n(17);var i=o(n(36)),l=o(n(37)),s=o(n(55)),u=o(n(56)),c=o(n(51)),d=a(n(0)),f=o(n(1)),p=o(n(3)),h=o(n(5063));function m(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,c.default)(e);if(t){var a=(0,c.default)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return(0,u.default)(this,r)}}var v=function(e){(0,s.default)(n,e);var r=m(n);function n(){return(0,i.default)(this,n),r.apply(this,arguments)}return(0,l.default)(n,[{key:"render",value:function(){var e=this.props,r=e.className,n=e.type,a=e.label,o=e.hasLabel;return d.default.createElement("span",null,d.default.createElement("span",{className:(0,p.default)("pipeline_status_icon",h.default[n.toLowerCase()],r)}),o&&(a||t(n.toLowerCase())))}}]),n}(d.PureComponent);r.default=v,v.propTypes={label:f.default.string,className:f.default.string,type:f.default.string,hasLabel:f.default.bool},v.defaultProps={type:"",label:"",hasLabel:!0}}}]);